
<!doctype html>
<html lang="es" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.4.1, mkdocs-material-8.5.6">
    
    
      
        <title>Preferencias - PDDM-iOS</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.20d9efc8.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.cbb835fc.min.css">
        
          
          
          <meta name="theme-color" content="#009485">
        
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="teal" data-md-color-accent="teal">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#preferencias-de-usuario" class="md-skip">
          Saltar a contenido
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Cabecera">
    <a href="../.." title="PDDM-iOS" class="md-header__button md-logo" aria-label="PDDM-iOS" data-md-component="logo">
      
  <img src="../../logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            PDDM-iOS
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Preferencias
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Búsqueda" placeholder="Búsqueda" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Limpiar" aria-label="Limpiar" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Inicializando búsqueda
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navegación" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="PDDM-iOS" class="md-nav__button md-logo" aria-label="PDDM-iOS" data-md-component="logo">
      
  <img src="../../logo.png" alt="logo">

    </a>
    PDDM-iOS
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1" type="checkbox" id="__nav_1" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_1">
          Persistencia básica
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Persistencia básica" data-md-level="1">
        <label class="md-nav__title" for="__nav_1">
          <span class="md-nav__icon md-icon"></span>
          Persistencia básica
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../1.0_introduccion/" class="md-nav__link">
        Introducción
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../1.1_sistema_de_archivos/" class="md-nav__link">
        Sistema de archivos
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../1.2_serializacion/" class="md-nav__link">
        Serialización
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../1.3_property_lists/" class="md-nav__link">
        Property lists
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Preferencias
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Preferencias
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Tabla de contenidos">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Tabla de contenidos
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#preferencias-de-usuario" class="md-nav__link">
    Preferencias de usuario
  </a>
  
    <nav class="md-nav" aria-label="Preferencias de usuario">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#que-se-puede-guardar-en-las-preferencias" class="md-nav__link">
    Qué se puede guardar en las preferencias
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#acceder-a-las-preferencias" class="md-nav__link">
    Acceder a las preferencias
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#registrar-valores-por-defecto" class="md-nav__link">
    Registrar valores por defecto
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#modificar-los-valores-de-las-preferencias" class="md-nav__link">
    Modificar los valores de las preferencias 
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#material-complementario-ubicar-las-preferencias-en-el-panel-de-control-general" class="md-nav__link">
    Material complementario: ubicar las preferencias en el “panel de control” general
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ejercicio-075-puntos" class="md-nav__link">
    Ejercicio (0.75 puntos)
  </a>
  
    <nav class="md-nav" aria-label="Ejercicio (0.75 puntos)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#interfaz-grafico" class="md-nav__link">
    Interfaz gráfico
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formatear-la-fecha-de-edicion" class="md-nav__link">
    Formatear la fecha de edición
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#guardar-los-datos" class="md-nav__link">
    Guardar los datos
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#recuperar-los-datos-al-cargar-la-aplicacion" class="md-nav__link">
    Recuperar los datos al cargar la aplicación
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2">
          ¡Hola Core Data!. Una aplicación de ejemplo
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="¡Hola Core Data!. Una aplicación de ejemplo" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          ¡Hola Core Data!. Una aplicación de ejemplo
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cap3/3.1_intro/" class="md-nav__link">
        Introducción a Core Data
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cap3/3.2_stack/" class="md-nav__link">
        Crear el stack de Core Data en iOS
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cap3/3.3_entidades/" class="md-nav__link">
        Ejercicio parte I. almacenar datos
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cap3/3.4_recuperar_datos/" class="md-nav__link">
        Ejercicio parte II. recuperar los datos
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cap3/apendice_ver_almacenamiento/" class="md-nav__link">
        Apéndice. Cómo examinar el almacenamiento persistente
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3">
          Modelos de datos en Core Data
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Modelos de datos en Core Data" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Modelos de datos en Core Data
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cap4/4.1_crear_modelo/" class="md-nav__link">
        Crear y editar modelos
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cap4/4.2_clases_propias/" class="md-nav__link">
        Modelar las entidades en código Swift
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cap4/4.3_CRUD/" class="md-nav__link">
        CRUD en Core Data
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cap4/4.4_validaciones/" class="md-nav__link">
        Validaciones
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cap4/4.5_otros_tipos/" class="md-nav__link">
        Otros tipos de datos
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cap4/4.6_ejercicios/" class="md-nav__link">
        Ejercicios de modelos de datos
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" >
      
      
      
      
        <label class="md-nav__link" for="__nav_4">
          Búsquedas en Core Data
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Búsquedas en Core Data" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Búsquedas en Core Data
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cap6/1_predicados/" class="md-nav__link">
        Predicados
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cap6/2_ordenacion/" class="md-nav__link">
        Ordenación
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cap6/3_ejercicios/" class="md-nav__link">
        Ejercicios
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" type="checkbox" id="__nav_5" >
      
      
      
      
        <label class="md-nav__link" for="__nav_5">
          Tablas en Core Data
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Tablas en Core Data" data-md-level="1">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          Tablas en Core Data
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cap7/1_el_frc/" class="md-nav__link">
        El "fetched results controller"
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cap7/2_configuracion_basica/" class="md-nav__link">
        Inicializar el "fetched results controller"
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cap7/3_tabla/" class="md-nav__link">
        Mostrar los datos en la tabla
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cap7/4_refrescar_tabla/" class="md-nav__link">
        Refrescar la tabla
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cap7/5_secciones/" class="md-nav__link">
        Secciones de tabla automáticas
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cap7/6_ejercicios/" class="md-nav__link">
        Ejercicios
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Tabla de contenidos">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Tabla de contenidos
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#preferencias-de-usuario" class="md-nav__link">
    Preferencias de usuario
  </a>
  
    <nav class="md-nav" aria-label="Preferencias de usuario">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#que-se-puede-guardar-en-las-preferencias" class="md-nav__link">
    Qué se puede guardar en las preferencias
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#acceder-a-las-preferencias" class="md-nav__link">
    Acceder a las preferencias
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#registrar-valores-por-defecto" class="md-nav__link">
    Registrar valores por defecto
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#modificar-los-valores-de-las-preferencias" class="md-nav__link">
    Modificar los valores de las preferencias 
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#material-complementario-ubicar-las-preferencias-en-el-panel-de-control-general" class="md-nav__link">
    Material complementario: ubicar las preferencias en el “panel de control” general
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#ejercicio-075-puntos" class="md-nav__link">
    Ejercicio (0.75 puntos)
  </a>
  
    <nav class="md-nav" aria-label="Ejercicio (0.75 puntos)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#interfaz-grafico" class="md-nav__link">
    Interfaz gráfico
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#formatear-la-fecha-de-edicion" class="md-nav__link">
    Formatear la fecha de edición
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#guardar-los-datos" class="md-nav__link">
    Guardar los datos
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#recuperar-los-datos-al-cargar-la-aplicacion" class="md-nav__link">
    Recuperar los datos al cargar la aplicación
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  <h1>Preferencias</h1>

<div class="admonition info">
<p class="admonition-title">Ejercicio</p>
<p>Al final de esta sección hay un ejercicio puntuado con <strong>0.75 puntos</strong> del total de <strong>1.5 puntos</strong> de todos los ejercicios de hoy.</p>
</div>
<h2 id="preferencias-de-usuario">Preferencias de usuario<a class="headerlink" href="#preferencias-de-usuario" title="Permanent link">&para;</a></h2>
<p>En la mayoría de las aplicaciones podemos configurar una serie de parámetros que las adaptan a las preferencias o necesidades del usuario. Son elementos tales como colores, tipos de fuentes, unidades de medida, nombres de usuarios y contraseñas de servicios de terceros, etc.</p>
<p>iOS nos ofrece un mecanismo estándar para almacenar estas preferencias de modo permanente. El API es bastante sencillo y nos permite establecer unos valores por defecto, modificarlos según lo que indique el usuario y leer los valores previamente fijados. </p>
<p>Hay que destacar que iOS solo nos da el API para leer/almacenar las preferencias, pero no el interfaz de usuario para mostrarlas/modificarlas, que es nuestra responsabilidad. Hay una excepción: si queremos que nuestras preferencias aparezcan dentro de las del sistema, el propio iOS se encargará de la interfaz.</p>
<h3 id="que-se-puede-guardar-en-las-preferencias">Qué se puede guardar en las preferencias<a class="headerlink" href="#que-se-puede-guardar-en-las-preferencias" title="Permanent link">&para;</a></h3>
<p>Desde el punto de vista del tipo de datos, las preferencias de usuario no son más que una <em>property list</em> en la que el objeto “raíz” es un <code>NSDictionary</code>. El sistema se encarga de serializar/deserializar los valores a/desde un archivo <code>.plist</code> de modo automático.</p>
<p>Si usamos este API nos ahorraremos tener que gestionar manualmente el <code>.plist</code> como hacíamos en la sección anterior. No tenemos que crearlo nosotros, comprobar si existe, guardarlo cuando toque o recuperar los datos cuando hagan falta, iOS lo hará por nosotros.</p>
<p>El fichero <code>.plist</code>con las preferencias se almacena automáticamente en el directorio <code>Library/Preferences</code> de la aplicación. Su nombre será el del proyecto de Xcode, precedido del "organization identifier" del proyecto. </p>
<p>Por defecto el <code>.plist</code> se genera en formato binario. Aunque no esté en modo texto podemos igualmente abrirlo y editarlo con el editor de .plist de Xcode. También podemos convertirlo a XML con una herramienta en línea de comandos llamada <code>plutil</code>, instalada por defecto junto con Xcode:</p>
<div class="highlight"><pre><span></span><code>plutil -convert xml1 -o resultado_xml.plist fichero_original.plist
</code></pre></div>
<h3 id="acceder-a-las-preferencias">Acceder a las preferencias<a name="acceso_prefs"></a><a class="headerlink" href="#acceder-a-las-preferencias" title="Permanent link">&para;</a></h3>
<p>Las preferencias del usuario actual son accesibles a través del <em>singleton</em> de la clase <code>UserDefaults</code>. Para acceder a la única instancia, usar el inicializador del mismo nombre</p>
<div class="highlight"><pre><span></span><code><span class="kd">let</span> <span class="nv">preferencias</span> <span class="p">=</span> <span class="n">UserDefaults</span><span class="p">()</span>
</code></pre></div>
<blockquote>
<p>Como las aplicaciones iOS están en un <em>sandbox</em> cada una solo tiene acceso a sus propias preferencias. El propio sistema no puede cambiar las preferencas de nuestra aplicación, salvo las que coloquemos dentro de las “generales”, como veremos en el punto siguiente</p>
</blockquote>
<p>Dentro del almacén de preferencias cada una de ellas tiene una clave, que será una cadena, y un valor. Así, podemos acceder a una preferencia con una familia de métodos <code>xxx(forKey:)</code>, donde la "xxx" varía según el tipo de datos: <code>integer</code>, <code>bool</code>, <code>float</code>, <code>double</code>, <code>array</code>, <code>object</code>,…</p>
<p>Por ejemplo, supongamos un juego en el que tuviéramos almacenado el <em>nick</em> del usuario y el <em>nivel</em> alcanzado. Podríamos obtener los valores con:</p>
<div class="highlight"><pre><span></span><code><span class="kd">let</span> <span class="nv">nick</span> <span class="p">=</span> <span class="n">preferencias</span><span class="p">.</span><span class="n">string</span><span class="p">(</span><span class="n">forKey</span><span class="p">:</span><span class="s">&quot;nick&quot;</span><span class="p">);</span>
<span class="kd">let</span> <span class="nv">nivel</span> <span class="p">=</span> <span class="n">preferencias</span><span class="p">.</span><span class="n">integer</span><span class="p">(</span><span class="n">forKey</span><span class="p">:</span> <span class="s">&quot;nivel&quot;</span><span class="p">)</span>
</code></pre></div>
<p>Al leer los valores de las preferencias se plantea un problema: cómo saber si ya tenemos un valor almacenado en las preferencias o no. En ciertos tipos de datos esto es sencillo: en un <code>String</code> como la preferencia <em>nick</em>, de no haber ya algo almacenado con esa clave se obtendrá <code>nil</code>. Pero con otros tipos no es tan fácil, ya que en el caso del <em>nivel</em> si la preferencia no existía se obtendrá 0. Entonces ¿cómo diferenciar si la preferencia se ha fijado a 0 o bien es que no se ha fijado?. La solución es registrar <em>valores por defecto</em> para todas las preferencias, de modo que no pueda haber una preferencia con un valor no fijado, bien sea porque se ha hecho por defecto o bien sea porque lo ha hecho una acción del usuario.</p>
<h3 id="registrar-valores-por-defecto">Registrar valores por defecto<a class="headerlink" href="#registrar-valores-por-defecto" title="Permanent link">&para;</a></h3>
<p>Podemos registrar un conjunto de preferencias por defecto pasándole un diccionario al método <code>registerDefaults</code> de <code>UserDefaults</code>:</p>
<div class="highlight"><pre><span></span><code><span class="kd">let</span> <span class="nv">prefs</span> <span class="p">=</span> <span class="n">UserDefaults</span><span class="p">()</span>
<span class="n">prefs</span><span class="p">.</span><span class="n">register</span><span class="p">(</span><span class="n">defaults</span><span class="p">:[</span>
  <span class="s">&quot;nick&quot;</span> <span class="p">:</span> <span class="s">&quot;anonimo&quot;</span><span class="p">,</span>
  <span class="s">&quot;nivel&quot;</span> <span class="p">:</span> <span class="mi">1</span>
<span class="p">])</span>
</code></pre></div>
<p>Hay que destacar que <em>los valores registrados por defecto no son permanentes</em>. Es decir, que hay que registrarlos cada vez que arranque la aplicación.</p>
<p>Si registramos un valor por defecto y este ya ha sido fijado por código (en la siguiente sección veremos cómo) el valor por defecto no “machacará” al ya fijado. Cuando iOS busca el valor para una preferencia sigue un esquema de “dominios”, en el que si no encuentra la clave en un dominio la busca en el siguiente. De este modo, primero busca en el dominio de los valores fijados por el usuario y si lo encuentra aquí lo devuelve. Es solo si no lo encuentra aquí cuando pasa a consultar los valores por defecto.</p>
<p>En un poco tedioso tener que volcar en el código un diccionario con todos los valores por defecto. Un método muy habitual de registrar los valores por defecto de modo más “limpio” es almacenarlos en un archivo <code>.plist</code> y deserializarlos con <code>initWithContentsOfFile</code>, como vimos en el apartado de cómo leer <em>property lists</em>.</p>
<h3 id="modificar-los-valores-de-las-preferencias">Modificar los valores de las preferencias <a name="modificar_prefs"></a><a class="headerlink" href="#modificar-los-valores-de-las-preferencias" title="Permanent link">&para;</a></h3>
<p>Simplemente tenemos que fijar la clave al valor que queramos usando la familia de métodos <code>set(valor,forKey:)</code></p>
<div class="highlight"><pre><span></span><code><span class="kd">let</span> <span class="nv">prefs</span> <span class="p">=</span> <span class="n">UserDefaults</span><span class="p">()</span>
<span class="n">prefs</span><span class="p">.</span><span class="kr">set</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">forKey</span><span class="p">:</span><span class="s">&quot;nivel&quot;</span><span class="p">)</span>
<span class="n">prefs</span><span class="p">.</span><span class="kr">set</span><span class="p">(</span><span class="s">&quot;Pepito&quot;</span><span class="p">,</span> <span class="n">forKey</span><span class="p">:</span><span class="s">&quot;nick&quot;</span><span class="p">)</span>
</code></pre></div>
<p>Por cuestiones de eficiencia, iOS no hace persistente el cambio inmediatamente sino a intervalos regulares o en momentos especiales (por ejemplo justo antes de salir de la aplicación). Una <em>property list</em> no se puede modificar de manera parcial y hay que crearla entera de nuevo, de manera que no sería eficiente persistir siempre los datos tras ejecutar el <code>set</code>. Por código podemos forzar el cambio en el <code>.plist</code> llamando al método <code>synchronize</code> de las preferencias</p>
<div class="highlight"><pre><span></span><code><span class="n">UserDefaults</span><span class="p">().</span><span class="n">synchronize</span><span class="p">()</span>
</code></pre></div>
<p>Otra forma de "forzar" la persistencia probando la aplicación es salir de la misma pulsando en el botón "home" (<code>Shift+Cmd+H</code> en el simulador) para que pase a <em>background</em>, momento en el que, como ya hemos dicho, iOS almacena de modo permanente los valores actuales. </p>
<blockquote>
<p>Como iOS tiene que modificar los datos si hay preferencias modificadas desde la última vez que se guardaron, no es aconsejable cambiar el valor de una preferencia “a las primeras de cambio”. Solo es adecuado si no es previsible que vaya a cambiar dentro de poco tiempo. Una estrategia típica es fijar los valores justo antes de salir de la aplicación.</p>
</blockquote>
<h3 id="material-complementario-ubicar-las-preferencias-en-el-panel-de-control-general">Material complementario: ubicar las preferencias en el “panel de control” general<a class="headerlink" href="#material-complementario-ubicar-las-preferencias-en-el-panel-de-control-general" title="Permanent link">&para;</a></h3>
<div class="admonition info">
<p class="admonition-title">Nota</p>
<p>Este apartado no te servirá para los ejercicios pero puedes echarle un vistazo para saber algo más del tema</p>
</div>
<p>El sistema nos da la posibilidad de controlar ciertas preferencias de nuestra aplicación dentro de las preferencias generales del sistema, en un apartado reservado a ella. Esto es lo que se conoce en iOS como un <em>settings bundle</em>. Podemos colocar aquí todas las preferencias o solo algunas.</p>
<blockquote>
<p>Apple recomienda colocar en el sistema solo las preferencias que se cambien en raras ocasiones. Por ejemplo en una aplicación que gestione un servicio de terceros podemos colocar aquí las credenciales de uso del servicio (login y password)</p>
</blockquote>
<p>A diferencia de las preferencias dentro de la aplicación, donde iOS nos da un API para editarlas/verlas pero no una interfaz esto es al contrario. En un fichero <code>.plist</code> con un formato especial podemos crear de modo sencillo una interfaz para las preferencias. </p>
<p>Para crear un <em>settings bundle</em> en Xcode ir a <code>File &gt; New &gt; File ...</code> y en el cuadro de diálogo que aparecerá, dentro del tipo <code>Resource</code> elegir  <code>Settings Bundle</code>. Se creará un archivo de tipo <em>property list</em> llamado <code>Root.plist</code> y algunos archivos auxiliares para la internacionalización (necesarios ya que vamos a tratar con elementos de interfaz).</p>
<p>Si editamos el <code>Root.plist</code> con el editor de Xcode podemos ver que tiene un formato un tanto especial: la lista de preferencias se representa con un array de items. Las propiedades de estos items son las que determinan el tipo de <em>widget</em> a usar para editar/ver la preferencia, sus parámetros y la clave con la que se va a almacenar la preferencia asociada. </p>
<p>En el ejemplo que se muestra a continuación, que se corresponde con el <code>Root.plist</code> que crea por defecto Xcode, puede verse que el item 1 es de tipo "campo de texto", que su <code>title</code> (la etiqueta que se ve en las preferencias) es <code>Name</code>, que el <em>widget</em> tiene una serie de propiedades (cuando se edita aparece un teclado alfabético,  no es seguro - o sea, se muestra el contenido, …) y está asociada a la preferencia cuya clave es <code>name_preference</code> (propiedad <code>Identifier</code>). </p>
<p><img alt="" src="../img/root.plist.png" /></p>
<p>No tenemos espacio en estos apuntes para explicar más detalladamente el proceso de configuración del <em>bundle</em>. El lector interesado puede consultar el apartado “<a href="https://developer.apple.com/library/ios/documentation/Cocoa/Conceptual/UserDefaults/Preferences/Preferences.html">implementing an iOS settings bundle</a>” de la “<a href="https://developer.apple.com/library/ios/documentation/Cocoa/Conceptual/UserDefaults/Introduction/Introduction.html#//apple_ref/doc/uid/10000059i-CH1-SW1">Preferences and Settings Programming Guide</a>” de Apple.</p>
<p><img alt="" src="../img/root.plist.png" title="Contenido del archivo Root.plist" /></p>
<p><img alt="" src="../img/settings.png" title="Cómo se muestran en el sistema las preferencias configuradas en el Root.plist" /></p>
<h2 id="ejercicio-075-puntos">Ejercicio (0.75 puntos)<a class="headerlink" href="#ejercicio-075-puntos" title="Permanent link">&para;</a></h2>
<p>Vamos a realizar una pequeña aplicación en la que los datos se guarden usando algunos de los mecanismos vistos en la sesión. Desde el punto de vista del usuario consistirá en una única "pantalla" con un <code>Text View</code> para editar un mensaje y un <code>Label</code> que mostrará la fecha y hora de edición. Los datos deben conservarse aunque salgamos de la aplicación.</p>
<p>Llama al proyecto <code>PersistenciaBasica</code>.</p>
<h3 id="interfaz-grafico">Interfaz gráfico<a class="headerlink" href="#interfaz-grafico" title="Permanent link">&para;</a></h3>
<p>Crea la interfaz:</p>
<ul>
<li>Inserta un <code>Text View</code>, un <code>Label</code> y un <code>Button</code> que ponga "guardar" en el <em>storyboard</em></li>
<li>En el <code>ViewController</code><ul>
<li>Crea dos <em>outlet</em> para acceder al contenido de text view y label. Recuerda que tienes que hacer <code>Ctrl+arrastrar</code>.</li>
<li>Cra un <em>action</em> que responda a pulsaciones sobre el botón "guardar"  </li>
<li>Crea una propiedad opcional llamada <code>fechaEdicion</code> de tipo <code>Date</code>, que representará la fecha y hora en que se haya editado el texto. </li>
</ul>
</li>
</ul>
<h3 id="formatear-la-fecha-de-edicion">Formatear la fecha de edición<a class="headerlink" href="#formatear-la-fecha-de-edicion" title="Permanent link">&para;</a></h3>
<p>Queremos que cuando se pulse el botón "guardar" (por tanto tendrás que hacer esto en el <em>action</em> del botón):</p>
<ul>
<li>La <code>fechaEdicion</code> se ponga a la fecha y hora actuales</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="kc">self</span><span class="p">.</span><span class="n">fechaEdicion</span> <span class="p">=</span> <span class="n">Date</span><span class="p">()</span>
</code></pre></div>
<ul>
<li>La fecha se muestre en modo texto en el <em>label</em>. Como el formato por defecto es un poco engorroso, mejor la formatearemos nosotros</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="c1">//SUPONEMOS que el outlet del label se llama &quot;fechaLabel&quot;</span>
<span class="c1">//CAMBIALO por lo que sea necesario</span>
<span class="kc">self</span><span class="p">.</span><span class="n">fechaLabel</span><span class="p">.</span><span class="n">text</span> <span class="p">=</span> <span class="n">DateFormatter</span><span class="p">.</span><span class="n">localizedString</span><span class="p">(</span>
             <span class="n">from</span><span class="p">:</span><span class="kc">self</span><span class="p">.</span><span class="n">fechaEdicion</span><span class="p">!,</span> 
             <span class="n">dateStyle</span><span class="p">:</span> <span class="p">.</span><span class="n">short</span><span class="p">,</span> <span class="n">timeStyle</span><span class="p">:</span> <span class="p">.</span><span class="n">medium</span><span class="p">)</span>
</code></pre></div>
<p><strong>Comprobar que lo anterior funciona correctamente</strong>, que al pulsar sobre el botón,se muestra la fecha y hora de edición en el <em>label</em>.</p>
<h3 id="guardar-los-datos">Guardar los datos<a class="headerlink" href="#guardar-los-datos" title="Permanent link">&para;</a></h3>
<p>En el <em>action</em> del botón añade el código Swift que necesites para almacenar el texto y la fecha como  dos preferencias de usuario llamadas "texto" y "fecha" respectivamente (en la fecha guarda la propiedad de tipo <code>Date</code>, no la fecha convertida a texto, esa es solo para visualización). Tendrás que mirar los apuntes para ver cómo hacerlo (apartado "<a href="../1.4_preferencias#modificar_prefs">Modificar los valores de las preferencias</a>")</p>
<h3 id="recuperar-los-datos-al-cargar-la-aplicacion">Recuperar los datos al cargar la aplicación<a class="headerlink" href="#recuperar-los-datos-al-cargar-la-aplicacion" title="Permanent link">&para;</a></h3>
<p>En el <code>viewDidLoad</code> del <em>controller</em> recupera las dos preferencias que guardaste y muestra su contenido en pantalla, a través de los correspondientes <em>outlets</em>.</p>
<p>Consulta el apartado <a href="../1.4_preferencias#acceso_prefs">"Acceder a las preferencias"</a>. Para recuperar la fecha:</p>
<ul>
<li>Como no hay un método específico para recuperar fechas, tendrás que usar el de objetos: <code>object(forKey:)</code> de <code>UserDefaults</code> </li>
<li>Para convertirlo de objeto en fecha tendrás que hacer un <em>cast</em> a <code>Date</code> (<code>as! Date</code>).</li>
</ul>
<p>Para comprobar si las preferencias se guardan:</p>
<ul>
<li>Sal de la <em>app</em> como lo haría un usuario en el móvil real (menú <code>Device &gt; Home</code> del simulador). </li>
<li>Ve a la aplicación SimSim en el menú superior, selecciona la app <code>PersistenciaBasica</code> y luego selecciona <code>Finder</code>: se abrirá una carpeta con el sistema de archivos de la <em>app</em>. </li>
<li>Las preferencias se guardan en <code>Library/Preferences</code>. Debería haber un fichero <code>.plist</code>. Si lo abres dándole doble clic debería abrirse en Xcode y podrás ver el contenido</li>
</ul>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
    <nav class="md-footer__inner md-grid" aria-label="Pie" >
      
        
        <a href="../1.3_property_lists/" class="md-footer__link md-footer__link--prev" aria-label="Anterior: Property lists" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Anterior
              </span>
              Property lists
            </div>
          </div>
        </a>
      
      
        
        <a href="../../cap3/3.1_intro/" class="md-footer__link md-footer__link--next" aria-label="Siguiente: Introducción a Core Data" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Siguiente
              </span>
              Introducción a Core Data
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../..", "features": [], "search": "../../assets/javascripts/workers/search.5bf1dace.min.js", "translations": {"clipboard.copied": "Copiado al portapapeles", "clipboard.copy": "Copiar al portapapeles", "search.config.lang": "es", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "B\u00fasqueda", "search.result.more.one": "1 m\u00e1s en esta p\u00e1gina", "search.result.more.other": "# m\u00e1s en esta p\u00e1gina", "search.result.none": "No se encontraron documentos", "search.result.one": "1 documento encontrado", "search.result.other": "# documentos encontrados", "search.result.placeholder": "Teclee para comenzar b\u00fasqueda", "search.result.term.missing": "Falta", "select.version.title": "Seleccionar versi\u00f3n"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.078830c0.min.js"></script>
      
    
  </body>
</html>
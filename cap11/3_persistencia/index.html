



<!doctype html>
<html lang="es" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
      
      
        <meta name="lang:clipboard.copy" content="Copiar al portapapeles">
      
        <meta name="lang:clipboard.copied" content="Copiado al portapapeles">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No se encontraron documentos">
      
        <meta name="lang:search.result.one" content="1 documento encontrado">
      
        <meta name="lang:search.result.other" content="# documentos encontrados">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.4.3">
    
    
      
        <title>Persistencia en Firebase - PDDM-iOS</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application.30686662.css">
      
        <link rel="stylesheet" href="../../assets/stylesheets/application-palette.a8b3c06d.css">
      
      
        
        
        <meta name="theme-color" content="#009688">
      
    
    
      <script src="../../assets/javascripts/modernizr.74668098.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../assets/fonts/material-icons.css">
    
    
    
      
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="teal" data-md-color-accent="teal">
  
    <svg class="md-svg">
      <defs>
        
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#persistencia-de-datos-en-firebase" tabindex="1" class="md-skip">
        Saltar a contenido
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../.." title="PDDM-iOS" class="md-header-nav__button md-logo">
          
            <img src="../../logo.png" width="24" height="24">
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              PDDM-iOS
            </span>
            <span class="md-header-nav__topic">
              
                Persistencia en Firebase
              
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Búsqueda" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Teclee para comenzar búsqueda
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main" role="main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="../.." title="PDDM-iOS" class="md-nav__button md-logo">
      
        <img src="../../logo.png" width="48" height="48">
      
    </a>
    PDDM-iOS
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-1" type="checkbox" id="nav-1">
    
    <label class="md-nav__link" for="nav-1">
      Persistencia básica
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-1">
        Persistencia básica
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap1/1.1_sistema_de_archivos/" title="Sistema de archivos" class="md-nav__link">
      Sistema de archivos
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap1/1.2_serializacion/" title="Serialización" class="md-nav__link">
      Serialización
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap1/1.3_property_lists/" title="Property lists" class="md-nav__link">
      Property lists
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap1/1.4_preferencias/" title="Preferencias" class="md-nav__link">
      Preferencias
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap1/1.5_ejercicios/" title="Ejercicios" class="md-nav__link">
      Ejercicios
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      SQLite
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        SQLite
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap2/2.1_intro_SQLite/" title="Introducción" class="md-nav__link">
      Introducción
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap2/2.2_API_SQLite/" title="El API de SQLIte" class="md-nav__link">
      El API de SQLIte
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap2/2.3_frameworks/" title="Frameworks para SQLite" class="md-nav__link">
      Frameworks para SQLite
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap2/2.4_ejercicios/" title="Ejercicios" class="md-nav__link">
      Ejercicios
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      ¡Hola Core Data!. Una aplicación de ejemplo
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        ¡Hola Core Data!. Una aplicación de ejemplo
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap3/3.1_intro/" title="Introducción a Core Data" class="md-nav__link">
      Introducción a Core Data
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap3/3.2_stack/" title="Crear el stack de Core Data en iOS" class="md-nav__link">
      Crear el stack de Core Data en iOS
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap3/3.3_entidades/" title="Las entidades. Almacenar datos" class="md-nav__link">
      Las entidades. Almacenar datos
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap3/3.4_recuperar_datos/" title="Recuperar los datos" class="md-nav__link">
      Recuperar los datos
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap3/apendice_ver_almacenamiento/" title="Apéndice. Cómo examinar el almacenamiento persistente" class="md-nav__link">
      Apéndice. Cómo examinar el almacenamiento persistente
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      Modelos de datos en Core Data
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        Modelos de datos en Core Data
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap4/4.1_crear_modelo/" title="Crear y editar modelos" class="md-nav__link">
      Crear y editar modelos
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap4/4.2_clases_propias/" title="Modelar las entidades en código Swift" class="md-nav__link">
      Modelar las entidades en código Swift
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap4/4.3_CRUD/" title="CRUD en Core Data" class="md-nav__link">
      CRUD en Core Data
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap4/4.4_validaciones/" title="Validaciones" class="md-nav__link">
      Validaciones
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap4/4.5_transformables/" title="Transformables" class="md-nav__link">
      Transformables
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap4/4.6_ejercicios/" title="Ejercicios de modelos de datos" class="md-nav__link">
      Ejercicios de modelos de datos
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      Búsquedas en Core Data
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        Búsquedas en Core Data
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap6/1_predicados/" title="Predicados" class="md-nav__link">
      Predicados
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap6/2_ordenacion/" title="Ordenación" class="md-nav__link">
      Ordenación
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap6/3_ejercicios/" title="Ejercicios" class="md-nav__link">
      Ejercicios
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6">
    
    <label class="md-nav__link" for="nav-6">
      Tablas en Core Data
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        Tablas en Core Data
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap7/1_el_frc/" title="El *fetched results controller*" class="md-nav__link">
      El *fetched results controller*
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap7/2_configuracion_basica/" title="Inicializar el "fetched results controller"" class="md-nav__link">
      Inicializar el "fetched results controller"
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap7/3_tabla/" title="Mostrar los datos en la tabla" class="md-nav__link">
      Mostrar los datos en la tabla
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap7/4_refrescar_tabla/" title="Refrescar la tabla" class="md-nav__link">
      Refrescar la tabla
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap7/5_secciones/" title="Secciones de tabla automáticas" class="md-nav__link">
      Secciones de tabla automáticas
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap7/6_ejercicios/" title="Ejercicios" class="md-nav__link">
      Ejercicios
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7" type="checkbox" id="nav-7">
    
    <label class="md-nav__link" for="nav-7">
      Migraciones de datos
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-7">
        Migraciones de datos
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap8/1_intro/" title="Qué son las migraciones de datos" class="md-nav__link">
      Qué son las migraciones de datos
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap8/2_versiones/" title="Versiones del modelo de datos" class="md-nav__link">
      Versiones del modelo de datos
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap8/3_migraciones_ligeras/" title="Migraciones ligeras" class="md-nav__link">
      Migraciones ligeras
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap8/4_migraciones_pesadas/" title="Migraciones pesadas" class="md-nav__link">
      Migraciones pesadas
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap8/apendice_migraciones_ios9/" title="Apéndice. migraciones en versiones antiguas de iOS" class="md-nav__link">
      Apéndice. migraciones en versiones antiguas de iOS
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-8" type="checkbox" id="nav-8">
    
    <label class="md-nav__link" for="nav-8">
      Concurrencia. Contextos múltiples
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-8">
        Concurrencia. Contextos múltiples
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap9/1_background/" title="Múltiples contextos para trabajos en *background*" class="md-nav__link">
      Múltiples contextos para trabajos en *background*
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap9/2_comunicacion/" title="Comunicación entre contextos" class="md-nav__link">
      Comunicación entre contextos
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap9/3_contextos_anidados/" title="Contextos anidados" class="md-nav__link">
      Contextos anidados
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap9/4_ejercicios/" title="Ejercicios" class="md-nav__link">
      Ejercicios
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-9" type="checkbox" id="nav-9">
    
    <label class="md-nav__link" for="nav-9">
      Miniproyecto
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-9">
        Miniproyecto
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../miniproyecto/restaurante/" title="Enunciado" class="md-nav__link">
      Enunciado
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-10" type="checkbox" id="nav-10" checked>
    
    <label class="md-nav__link" for="nav-10">
      Persistencia como servicio
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-10">
        Persistencia como servicio
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../1_introduccion_BAAS/" title="Backend as a Service" class="md-nav__link">
      Backend as a Service
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../2_gestion_usuarios/" title="Gestión de usuarios en Firebase" class="md-nav__link">
      Gestión de usuarios en Firebase
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Persistencia en Firebase
      </label>
    
    <a href="./" title="Persistencia en Firebase" class="md-nav__link md-nav__link--active">
      Persistencia en Firebase
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="__toc">Tabla de contenidos</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#persistencia-de-datos-en-firebase" class="md-nav__link">
    Persistencia de datos en Firebase
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#estructurar-los-datos" class="md-nav__link">
    Estructurar los datos
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#referencias" class="md-nav__link">
    Referencias
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#crear-y-actualizar-datos" class="md-nav__link">
    Crear y actualizar datos
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#consultas" class="md-nav__link">
    Consultas
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../4_ejercicios/" title="Ejercicios" class="md-nav__link">
      Ejercicios
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-11" type="checkbox" id="nav-11">
    
    <label class="md-nav__link" for="nav-11">
      Arquitecturas de aplicaciones en iOS
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-11">
        Arquitecturas de aplicaciones en iOS
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap10/intro/" title="Introducción" class="md-nav__link">
      Introducción
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap10/2_MVC/" title="Model/View/Controller" class="md-nav__link">
      Model/View/Controller
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap10/3_MVP/" title="Model/View/Presenter" class="md-nav__link">
      Model/View/Presenter
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap10/4_MVVM/" title="Model/View/ViewModel" class="md-nav__link">
      Model/View/ViewModel
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap10/5_VIPER/" title="VIPER" class="md-nav__link">
      VIPER
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap10/6_ejercicios/" title="Ejercicios MVVM" class="md-nav__link">
      Ejercicios MVVM
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap10/6_ejercicios_redux/" title="Ejercicios Redux" class="md-nav__link">
      Ejercicios Redux
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="__toc">Tabla de contenidos</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#persistencia-de-datos-en-firebase" class="md-nav__link">
    Persistencia de datos en Firebase
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#estructurar-los-datos" class="md-nav__link">
    Estructurar los datos
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#referencias" class="md-nav__link">
    Referencias
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#crear-y-actualizar-datos" class="md-nav__link">
    Crear y actualizar datos
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#consultas" class="md-nav__link">
    Consultas
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                  <h1>Persistencia en Firebase</h1>
                
                <h2 id="persistencia-de-datos-en-firebase">Persistencia de datos en Firebase<a class="headerlink" href="#persistencia-de-datos-en-firebase" title="Permanent link">&para;</a></h2>
<p>Actualmente hay dos bases de datos disponibles en Firebase: la <em>realtime</em> database, que es la "original" y el <em>cloud firestore</em>, que se introdujo posteriormente. Ambas son bases de datos NoSQL, aunque la <em>realtime</em> tiene una estructura de datos algo más peculiar. Vamos a ver aquí la <em>realtime database</em>, que como su nombre indica es especialmente apropiada para aplicaciones en <em>tiempo real</em>, ya que además de poder hacer las típicas consultas podemos "escuchar" los cambios en los datos. No obstante se puede usar en cualquier tipo de aplicación.</p>
<p>Podéis consultar <em>online</em> y traducida al español la <a href="https://firebase.google.com/docs/database/ios/start">documentación de los APIs de iOS para la <em>realtime database</em></a>.</p>
<h3 id="estructurar-los-datos">Estructurar los datos<a class="headerlink" href="#estructurar-los-datos" title="Permanent link">&para;</a></h3>
<p>Como ya hemos comentado, las dos bases de datos disponibles en Firebase son NoSQL. Esto quiere decir que los datos no tienen la división habitual en tablas a la que estamos acostumbrados en bases de datos relacionales. La base de datos tampoco se ocupa de comprobar automáticamente la consistencia o la integridad de los datos, quedando esta tarea en manos de la aplicación.</p>
<p>En la <em>realtime database</em> todos los datos están contenidos en un único "árbol" de pares clave-valor. Los valores pueden ser primitivos (números, cadenas o valores booleanos) o pueden ser valores compuestos a su vez de pares clave-valor.  Por ejemplo podríamos tener algo como:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="p">{</span>
    <span class="nt">&quot;personas&quot;</span> <span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;jap2&quot;</span> <span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;nombre&quot;</span> <span class="p">:</span> <span class="s2">&quot;Juan&quot;</span><span class="p">,</span>
            <span class="nt">&quot;apellidos&quot;</span><span class="p">:</span> <span class="s2">&quot;Arriquitaun Pérez&quot;</span>
        <span class="p">},</span>
        <span class="nt">&quot;ems21&quot;</span> <span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;nombre&quot;</span> <span class="p">:</span> <span class="s2">&quot;Eva&quot;</span><span class="p">,</span>
            <span class="nt">&quot;apellidos&quot;</span><span class="p">:</span> <span class="s2">&quot;Marín Salgado&quot;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>

<p>En este caso el árbol contiene un único par clave/valor en su nivel superior. El valor asociado a la clave "personas" es compuesto y consiste de dos pares cuyas claves son "jap2" y "ems21", y así sucesivamente. Nótese que la clave se separa del valor por ":", que un par se separa del siguiente con una coma y que los valores compuestos se delimitan entre llaves. Es decir, es un formato de datos muy similar a JSON, aunque en JSON se pueden representar listas de datos con <code>[]</code> y esa posibilidad no existe aquí. </p>
<p>Nótese que, al contrario que en las bases de datos relacionales <strong>no existe un <em>esquema</em> inicial</strong> que restrinja el formato de los datos. Mientras se respete la estructura básica de pares clave/valor los datos tienen un formato libre. Por ejemplo no necesariamente tendríamos que tener propiedad "nombre" para todas las personas de la BD, o podríamos tener alguna propiedad más para algunas personas sí y para otras no.</p>
<p>Al no existir tablas ni relaciones entre ellas, la forma más habitual de representar las relaciones entre datos es "embeber" unos datos dentro de otros. Por ejemplo:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;personas&quot;</span> <span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;ems21&quot;</span> <span class="p">:</span> <span class="p">{</span>
      <span class="nt">&quot;apellidos&quot;</span> <span class="p">:</span> <span class="s2">&quot;Marín Salgado&quot;</span><span class="p">,</span>
      <span class="nt">&quot;nombre&quot;</span> <span class="p">:</span> <span class="s2">&quot;Eva&quot;</span><span class="p">,</span>
      <span class="nt">&quot;mensajes&quot;</span> <span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;m1&quot;</span> <span class="p">:</span> <span class="p">{</span>
          <span class="nt">&quot;texto&quot;</span> <span class="p">:</span> <span class="s2">&quot;Hola amigos&quot;</span><span class="p">,</span>
          <span class="nt">&quot;timestamp&quot;</span> <span class="p">:</span> <span class="mi">19029898493</span>
        <span class="p">},</span>
        <span class="nt">&quot;m2&quot;</span> <span class="p">:</span> <span class="p">{</span>
          <span class="nt">&quot;texto&quot;</span> <span class="p">:</span> <span class="s2">&quot;¿No me contesta nadie? :(&quot;</span><span class="p">,</span>
          <span class="nt">&quot;timestamp&quot;</span> <span class="p">:</span> <span class="mi">20458569556</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">},</span>
    <span class="nt">&quot;jap2&quot;</span> <span class="p">:</span> <span class="p">{</span>
      <span class="nt">&quot;apellidos&quot;</span> <span class="p">:</span> <span class="s2">&quot;Arriquitaun Pérez&quot;</span><span class="p">,</span>
      <span class="nt">&quot;direccion&quot;</span> <span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;calle&quot;</span> <span class="p">:</span> <span class="s2">&quot;Pez, 25&quot;</span><span class="p">,</span>
        <span class="nt">&quot;localidad&quot;</span> <span class="p">:</span> <span class="s2">&quot;Madrid&quot;</span>
      <span class="p">},</span>
      <span class="nt">&quot;mensajes&quot;</span> <span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;m3&quot;</span> <span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;texto&quot;</span><span class="p">:</span> <span class="s2">&quot;Hola, sí!!&quot;</span>
            <span class="s2">&quot;timestamp&quot;</span> <span class="p">:</span> <span class="mi">21020129382</span>
        <span class="p">}</span>
      <span class="p">},</span>
      <span class="nt">&quot;nombre&quot;</span> <span class="p">:</span> <span class="s2">&quot;Juan&quot;</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>

<p>En el código anterior podemos ver algunos de ejemplos de lo que en bases de datos relaciones serían precisamente relaciones. Por un lado una relación 1:1 entre "persona" y "direccion", que se reperesenta aquí con la propiedad compuesta "direccion" dentro de la persona. Por otro lado una relación 1:N entre "persona" y "mensajes", que se representa de la misma forma, guardando los "mensajes" dentro de la "persona".</p>
<p>El problema de las estructuras de datos anidadas es a la hora de sacar la información de la BD. Como veremos, con Firebase podemos listar y filtrar de forma sencilla todos los nodos hijos de un nodo dado (por ejemplo <em>obtener todos los mensajes de la persona "ems21" ordenados por timestamp</em>). El problema lo tendríamos si quisiéramos obtener una lista de todos los mensajes independientemente de quién los ha enviado, que con la estructura de datos anterior requeriría ejecutar una consulta por cada usuario para finalmente unir todos los resultados y ordenarlos.</p>
<p>Este problema se puede resolver <em>desnormalizando</em> los datos, es decir, duplicando la información. Además de la estructura anterior podríamos tener repetidos por otro lado todos los mensajes dentro de un nodo "mensajes" independientemente de quién los haya enviado:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;personas&quot;</span> <span class="p">:</span> <span class="p">{</span>
    <span class="err">//Igual</span> <span class="err">que</span> <span class="err">antes,</span> <span class="err">personas</span> <span class="err">con</span> <span class="err">sus</span> <span class="err">mensajes</span>
  <span class="p">}</span>
  <span class="s2">&quot;mensajes&quot;</span> <span class="p">:</span> <span class="p">{</span>
    <span class="err">//Aquí</span> <span class="err">todos</span> <span class="err">los</span> <span class="err">mensajes</span> <span class="err">de</span> <span class="err">todos</span> <span class="err">los</span> <span class="err">usuarios</span>
  <span class="p">}</span>

<span class="p">}</span>
</pre></div>
</td></tr></table>

<h3 id="referencias">Referencias<a class="headerlink" href="#referencias" title="Permanent link">&para;</a></h3>
<p>Un concepto fundamental y necesario para poder leer y escribir datos es el de <em>referencia</em>. Una <em>referencia</em> representa un nodo del árbol de datos. Con los métodos del API podemos obtener directamente una referencia a un nodo cualquiera si conocemos su <em>path</em> desde la raíz. O bien podemos partir de una referencia que ya tengamos a un nodo y movernos a uno de sus hijos. Una vez obtenida la referencia al nodo que nos interesa, podremos leer su estado/modificarlo con otros métodos del API.</p>
<p>Por ejemplo supongamos que tenemos la estructura de datos en Firebase que vimos en el apartado anterior.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="p">{</span>
    <span class="nt">&quot;personas&quot;</span> <span class="p">:</span> <span class="p">{</span>
        <span class="nt">&quot;jap2&quot;</span> <span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;nombre&quot;</span> <span class="p">:</span> <span class="s2">&quot;Juan&quot;</span><span class="p">,</span>
            <span class="nt">&quot;apellidos&quot;</span><span class="p">:</span> <span class="s2">&quot;Arriquitaun Pérez&quot;</span>
        <span class="p">},</span>
        <span class="nt">&quot;ems21&quot;</span> <span class="p">:</span> <span class="p">{</span>
            <span class="nt">&quot;nombre&quot;</span> <span class="p">:</span> <span class="s2">&quot;Eva&quot;</span><span class="p">,</span>
            <span class="nt">&quot;apellidos&quot;</span><span class="p">:</span> <span class="s2">&quot;Marín Salgado&quot;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>

<p>Para obtener una referencia a un nodo, lo primero es obtener la base de datos en sí, a la que accedemos con <code>Database.database()</code>. A partir de aquí:</p>
<ul>
<li>El nodo raíz lo podemos obtener con <code>reference()</code>, y podemos ir bajando por los hijos con <code>child()</code>, por ejemplo:</li>
</ul>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1">//El árbol completo, dicho de otro modo el nodo raíz</span>
<span class="kd">let</span> <span class="nv">rootRef</span> <span class="p">=</span> <span class="n">Database</span><span class="p">.</span><span class="n">database</span><span class="p">().</span><span class="n">reference</span><span class="p">()</span>
<span class="c1">//El nodo &quot;personas&quot;</span>
<span class="kd">let</span> <span class="nv">personasRef</span> <span class="p">=</span> <span class="n">rootRef</span><span class="p">.</span><span class="n">child</span><span class="p">(</span><span class="s">&quot;personas&quot;</span><span class="p">)</span>
<span class="c1">//El nodo &quot;nombre&quot; perteneciente a &quot;jap2&quot;</span>
<span class="kd">let</span> <span class="nv">nombreRef</span> <span class="p">=</span> <span class="n">personasRef</span><span class="p">.</span><span class="n">child</span><span class="p">(</span><span class="s">&quot;jap2&quot;</span><span class="p">).</span><span class="n">child</span><span class="p">(</span><span class="s">&quot;nombre&quot;</span><span class="p">)</span>
</pre></div>
</td></tr></table>

<ul>
<li>También podemos acceder a un nodo con su <em>path</em> desde el nodo raíz, para ello usamos el método <code>reference(withPath:)</code>, por ejemplo:</li>
</ul>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kd">let</span> <span class="nv">db</span> <span class="p">=</span> <span class="n">Database</span><span class="p">.</span><span class="n">database</span><span class="p">()</span>
<span class="c1">//El nodo &quot;nombre&quot; perteneciente a &quot;jap2&quot;</span>
<span class="kd">let</span> <span class="nv">nombreRef</span> <span class="p">=</span> <span class="n">db</span><span class="p">.</span><span class="n">reference</span><span class="p">(</span><span class="n">withPath</span><span class="p">:</span><span class="s">&quot;personas/jap2/nombre&quot;</span><span class="p">)</span>
</pre></div>
</td></tr></table>

<p>Nótese que podemos obtener una referencia a un nodo aunque este no exista todavía en la base de datos. Por ejemplo, esto sería válido en el ejemplo que estamos siguiendo, aunque en la BD no hay nada relativo a pedidos:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kd">let</span> <span class="nv">ref</span> <span class="p">=</span> <span class="n">db</span><span class="p">.</span><span class="n">reference</span><span class="p">(</span><span class="n">withPath</span><span class="p">(</span><span class="s">&quot;pedidos/1&quot;</span><span class="p">))</span>
</pre></div>
</td></tr></table>

<p>Esto nos permitirá crear un nuevo pedido cuyos datos sean hijos del nodo "pedidos/1" sin necesidad de haber creado previamente los nodos intermedios.</p>
<h3 id="crear-y-actualizar-datos">Crear y actualizar datos<a class="headerlink" href="#crear-y-actualizar-datos" title="Permanent link">&para;</a></h3>
<p>Para <strong>modificar un nodo</strong> usamos <code>setValue(&lt;nuevovalor&gt;)</code> sobre su referencia. Este método es destructivo, ya que sustituye completamente el valor actual del nodo, incluso aunque este tenga otros nodos hijos. Por ejemplo:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kd">let</span> <span class="nv">db</span> <span class="p">=</span> <span class="n">Database</span><span class="p">.</span><span class="n">database</span><span class="p">()</span>
<span class="kd">let</span> <span class="nv">nombreRef</span> <span class="p">=</span> <span class="n">db</span><span class="p">.</span><span class="n">reference</span><span class="p">(</span><span class="n">withPath</span><span class="p">:</span><span class="s">&quot;personas/jap2/nombre&quot;</span><span class="p">)</span>
<span class="c1">//El nombre cambia de Juan a John</span>
<span class="n">nombreRef</span><span class="p">.</span><span class="n">setValue</span><span class="p">(</span><span class="s">&quot;John&quot;</span><span class="p">)</span>
<span class="c1">//CUIDADO, sustituye el valor de &quot;personas&quot;, con todo lo que hay por debajo</span>
<span class="kd">let</span> <span class="nv">personasRef</span> <span class="p">=</span> <span class="n">db</span><span class="p">.</span><span class="n">reference</span><span class="p">(</span><span class="n">withPath</span><span class="p">:</span><span class="s">&quot;personas&quot;</span><span class="p">)</span>
<span class="n">personasRef</span><span class="p">.</span><span class="n">setValue</span><span class="p">(</span><span class="s">&quot;La que has liao, pollito&quot;</span><span class="p">)</span>
</pre></div>
</td></tr></table>

<p>Nótese que el segundo cambio modifica el valor de un nodo compuesto, sustituyendo todo lo que hay "por debajo", así que el árbol quedaría</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="p">{</span>
    <span class="s">&quot;personas&quot;</span> <span class="p">:</span> <span class="s">&quot;La que has liao, pollito&quot;</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>

<p>También podemos <strong>crear un nodo aunque los nodos intermedios no existan</strong></p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kc">self</span><span class="p">.</span><span class="n">db</span> <span class="p">=</span> <span class="n">Database</span><span class="p">.</span><span class="n">database</span><span class="p">()</span>
<span class="c1">//Este nodo no existe, pero vamos a usar la referencia para crear un valor</span>
<span class="kd">let</span> <span class="nv">mlmj15</span> <span class="p">=</span> <span class="n">db</span><span class="p">.</span><span class="n">reference</span><span class="p">(</span><span class="n">withPath</span><span class="p">:</span> <span class="s">&quot;personas/mlmj15&quot;</span><span class="p">)</span>
<span class="n">mlmj15</span><span class="p">.</span><span class="n">setValue</span><span class="p">([</span><span class="s">&quot;nombre&quot;</span><span class="p">:</span><span class="s">&quot;María Luisa&quot;</span><span class="p">,</span> <span class="s">&quot;apellidos&quot;</span><span class="p">:</span><span class="s">&quot;Marín Juárez&quot;</span><span class="p">])</span>
</pre></div>
</td></tr></table>

<p>El resultado sería:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;personas&quot;</span> <span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;mlmj15&quot;</span> <span class="p">:</span> <span class="p">{</span>
      <span class="nt">&quot;apellidos&quot;</span> <span class="p">:</span> <span class="s2">&quot;Marín Juárez&quot;</span><span class="p">,</span>
      <span class="nt">&quot;nombre&quot;</span> <span class="p">:</span> <span class="s2">&quot;María Luisa&quot;</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>

<p>En los ejemplos anteriores hemos asignado un nuevo valor que es un dato primitivo, pero también podría ser <strong>asignar un valor compuesto, basta con pasar un diccionario</strong>. Por ejemplo, Podríamos cambiar los datos de "mlmj15" con:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kd">let</span> <span class="nv">db</span> <span class="p">=</span> <span class="n">Database</span><span class="p">.</span><span class="n">database</span><span class="p">()</span>
<span class="kd">let</span> <span class="nv">ref</span> <span class="p">=</span> <span class="n">db</span><span class="p">.</span><span class="n">reference</span><span class="p">(</span><span class="n">withPath</span><span class="p">:</span><span class="s">&quot;personas/mlmj15&quot;</span><span class="p">)</span>
<span class="n">ref</span><span class="p">.</span><span class="n">setValue</span><span class="p">([</span><span class="s">&quot;nombre&quot;</span><span class="p">:</span><span class="s">&quot;Mari Loli&quot;</span><span class="p">,</span> <span class="s">&quot;apellidos&quot;</span><span class="p">:</span><span class="s">&quot;Martínez Jaén&quot;</span><span class="p">])</span>
</pre></div>
</td></tr></table>

<p><strong>En lugar de sobreescribir totalmente un nodo podemos actualizar solo algunas de sus propiedades</strong> con <code>updateChildValues</code></p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kd">let</span> <span class="nv">db</span> <span class="p">=</span> <span class="n">Database</span><span class="p">.</span><span class="n">database</span><span class="p">()</span>
<span class="kd">let</span> <span class="nv">ref</span> <span class="p">=</span> <span class="n">db</span><span class="p">.</span><span class="n">reference</span><span class="p">(</span><span class="n">withPath</span><span class="p">:</span><span class="s">&quot;personas/mlmj15&quot;</span><span class="p">)</span>
<span class="n">ref</span><span class="p">.</span><span class="n">updateChildValues</span><span class="p">([</span><span class="s">&quot;nombre&quot;</span><span class="p">:</span><span class="s">&quot;M.L.&quot;</span><span class="p">])</span>
</pre></div>
</td></tr></table>

<p>En este ejemplo estamos usando un identificador generado manualmente para cada persona, pero en muchos casos necesitaremos generar el identificador automáticamente. Podemos hacerlo con <code>childByAutoId</code>.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kd">let</span> <span class="nv">db</span> <span class="p">=</span> <span class="n">Database</span><span class="p">.</span><span class="n">database</span><span class="p">()</span>
<span class="kd">let</span> <span class="nv">personasRef</span> <span class="p">=</span> <span class="n">db</span><span class="p">.</span><span class="n">reference</span><span class="p">(</span><span class="n">withPath</span><span class="p">:</span><span class="s">&quot;personas&quot;</span><span class="p">)</span>
<span class="kd">let</span> <span class="nv">nuevoIdRef</span> <span class="p">=</span> <span class="n">personasRef</span><span class="p">.</span><span class="n">childByAutoId</span><span class="p">()</span>
<span class="n">nuevoIdRef</span><span class="p">.</span><span class="n">setValue</span><span class="p">([</span><span class="s">&quot;nombre&quot;</span><span class="p">:</span><span class="s">&quot;Luis Ricardo&quot;</span><span class="p">,</span> <span class="s">&quot;apellidos&quot;</span><span class="p">:</span><span class="s">&quot;Borriquero&quot;</span><span class="p">])</span>
</pre></div>
</td></tr></table>

<p>quedando algo como:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="p">{</span>
  <span class="nt">&quot;personas&quot;</span> <span class="p">:</span> <span class="p">{</span>
    <span class="nt">&quot;L33iv1bhzKkFkQd_ff4&quot;</span> <span class="p">:</span> <span class="p">{</span>
      <span class="nt">&quot;apellidos&quot;</span> <span class="p">:</span> <span class="s2">&quot;Borriquero&quot;</span><span class="p">,</span>
      <span class="nt">&quot;nombre&quot;</span> <span class="p">:</span> <span class="s2">&quot;Luis Ricardo&quot;</span>
    <span class="p">},</span>
    <span class="err">...</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>

<p>El algoritmo de generación de ids asegura que no va a haber colisiones entre los identificadores generados por los distintos clientes. Además el <em>id</em> incluye un <em>timestamp</em>, de modo que si ordenamos por <em>id</em> estamos ordenando implícitamente por orden de inserción en la base de datos.</p>
<p>Finalmente, podemos <strong>borrar datos</strong> con <code>removeValue()</code>. También podríamos hacer <code>setValue(nil)</code>, o poner a <code>nil</code> alguna propiedad en <code>updateChildValues</code>.</p>
<h3 id="consultas">Consultas<a class="headerlink" href="#consultas" title="Permanent link">&para;</a></h3>
<p>La <em>realtime Database</em>, como su propio nombre indica, tiene funcionalidades apropiadas para aplicaciones que necesitan datos en tiempo real. En concreto <strong>podemos <em>escuchar</em> los cambios en los datos</strong>. Como luego veremos podemos usar este API también para hacer consultas al estilo más clásico, que simplemente devuelvan el estado actual de la BD.</p>
<p>Para observar los cambios en los datos de un nodo, incluyendo también todos los nodos que hay "por debajo", podemos usar <code>observe(_,withBlock:)</code>, donde el último parámetro es una clausura a ejecutar cuando se produzca el evento. Por ejemplo:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kd">let</span> <span class="nv">db</span> <span class="p">=</span> <span class="n">Database</span><span class="p">.</span><span class="n">database</span><span class="p">()</span>
<span class="kd">let</span> <span class="nv">personasRef</span> <span class="p">=</span> <span class="n">db</span><span class="p">.</span><span class="n">reference</span><span class="p">(</span><span class="n">withPath</span><span class="p">:</span><span class="s">&quot;personas&quot;</span><span class="p">)</span>
<span class="n">personasRef</span><span class="p">.</span><span class="n">observe</span><span class="p">(.</span><span class="n">value</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">snapshot</span> <span class="k">in</span>
    <span class="bp">print</span><span class="p">(</span><span class="s">&quot;Algo ha cambiado en </span><span class="si">\(</span><span class="n">snapshot</span><span class="p">.</span><span class="n">value</span><span class="si">)</span><span class="s">&quot;</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>

<p>El parámetro de la clausura es un objeto de tipo <code>DataSnapshot</code>, que representa un <em>snapshot</em> de un fragmento de datos en un determinado momento.</p>
<blockquote>
<p>Hay que llevar cuidado con el nivel en el que estamos escuchando, ya que se detectará cualquier cambio en los niveles que hay por debajo y esto puede ser costoso para los niveles superiores del árbol.</p>
</blockquote>
<p>La clausura se llamará una vez con el valor actual de la BD y a partir de ese momento, de nuevo cada vez que se produzca un cambio. Para dejar de "escuchar" los cambios podemos usar <code>removeObserverWithHandle()</code>. A este método hay que pasarle el <em>handle</em> del listener creado por <code>observe</code>. Este <em>handle</em> lo devuelve el método <em>observe</em>, aunque en el ejemplo anterior hemos ignorado el valor. De modo que haríamos algo como:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="p">...</span>
<span class="c1">//añadimos el &quot;listener&quot; y nos guardamos el handle</span>
<span class="kd">let</span> <span class="nv">handle</span> <span class="p">=</span> <span class="n">personasRef</span><span class="p">.</span><span class="n">observe</span><span class="p">(.</span><span class="n">value</span><span class="p">)</span> <span class="p">{</span>
    <span class="p">...</span>
<span class="p">}</span>
<span class="c1">//eliminamos el &quot;listener&quot; anterior usando el handle</span>
<span class="n">personasRef</span><span class="p">.</span><span class="n">removeObserver</span><span class="p">(</span><span class="n">withHandle</span><span class="p">:</span> <span class="n">handle</span><span class="p">)</span>
<span class="c1">//también podríamos hacer esto para eliminar todos los listener sobre personasRef</span>
<span class="n">personasRef</span><span class="p">.</span><span class="n">removeAllObservers</span><span class="p">()</span>
</pre></div>
</td></tr></table>

<p>Podemos escuchar otros eventos, no solo los cambios de valor. En concreto, podemos saber cuándo ha cambiado algún hijo de un nodo dado (ha sido añadido, modificado o borrado). En ese caso el <em>snapshot</em> solo contendrá el nodo que ha cambiado. Por ejemplo, así podríamos saber si ha sido insertado un nuevo nodo que sea hijo del nodo "personas":</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kc">self</span><span class="p">.</span><span class="n">db</span> <span class="p">=</span> <span class="n">Database</span><span class="p">.</span><span class="n">database</span><span class="p">()</span>
<span class="kd">let</span> <span class="nv">personasRef</span> <span class="p">=</span> <span class="n">db</span><span class="p">.</span><span class="n">reference</span><span class="p">(</span><span class="n">withPath</span><span class="p">:</span><span class="s">&quot;personas&quot;</span><span class="p">)</span>
<span class="n">personasRef</span><span class="p">.</span><span class="n">observe</span><span class="p">(.</span><span class="n">childAdded</span><span class="p">)</span> <span class="p">{</span>
   <span class="n">snapshot</span> <span class="k">in</span>
   <span class="bp">print</span><span class="p">(</span><span class="s">&quot;</span><span class="si">\(</span><span class="n">snapshot</span><span class="p">.</span><span class="n">key</span><span class="si">)</span><span class="s">=</span><span class="si">\(</span><span class="n">snapshot</span><span class="p">.</span><span class="n">value</span><span class="si">)</span><span class="s">&quot;</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>

<p>También podemos hacer consultas más clásicas, en las que simplemente queremos conocer el estado actual de la base de datos pero no nos interesan los sucesivos cambios. Podemos hacerlo sustituyendo <code>observe</code> por <code>observeSingleEvent</code>. Por lo demás el código es igual:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kc">self</span><span class="p">.</span><span class="n">db</span> <span class="p">=</span> <span class="n">Database</span><span class="p">.</span><span class="n">database</span><span class="p">()</span>
<span class="kd">let</span> <span class="nv">personasRef</span> <span class="p">=</span> <span class="n">db</span><span class="p">.</span><span class="n">reference</span><span class="p">(</span><span class="n">withPath</span><span class="p">:</span><span class="s">&quot;personas&quot;</span><span class="p">)</span>
<span class="n">personasRef</span><span class="p">.</span><span class="n">observeSingleEvent</span><span class="p">(.</span><span class="n">childAdded</span><span class="p">)</span> <span class="p">{</span>
   <span class="n">snapshot</span> <span class="k">in</span>
   <span class="bp">print</span><span class="p">(</span><span class="s">&quot;</span><span class="si">\(</span><span class="n">snapshot</span><span class="p">.</span><span class="n">key</span><span class="si">)</span><span class="s">=</span><span class="si">\(</span><span class="n">snapshot</span><span class="p">.</span><span class="n">value</span><span class="si">)</span><span class="s">&quot;</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../2_gestion_usuarios/" title="Gestión de usuarios en Firebase" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Anterior
                </span>
                Gestión de usuarios en Firebase
              </span>
            </div>
          </a>
        
        
          <a href="../4_ejercicios/" title="Ejercicios" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Siguiente
                </span>
                Ejercicios
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application.ac79c3b0.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:"../.."}})</script>
      
    
  </body>
</html>
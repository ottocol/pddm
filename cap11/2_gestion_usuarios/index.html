
<!doctype html>
<html lang="es" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.2.2, mkdocs-material-7.3.2">
    
    
      
        <title>2 gestion usuarios - PDDM-iOS</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.24c991ad.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.3f5d1f46.min.css">
        
          
          
          <meta name="theme-color" content="#009485">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style>
      
    
    
    
    
      


    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="teal" data-md-color-accent="teal">
  
    
    <script>function __prefix(e){return new URL("../..",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#anadir-autentificacion-a-una-app-de-firebase" class="md-skip">
          Saltar a contenido
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Cabecera">
    <a href="../.." title="PDDM-iOS" class="md-header__button md-logo" aria-label="PDDM-iOS" data-md-component="logo">
      
  <img src="../../logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            PDDM-iOS
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              2 gestion usuarios
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Búsqueda" placeholder="Búsqueda" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Limpiar" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Inicializando búsqueda
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navegación" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="PDDM-iOS" class="md-nav__button md-logo" aria-label="PDDM-iOS" data-md-component="logo">
      
  <img src="../../logo.png" alt="logo">

    </a>
    PDDM-iOS
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1" type="checkbox" id="__nav_1" >
      
      
      
      
        <label class="md-nav__link" for="__nav_1">
          Persistencia básica
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Persistencia básica" data-md-level="1">
        <label class="md-nav__title" for="__nav_1">
          <span class="md-nav__icon md-icon"></span>
          Persistencia básica
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cap1/1.0_introduccion/" class="md-nav__link">
        Introducción
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cap1/1.1_sistema_de_archivos/" class="md-nav__link">
        Sistema de archivos
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cap1/1.2_serializacion/" class="md-nav__link">
        Serialización
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cap1/1.3_property_lists/" class="md-nav__link">
        Property lists
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cap1/1.4_preferencias/" class="md-nav__link">
        Preferencias
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2">
          ¡Hola Core Data!. Una aplicación de ejemplo
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="¡Hola Core Data!. Una aplicación de ejemplo" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          ¡Hola Core Data!. Una aplicación de ejemplo
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cap3/3.1_intro/" class="md-nav__link">
        Introducción a Core Data
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cap3/3.2_stack/" class="md-nav__link">
        Crear el stack de Core Data en iOS
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cap3/3.3_entidades/" class="md-nav__link">
        Ejercicio parte I. almacenar datos
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cap3/3.4_recuperar_datos/" class="md-nav__link">
        Ejercicio parte II. recuperar los datos
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cap3/apendice_ver_almacenamiento/" class="md-nav__link">
        Apéndice. Cómo examinar el almacenamiento persistente
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3">
          Modelos de datos en Core Data
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Modelos de datos en Core Data" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Modelos de datos en Core Data
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cap4/4.1_crear_modelo/" class="md-nav__link">
        Crear y editar modelos
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cap4/4.2_clases_propias/" class="md-nav__link">
        Modelar las entidades en código Swift
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cap4/4.3_CRUD/" class="md-nav__link">
        CRUD en Core Data
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cap4/4.4_validaciones/" class="md-nav__link">
        Validaciones
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cap4/4.5_transformables/" class="md-nav__link">
        Transformables
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cap4/4.6_ejercicios/" class="md-nav__link">
        Ejercicios de modelos de datos
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" >
      
      
      
      
        <label class="md-nav__link" for="__nav_4">
          Búsquedas en Core Data
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Búsquedas en Core Data" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Búsquedas en Core Data
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cap6/1_predicados/" class="md-nav__link">
        Predicados
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cap6/2_ordenacion/" class="md-nav__link">
        Ordenación
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cap6/3_ejercicios/" class="md-nav__link">
        Ejercicios
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" type="checkbox" id="__nav_5" >
      
      
      
      
        <label class="md-nav__link" for="__nav_5">
          Tablas en Core Data
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Tablas en Core Data" data-md-level="1">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          Tablas en Core Data
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cap7/1_el_frc/" class="md-nav__link">
        El "fetched results controller"
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cap7/2_configuracion_basica/" class="md-nav__link">
        Inicializar el "fetched results controller"
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cap7/3_tabla/" class="md-nav__link">
        Mostrar los datos en la tabla
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cap7/4_refrescar_tabla/" class="md-nav__link">
        Refrescar la tabla
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cap7/5_secciones/" class="md-nav__link">
        Secciones de tabla automáticas
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cap7/6_ejercicios/" class="md-nav__link">
        Ejercicios
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6" type="checkbox" id="__nav_6" >
      
      
      
      
        <label class="md-nav__link" for="__nav_6">
          Miniproyecto
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Miniproyecto" data-md-level="1">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          Miniproyecto
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../miniproyecto/restaurante/" class="md-nav__link">
        Enunciado
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Tabla de contenidos">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Tabla de contenidos
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#anadir-autentificacion-a-una-app-de-firebase" class="md-nav__link">
    Añadir autentificación a una app de Firebase
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#administracion-de-usuarios" class="md-nav__link">
    Administración de usuarios
  </a>
  
    <nav class="md-nav" aria-label="Administración de usuarios">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#dar-de-alta-usuarios" class="md-nav__link">
    Dar de alta usuarios
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#validar-el-alta-de-un-usuario" class="md-nav__link">
    Validar el alta de un usuario
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#modificar-el-perfil-de-un-usuario" class="md-nav__link">
    Modificar el perfil de un usuario
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dar-de-baja-a-un-usuario" class="md-nav__link">
    Dar de baja a un usuario
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#autentificacion" class="md-nav__link">
    Autentificación
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
                
                  <h1>2 gestion usuarios</h1>
                
                <p>La gran mayoría de aplicaciones tiene que gestionar datos de usuarios y autentificarlos para poder realizar ciertas operaciones. Típicamente vamos a tener que:</p>
<ul>
<li>Implementar un CRUD de usuarios, para poder darlos de alta, de baja y que puedan modificar sus datos de perfil.</li>
<li>Implementar funcionalidades de login/logout para que el usuario se pueda autentificar en la aplicación y así tenga acceso a las funcionalidades que la requieran.</li>
</ul>
<p>Firebase cubre los dos tipos de funcionalidades. Además no solo vamos a poder gestionar usuarios dándolos de alta en la aplicación con login y password, sino que también nos permite autentificación con credenciales externas, o <em>identidad federada</em>: el usuario puede identificarse en nuestra <em>app</em> con su login de otros sitios como Facebook, Twitter o Google, con lo que se evita tener que crearse un nuevo usuario/contraseña solo para nuestra aplicación.</p>
<h2 id="anadir-autentificacion-a-una-app-de-firebase">Añadir autentificación a una app de Firebase<a class="headerlink" href="#anadir-autentificacion-a-una-app-de-firebase" title="Permanent link">&para;</a></h2>
<p>Las funcionalidades de usuarios están en el módulo <code>auth</code>. Si usamos Cocoapods para gestionar las dependencias, tendremos que añadir la siguiente dependencia al <code>Podfile</code></p>
<div class="highlight"><pre><span></span><code>pod <span class="s1">&#39;Firebase/Auth&#39;</span>
</code></pre></div>
<p>tras ello, ejecutar en la consola <code>pod install</code>.</p>
<p>Para poder llamar a este API en nuestro código necesitaremos un </p>
<div class="highlight"><pre><span></span><code><span class="kd">import</span> <span class="nc">Firebase</span>
</code></pre></div>
<p>Podéis consultar <em>online</em> y traducida al español la <a href="https://firebase.google.com/docs/auth/ios/start">documentación de las librerías de iOS</a> para gestión de usuarios y autentificación.</p>
<h2 id="administracion-de-usuarios">Administración de usuarios<a class="headerlink" href="#administracion-de-usuarios" title="Permanent link">&para;</a></h2>
<p>Los usuarios en Firebase tienen una serie de propiedades básicas: un <em>id</em> único, una dirección de correo electrónico, un nombre y la URL de su foto de perfil. Todos los usuarios tienen estos datos, aunque podemos simplemente ignorar alguno en nuestra <em>app</em> (por ejemplo la URL). A los objetos usuario no se les pueden añadir más propiedades, si necesitamos más datos (fecha de nacimiento, sexo, e-mail secundario,...) tendremos que almacenarlos aparte en la base de datos de Firebase.</p>
<p>Aunque Firebase permite que los usuarios puedan autentificarse con credenciales de Google, Facebook, Twitter, ... aquí solo veremos la autentificación con contraseña, es decir, los usuarios van a darse de alta en nuestra <em>app</em> y elegir un login (que debe ser su <em>email</em>) y un <em>password</em>. <em>passwors</em> no lo podremos consultar desde nuestra <em>app</em>, solo modificar). Para ver cómo autentificarse con identidades federadas, consultar la <a href="https://firebase.google.com/docs/auth/ios/start#next_steps">documentación de Firebase</a></p>
<p>Como veremos, la mayoría de métodos del API son asíncronos, ya que requieren de interacción con el servidor y hacerlos síncronos bloquearía la <em>app</em> hasta que este respondiera. Los métodos asíncronos del API tienen como último parámetro  una clausura que se ejecutará cuando el servidor complete la operación. </p>
<p>La clausura a ejecutar recibe como parámetro un error en caso de haberse producido alguno, y además en algunos métodos recibe un parámetro adicional con el resultado de la operación si ha sido exitoso.</p>
<h3 id="dar-de-alta-usuarios">Dar de alta usuarios<a class="headerlink" href="#dar-de-alta-usuarios" title="Permanent link">&para;</a></h3>
<p>Para <strong>dar de alta un usuario</strong> llamaremos al método <code>createUser(withEmail:,password:,completion:)</code>. Es un método asíncrono, su último parámetro es una clausura que se ejecutará cuando se complete en el servidor el proceso de registro. Como ya se ha dicho esta clausura recibe como parámetro el error producido, si lo hay. Si no ha habido error, además como primer parámetro se recibe un objeto de tipo <code>AuthDataResult</code> con el resultado de la operación. Dentro de este objeto el campo <code>user</code> contiene información sobre el usuario recién creado. </p>
<p>Por ejemplo:</p>
<div class="highlight"><pre><span></span><code><span class="n">Auth</span><span class="p">.</span><span class="n">auth</span><span class="p">().</span><span class="n">createUser</span><span class="p">(</span><span class="n">withEmail</span><span class="p">:</span> <span class="n">email</span><span class="p">,</span> <span class="n">password</span><span class="p">:</span> <span class="n">password</span><span class="p">)</span> <span class="p">{</span> 
    <span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span> <span class="k">in</span>
    <span class="k">if</span> <span class="kd">let</span> <span class="nv">error</span> <span class="p">=</span> <span class="n">error</span> <span class="p">{</span>
        <span class="bp">print</span><span class="p">(</span><span class="s">&quot;Error&quot;</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="p">{</span>
        <span class="bp">print</span><span class="p">(</span><span class="s">&quot;Dado de alta usuario con email: </span><span class="si">\(</span><span class="n">result</span><span class="p">?.</span><span class="n">user</span><span class="p">.</span><span class="n">email</span><span class="p">!</span><span class="si">)</span><span class="s">&quot;</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>Como es lógico, antes de poder llamar a este método tenemos que haber hecho algún formulario para que el usuario rellene sus datos, pedirle dos veces la contraseña para chequear errores, etc. Esto es tarea nuestra y de ello no se va a ocupar <code>createUser</code>. Llamaremos a este método solo cuando hayamos validado que los datos introducidos por el usuario son correctos (que el email no está vacío y tiene un formato adecuado, que los dos <em>passwords</em> del formulario coinciden, ...).</p>
<blockquote>
<p>Como crear las pantallas de alta, login, etc es un proceso tedioso, en Firebase existe un módulo denominado <code>FirebaseUI</code> que implementa la interfaz de las operaciones más comunes. Podéis consultar más información en la <a href="https://firebase.google.com/docs/auth/ios/firebaseui">documentación de Firebase</a>.</p>
</blockquote>
<p>Nótese además que el <code>createUser</code> solo rellena los datos más básicos, para rellenar el resto de datos usaremos la funcionalidad de actualizar perfil.</p>
<h3 id="validar-el-alta-de-un-usuario">Validar el alta de un usuario<a class="headerlink" href="#validar-el-alta-de-un-usuario" title="Permanent link">&para;</a></h3>
<p>En muchos sitios web cuando un usuario se da de alta se le envía por email un <em>link</em> para que confirme el registro. En Firebase podemos hacer esto con el método <code>sendEmailVerification</code> del usuario actual. Este método pertenece al usuario autentificado .</p>
<p>Para obtener el usuario autentificado actualmente en la <em>app</em> accedemos a la propiedad <code>Auth.auth().currentUser</code>. Si es <code>nil</code> no hay ningún usuario autentificado.</p>
<div class="highlight"><pre><span></span><code><span class="n">Auth</span><span class="p">.</span><span class="n">auth</span><span class="p">().</span><span class="n">currentUser</span><span class="p">?.</span><span class="n">sendEmailVerification</span> <span class="p">{</span> <span class="p">(</span><span class="n">error</span><span class="p">)</span> <span class="k">in</span>
  <span class="c1">// ...</span>
<span class="p">}</span>
</code></pre></div>
<h3 id="modificar-el-perfil-de-un-usuario">Modificar el perfil de un usuario<a class="headerlink" href="#modificar-el-perfil-de-un-usuario" title="Permanent link">&para;</a></h3>
<p>Para modificar los datos de un usuario, el objeto usuario correspondiente debe llamar a <code>createProfileChangeRequest</code>, hacemos los cambios y finalmente llamamos a <code>commitChanges(completion:)</code>, que es asíncrono, y al que se le pasa una clausura a ejecutar cuando los cambios se hagan efectivos en el servidor. </p>
<div class="highlight"><pre><span></span><code><span class="kd">let</span> <span class="nv">changeRequest</span> <span class="p">=</span> <span class="n">Auth</span><span class="p">.</span><span class="n">auth</span><span class="p">().</span><span class="n">currentUser</span><span class="p">?.</span><span class="n">createProfileChangeRequest</span><span class="p">()</span>
<span class="n">changeRequest</span><span class="p">?.</span><span class="n">displayName</span> <span class="p">=</span> <span class="n">displayName</span>
<span class="n">changeRequest</span><span class="p">?.</span><span class="n">commitChanges</span> <span class="p">{</span> <span class="p">(</span><span class="n">error</span><span class="p">)</span> <span class="k">in</span>
  <span class="k">if</span> <span class="kd">let</span> <span class="nv">error</span> <span class="p">=</span> <span class="n">error</span> <span class="p">{</span>
     <span class="bp">print</span><span class="p">(</span><span class="s">&quot;Error: </span><span class="si">\(</span><span class="n">error</span><span class="si">)</span><span class="s">&quot;</span><span class="p">)</span>
  <span class="p">}</span> 
  <span class="k">else</span> <span class="p">{</span>
     <span class="bp">print</span><span class="p">(</span><span class="s">&quot;Perfil actualizado OK&quot;</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>Hay métodos individuales para actualizar el <em>email</em> y el <em>password</em>: <code>updateEmail</code> y <code>updatePassword</code>. Son métodos asíncronos, y como parámetro, además del nuevo valor, pasaremos una clausura a ejecutar cuando acabe la operación:</p>
<div class="highlight"><pre><span></span><code><span class="n">Auth</span><span class="p">.</span><span class="n">auth</span><span class="p">().</span><span class="n">currentUser</span><span class="p">?.</span><span class="n">updateEmail</span><span class="p">(</span><span class="n">to</span><span class="p">:</span> <span class="n">email</span><span class="p">)</span> <span class="p">{</span> <span class="p">(</span><span class="n">error</span><span class="p">)</span> <span class="k">in</span>
  <span class="c1">// ...</span>
<span class="p">}</span>
<span class="n">Auth</span><span class="p">.</span><span class="n">auth</span><span class="p">().</span><span class="n">currentUser</span><span class="p">?.</span><span class="n">updatePassword</span><span class="p">(</span><span class="n">to</span><span class="p">:</span> <span class="n">password</span><span class="p">)</span> <span class="p">{</span> <span class="p">(</span><span class="n">error</span><span class="p">)</span> <span class="k">in</span>
  <span class="c1">// ...</span>
<span class="p">}</span>
</code></pre></div>
<p>Por razones de seguridad, cuando un usuario cambia su dirección de correo electrónico, se le envía un <em>email</em> a la su dirección  para que pueda consultar el cambio. Se puede cambiar la plantilla que se usa para este email en la consola de Firebase, en el apartado: <code>Autenticación &gt; Plantillas</code>.</p>
<p>En lugar de actualizar el <em>password</em> directamente, podemos enviarle al usuario el típico mensaje de <em>resetear password</em>, con un enlace en el que se hace <em>clic</em> se saltará a una página (hecha por Google) con un formulario para cambiar el <em>password</em>.  </p>
<h3 id="dar-de-baja-a-un-usuario">Dar de baja a un usuario<a class="headerlink" href="#dar-de-baja-a-un-usuario" title="Permanent link">&para;</a></h3>
<p>Para borrar a un usuario, usamos <code>delete</code>, que de nuevo es un método asíncrono:</p>
<div class="highlight"><pre><span></span><code><span class="kd">let</span> <span class="nv">user</span> <span class="p">=</span> <span class="n">Auth</span><span class="p">.</span><span class="n">auth</span><span class="p">().</span><span class="n">currentUser</span>
<span class="n">user</span><span class="p">?.</span><span class="n">delete</span> <span class="p">{</span> <span class="n">error</span> <span class="k">in</span>
  <span class="k">if</span> <span class="kd">let</span> <span class="nv">error</span> <span class="p">=</span> <span class="n">error</span> <span class="p">{</span>
    <span class="bp">print</span><span class="p">(</span><span class="s">&quot;Error&quot;</span><span class="p">)</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="bp">print</span><span class="p">(</span><span class="s">&quot;Cuenta dada de baja&quot;</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<h2 id="autentificacion">Autentificación<a class="headerlink" href="#autentificacion" title="Permanent link">&para;</a></h2>
<p>Para <em>hacer login</em> en la aplicación, llamamos al método <code>signIn</code>, que como viene siendo habitual es asíncrono. Si la autentificación tiene éxito se devuelve un objeto de tipo <code>AuthDataResult</code> que contiene entre otros datos la referencia al usuario autentificado en su campo <code>user</code>.</p>
<div class="highlight"><pre><span></span><code><span class="n">Auth</span><span class="p">.</span><span class="n">auth</span><span class="p">().</span><span class="n">signIn</span><span class="p">(</span><span class="n">withEmail</span><span class="p">:</span> <span class="n">email</span><span class="p">,</span> <span class="n">password</span><span class="p">:</span> <span class="n">password</span><span class="p">)</span> <span class="p">{</span> 
  <span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span> <span class="k">in</span>
  <span class="k">if</span> <span class="kd">let</span> <span class="nv">error</span> <span class="p">=</span> <span class="n">error</span> <span class="p">{</span>
    <span class="bp">print</span><span class="p">(</span><span class="s">&quot;Error&quot;</span><span class="p">)</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="bp">print</span><span class="p">(</span><span class="s">&quot;Login de: </span><span class="si">\(</span><span class="n">result</span><span class="p">?.</span><span class="n">user</span><span class="p">.</span><span class="n">email</span><span class="p">!</span><span class="si">)</span><span class="s">&quot;</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>como ya hemos visto en el apartado anterior, para saber el usuario actual podemos acceder a <code>Auth.auth().currentUser</code>.</p>
<p>Hay que destacar que la "sesión" actual se guarda de manera persistente, así que si salimos de la aplicación y volvemos a entrar, el usuario seguirá estando activo hasta que cerremos explícitamente la sesión. Para cerrar la sesión, llamar al método <code>signOut</code>, que es síncrono:</p>
<div class="highlight"><pre><span></span><code><span class="k">do</span> <span class="p">{</span>
  <span class="k">try</span> <span class="n">Auth</span><span class="p">.</span><span class="n">auth</span><span class="p">().</span><span class="n">signOut</span><span class="p">()</span>
<span class="p">}</span> <span class="k">catch</span> <span class="kd">let</span> <span class="nv">signOutError</span> <span class="k">as</span> <span class="bp">NSError</span> <span class="p">{</span>
  <span class="bp">print</span><span class="p">(</span><span class="s">&quot;Error cerrando la sesión: </span><span class="si">\(</span><span class="n">signOutError</span><span class="si">)</span><span class="s">&quot;</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>
<p>Podemos detectar el <em>sign-in</em> y <em>sign-out</em> del usuario con <code>addStateDidChangeListener</code>. Le pasaremos una clausura que se ejecutará cuando se haga una de estas dos operaciones, es decir, es un <em>listener</em> del cambio de estado. Típicamente se usa para mostrar el estado actual en la interfaz de usuario, por lo que normalmente se añadirá el <em>listener</em> al mostrar la pantalla con los datos, es decir en el <code>viewWillAppear</code> del controlador de la vista:</p>
<div class="highlight"><pre><span></span><code><span class="c1">//donde &quot;handle&quot; sería una propiedad del view controller</span>
<span class="kc">self</span><span class="p">.</span><span class="n">handle</span> <span class="p">=</span> <span class="n">Auth</span><span class="p">.</span><span class="n">auth</span><span class="p">().</span><span class="n">addStateDidChangeListener</span> <span class="p">{</span> <span class="p">(</span><span class="n">auth</span><span class="p">,</span> <span class="n">user</span><span class="p">)</span> <span class="k">in</span>
  <span class="c1">// ...</span>
<span class="p">}</span>
</code></pre></div>
<p>El valor de retorno del método anterior se usa para eliminar el <em>listener</em>. Habitualmente el lugar más apropiado es cuando salimos de la pantalla, en el <code>viewWillDisappear</code>) del controlador de la vista:</p>
<p><code>`swift
Auth.auth().removeStateDidChangeListener(self.handle)</code></p>
                
              
              
                


              
            </article>
          </div>
        </div>
        
      </main>
      
        
<footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        
          Made with
          <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
            Material for MkDocs
          </a>
        
        
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../..", "features": [], "translations": {"clipboard.copy": "Copiar al portapapeles", "clipboard.copied": "Copiado al portapapeles", "search.config.lang": "es", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "B\u00fasqueda", "search.result.placeholder": "Teclee para comenzar b\u00fasqueda", "search.result.none": "No se encontraron documentos", "search.result.one": "1 documento encontrado", "search.result.other": "# documentos encontrados", "search.result.more.one": "1 m\u00e1s en esta p\u00e1gina", "search.result.more.other": "# m\u00e1s en esta p\u00e1gina", "search.result.term.missing": "Falta", "select.version.title": "Seleccionar versi\u00f3n"}, "search": "../../assets/javascripts/workers/search.e99e714c.min.js", "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.bc35569b.min.js"></script>
      
    
  </body>
</html>
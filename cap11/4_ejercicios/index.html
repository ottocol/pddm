
<!doctype html>
<html lang="es" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.4.1, mkdocs-material-8.5.6">
    
    
      
        <title>4 ejercicios - PDDM-iOS</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.20d9efc8.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.cbb835fc.min.css">
        
          
          
          <meta name="theme-color" content="#009485">
        
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="teal" data-md-color-accent="teal">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#loginlogout-05-puntos" class="md-skip">
          Saltar a contenido
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Cabecera">
    <a href="../.." title="PDDM-iOS" class="md-header__button md-logo" aria-label="PDDM-iOS" data-md-component="logo">
      
  <img src="../../logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            PDDM-iOS
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              4 ejercicios
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Búsqueda" placeholder="Búsqueda" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Limpiar" aria-label="Limpiar" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Inicializando búsqueda
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navegación" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="PDDM-iOS" class="md-nav__button md-logo" aria-label="PDDM-iOS" data-md-component="logo">
      
  <img src="../../logo.png" alt="logo">

    </a>
    PDDM-iOS
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1" type="checkbox" id="__nav_1" >
      
      
      
      
        <label class="md-nav__link" for="__nav_1">
          Persistencia básica
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Persistencia básica" data-md-level="1">
        <label class="md-nav__title" for="__nav_1">
          <span class="md-nav__icon md-icon"></span>
          Persistencia básica
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cap1/1.0_introduccion/" class="md-nav__link">
        Introducción
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cap1/1.1_sistema_de_archivos/" class="md-nav__link">
        Sistema de archivos
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cap1/1.2_serializacion/" class="md-nav__link">
        Serialización
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cap1/1.3_property_lists/" class="md-nav__link">
        Property lists
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cap1/1.4_preferencias/" class="md-nav__link">
        Preferencias
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2">
          ¡Hola Core Data!. Una aplicación de ejemplo
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="¡Hola Core Data!. Una aplicación de ejemplo" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          ¡Hola Core Data!. Una aplicación de ejemplo
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cap3/3.1_intro/" class="md-nav__link">
        Introducción a Core Data
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cap3/3.2_stack/" class="md-nav__link">
        Crear el stack de Core Data en iOS
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cap3/3.3_entidades/" class="md-nav__link">
        Ejercicio parte I. almacenar datos
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cap3/3.4_recuperar_datos/" class="md-nav__link">
        Ejercicio parte II. recuperar los datos
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cap3/apendice_ver_almacenamiento/" class="md-nav__link">
        Apéndice. Cómo examinar el almacenamiento persistente
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3">
          Modelos de datos en Core Data
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Modelos de datos en Core Data" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Modelos de datos en Core Data
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cap4/4.1_crear_modelo/" class="md-nav__link">
        Crear y editar modelos
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cap4/4.2_clases_propias/" class="md-nav__link">
        Modelar las entidades en código Swift
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cap4/4.3_CRUD/" class="md-nav__link">
        CRUD en Core Data
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cap4/4.4_validaciones/" class="md-nav__link">
        Validaciones
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cap4/4.5_otros_tipos/" class="md-nav__link">
        Otros tipos de datos
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cap4/4.6_ejercicios/" class="md-nav__link">
        Ejercicios de modelos de datos
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" >
      
      
      
      
        <label class="md-nav__link" for="__nav_4">
          Búsquedas en Core Data
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Búsquedas en Core Data" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Búsquedas en Core Data
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cap6/1_predicados/" class="md-nav__link">
        Predicados
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cap6/2_ordenacion/" class="md-nav__link">
        Ordenación
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cap6/3_ejercicios/" class="md-nav__link">
        Ejercicios
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" type="checkbox" id="__nav_5" >
      
      
      
      
        <label class="md-nav__link" for="__nav_5">
          Tablas en Core Data
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Tablas en Core Data" data-md-level="1">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          Tablas en Core Data
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cap7/1_el_frc/" class="md-nav__link">
        El "fetched results controller"
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cap7/2_configuracion_basica/" class="md-nav__link">
        Inicializar el "fetched results controller"
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cap7/3_tabla/" class="md-nav__link">
        Mostrar los datos en la tabla
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cap7/4_refrescar_tabla/" class="md-nav__link">
        Refrescar la tabla
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cap7/5_secciones/" class="md-nav__link">
        Secciones de tabla automáticas
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cap7/6_ejercicios/" class="md-nav__link">
        Ejercicios
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Tabla de contenidos">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Tabla de contenidos
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#loginlogout-05-puntos" class="md-nav__link">
    Login/logout (0,5 puntos)
  </a>
  
    <nav class="md-nav" aria-label="Login/logout (0,5 puntos)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#pantalla-inicial" class="md-nav__link">
    Pantalla inicial:
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#segunda-pantalla" class="md-nav__link">
    Segunda pantalla
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#mensajes-del-chat-1-punto" class="md-nav__link">
    Mensajes del chat (1 punto)
  </a>
  
    <nav class="md-nav" aria-label="Mensajes del chat (1 punto)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#enviar-mensajes" class="md-nav__link">
    Enviar mensajes
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#recibir-mensajes" class="md-nav__link">
    Recibir mensajes
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  <h1>4 ejercicios</h1>

<p>En las plantillas de la sesión hay un proyecto Xcode con las librerías de Firebase ya instaladas y configuradas. El proyecto está vinculado con una aplicación ya dada de alta en el servidor de Firebase.</p>
<blockquote>
<p>IMPORTANTE: para trabajar con el proyecto, <strong>abrir el <code>.xcworkspace</code></strong>, NO el <code>.xcodeproj</code> que abrimos habitualmente. Al abrir el <em>workspace</em> veréis dos proyectos, uno con la <em>app</em> en sí, llamado <code>ChatFirebase</code> y otro con las librerías auxiliares llamado <code>pods</code>. Tras abrir el <em>workspace</em> lo primero que deberíais hacer es <code>Product &gt; Build</code>.</p>
</blockquote>
<p>El objetivo es desarrollar un pequeño chat con la <em>realtime database</em>. La plantilla ya tiene la interfaz hecha y hay que añadirle el código de Firebase.</p>
<h2 id="loginlogout-05-puntos">Login/logout (0,5 puntos)<a class="headerlink" href="#loginlogout-05-puntos" title="Permanent link">&para;</a></h2>
<blockquote>
<p>La aplicación usa una cuenta de Firebase que ya está dada de alta en Google, los alumnos del máster estáis añadidos como usuarios con vuestro email de <code>alu.ua.es</code> que es tanto vuestro login en la app como la contraseña. Probad esta sección con esas credenciales. Si no os funciona avisad al profesor, es posible que haya algún problema con vuestro usuario de Firebase en el servidor.</p>
</blockquote>
<h3 id="pantalla-inicial">Pantalla inicial:<a class="headerlink" href="#pantalla-inicial" title="Permanent link">&para;</a></h3>
<p>En la pantalla inicial de la <em>app</em> hay un formulario para hacer login. <strong>Añade el código necesario para que cuando se pulse sobre el botón "Entrar" se haga login en Firebase</strong>. </p>
<p>Si el login ha tenido éxito habrá que saltar a la segunda pantalla por el <em>segue</em> llamado "login"</p>
<div class="highlight"><pre><span></span><code><span class="n">performSegue</span><span class="p">(</span><span class="n">withIdentifier</span><span class="p">:</span><span class="s">&quot;login&quot;</span><span class="p">,</span> <span class="n">sender</span><span class="p">:</span><span class="kc">self</span><span class="p">)</span>
</code></pre></div>
<h3 id="segunda-pantalla">Segunda pantalla<a class="headerlink" href="#segunda-pantalla" title="Permanent link">&para;</a></h3>
<p>En el <em>outlet</em> <code>usuarioLabel</code> debería aparecer el login del usuario que se ha autentificado.</p>
<p><strong>Añade el código necesario para mostrar el email del usuario actual de Firebase</strong> en el <code>usuarioLabel</code>. Puedes hacerlo en el método <code>viewWillAppear</code> del <code>ChatViewController</code>. </p>
<p>Finalmente, <strong>añade el código necesario para que al pulsar sobre <code>Salir</code></strong> se haga <em>logout</em> en Firebase.  </p>
<h2 id="mensajes-del-chat-1-punto">Mensajes del chat (1 punto)<a class="headerlink" href="#mensajes-del-chat-1-punto" title="Permanent link">&para;</a></h2>
<p>Usaremos la siguiente estructura para almacenar los mensajes del chat:</p>
<div class="highlight"><pre><span></span><code><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="nt">&quot;mensajes&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">    </span><span class="nt">&quot;1jdakdueidas&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="nt">&quot;texto&quot;</span><span class="p">:</span><span class="s2">&quot;hola qué tal&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="nt">&quot;usuario&quot;</span><span class="p">:</span><span class="s2">&quot;pepe@ua.es&quot;</span><span class="w"></span>
<span class="w">    </span><span class="p">},</span><span class="w"></span>
<span class="w">    </span><span class="nt">&quot;uiusd_ur48850_d&quot;</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">        </span><span class="nt">&quot;texto&quot;</span><span class="p">:</span><span class="s2">&quot;bien,y tú?&quot;</span><span class="p">,</span><span class="w"></span>
<span class="w">        </span><span class="nt">&quot;usuario&quot;</span><span class="p">:</span><span class="s2">&quot;pepa@ua.es&quot;</span><span class="w"></span>
<span class="w">    </span><span class="p">}</span><span class="w"></span>
<span class="w">  </span><span class="p">}</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</code></pre></div>
<p>donde los identificadores de mensaje deberían ser generados automáticamente por la base de datos con <code>childByAutoId()</code></p>
<blockquote>
<p>Llevad mucho cuidado, ya que con vuestro usuario tenéis permiso total para escribir en la base de datos, por lo que por error podríais borrar los mensajes enviados por los demás.</p>
</blockquote>
<p>Para que funcione el chat hay que implementar dos funcionalidades:</p>
<h3 id="enviar-mensajes">Enviar mensajes<a class="headerlink" href="#enviar-mensajes" title="Permanent link">&para;</a></h3>
<p>Que cuando se pulse sobre "Enviar" se guarde el mensaje en la BD. Usando el API de la base de datos habrá que:
  + Obtener la referencia al nodo "mensajes"
  + Generar la referencia a un nuevo nodo id hijo de la referencia anterior con <code>childByAutoId()</code> 
  + Fijar el valor de este nuevo nodo con <code>setValue()</code> a un diccionario Swift con las claves "texto" y "usuario" y que contenga el texto del mensaje y el email del usuario actual de Firebase.</p>
<blockquote>
<p>Con el HTML llamado "Consola Firebase" que se incluye en las plantillas podéis ver en un recuadro el estado actual de la BD y podéis comprobar si se ha insertado correctamente vuestro mensaje. También podéis enviar mensajes, pero eso sería para probar la siguiente sección</p>
</blockquote>
<h3 id="recibir-mensajes">Recibir mensajes<a class="headerlink" href="#recibir-mensajes" title="Permanent link">&para;</a></h3>
<p>Que cuando alguien envíe un mensaje al chat este aparezca en la tabla</p>
<blockquote>
<p>Como es más que posible que en este momento estés probando tú sol@ la <em>app</em> no habrá nadie más enviando mensajes al chat. Puedes similar que envías mensajes como otro usuario desde el HTML de moodle que actúa como "consola de Firebase"</p>
</blockquote>
<p>En el <code>viewWillAppear</code> del <code>ChatViewController</code> añadir un <em>listener</em> para que escuche el evento <code>.childAdded</code> sobre el nodo "mensajes"</p>
<p>Ten en cuenta que el código que recibe el evento recibe un parámetro <code>snapshot</code> con los nuevos valores en el campo <code>value</code>. En nuestro caso será un diccionario con el texto y el usuario. Podemos hacer el <em>cast</em> a un diccionario con claves y valores <code>String</code> para poder usarlo en el código, algo como:</p>
<p><div class="highlight"><pre><span></span><code><span class="k">if</span> <span class="kd">let</span> <span class="nv">valor</span> <span class="p">=</span> <span class="n">snapshot</span><span class="p">.</span><span class="n">value</span><span class="p">,</span> <span class="kd">let</span> <span class="nv">v</span> <span class="p">=</span> <span class="n">valor</span> <span class="k">as</span><span class="p">?</span> <span class="p">[</span><span class="nb">String</span><span class="p">:</span><span class="nb">String</span><span class="p">]</span> <span class="p">{</span>
   <span class="c1">//Aquí ya podríamos acceder a los valores con v[&quot;texto&quot;] y v[&quot;usuario&quot;]</span>
<span class="p">}</span>
</code></pre></div>
Cuando se reciba el evento, para mostrar el mensaje en la tabla:</p>
<ul>
<li>Con el texto del mensaje y el email del usuario construir un <code>struct</code> de tipo <code>Mensaje</code> y añadirlo al array <code>self.mensajes</code> del <code>ChatViewController</code>. </li>
<li>Para que aparezca visualmente en la tabla tienes además que añadir una fila en la posición correspondiente:</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="kd">let</span> <span class="nv">indexPath</span> <span class="p">=</span> <span class="n">IndexPath</span><span class="p">(</span><span class="n">row</span><span class="p">:</span><span class="kc">self</span><span class="p">.</span><span class="n">mensajes</span><span class="p">.</span><span class="bp">count</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">section</span><span class="p">:</span><span class="mi">0</span><span class="p">)</span>
<span class="kc">self</span><span class="p">.</span><span class="n">miTabla</span><span class="p">.</span><span class="n">insertRows</span><span class="p">(</span><span class="n">at</span><span class="p">:</span> <span class="p">[</span><span class="n">indexPath</span><span class="p">],</span> 
                     <span class="n">with</span><span class="p">:</span> <span class="n">UITableViewRowAnimation</span><span class="p">.</span><span class="n">bottom</span><span class="p">)</span>
</code></pre></div>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../..", "features": [], "search": "../../assets/javascripts/workers/search.5bf1dace.min.js", "translations": {"clipboard.copied": "Copiado al portapapeles", "clipboard.copy": "Copiar al portapapeles", "search.config.lang": "es", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "B\u00fasqueda", "search.result.more.one": "1 m\u00e1s en esta p\u00e1gina", "search.result.more.other": "# m\u00e1s en esta p\u00e1gina", "search.result.none": "No se encontraron documentos", "search.result.one": "1 documento encontrado", "search.result.other": "# documentos encontrados", "search.result.placeholder": "Teclee para comenzar b\u00fasqueda", "search.result.term.missing": "Falta", "select.version.title": "Seleccionar versi\u00f3n"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.078830c0.min.js"></script>
      
    
  </body>
</html>
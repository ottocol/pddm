



<!doctype html>
<html lang="es" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
      
      
        <meta name="lang:clipboard.copy" content="Copiar al portapapeles">
      
        <meta name="lang:clipboard.copied" content="Copiado al portapapeles">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No se encontraron documentos">
      
        <meta name="lang:search.result.one" content="1 documento encontrado">
      
        <meta name="lang:search.result.other" content="# documentos encontrados">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.4.3">
    
    
      
        <title>5 ejercicios - PDDM-iOS</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application.30686662.css">
      
        <link rel="stylesheet" href="../../assets/stylesheets/application-palette.a8b3c06d.css">
      
      
        
        
        <meta name="theme-color" content="#009688">
      
    
    
      <script src="../../assets/javascripts/modernizr.74668098.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../assets/fonts/material-icons.css">
    
    
    
      
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="teal" data-md-color-accent="teal">
  
    <svg class="md-svg">
      <defs>
        
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#ejercicios-de-la-sesion" tabindex="1" class="md-skip">
        Saltar a contenido
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../.." title="PDDM-iOS" class="md-header-nav__button md-logo">
          
            <img src="../../logo.png" width="24" height="24">
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              PDDM-iOS
            </span>
            <span class="md-header-nav__topic">
              
                5 ejercicios
              
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Búsqueda" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Teclee para comenzar búsqueda
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main" role="main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="../.." title="PDDM-iOS" class="md-nav__button md-logo">
      
        <img src="../../logo.png" width="48" height="48">
      
    </a>
    PDDM-iOS
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-1" type="checkbox" id="nav-1">
    
    <label class="md-nav__link" for="nav-1">
      Persistencia básica
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-1">
        Persistencia básica
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap1/1.1_sistema_de_archivos/" title="Sistema de archivos" class="md-nav__link">
      Sistema de archivos
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap1/1.2_serializacion/" title="Serialización" class="md-nav__link">
      Serialización
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap1/1.3_property_lists/" title="Property lists" class="md-nav__link">
      Property lists
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap1/1.4_preferencias/" title="Preferencias" class="md-nav__link">
      Preferencias
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap1/1.5_ejercicios/" title="Ejercicios" class="md-nav__link">
      Ejercicios
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      SQLite
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        SQLite
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap2/2.1_intro_SQLite/" title="Introducción" class="md-nav__link">
      Introducción
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap2/2.2_API_SQLite/" title="El API de SQLIte" class="md-nav__link">
      El API de SQLIte
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap2/2.3_frameworks/" title="Frameworks para SQLite" class="md-nav__link">
      Frameworks para SQLite
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap2/2.4_ejercicios/" title="Ejercicios" class="md-nav__link">
      Ejercicios
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      ¡Hola Core Data!. Una aplicación de ejemplo
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        ¡Hola Core Data!. Una aplicación de ejemplo
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap3/3.1_intro/" title="Introducción a Core Data" class="md-nav__link">
      Introducción a Core Data
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap3/3.2_stack/" title="Crear el stack de Core Data en iOS" class="md-nav__link">
      Crear el stack de Core Data en iOS
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap3/3.3_entidades/" title="Las entidades. Almacenar datos" class="md-nav__link">
      Las entidades. Almacenar datos
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap3/3.4_recuperar_datos/" title="Recuperar los datos" class="md-nav__link">
      Recuperar los datos
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      Modelos de datos en Core Data
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        Modelos de datos en Core Data
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap4/4.1_crear_modelo/" title="Crear y editar modelos" class="md-nav__link">
      Crear y editar modelos
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap4/4.2_clases_propias/" title="Modelar las entidades en código Swift" class="md-nav__link">
      Modelar las entidades en código Swift
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap4/4.3_CRUD/" title="CRUD en Core Data" class="md-nav__link">
      CRUD en Core Data
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap4/4.4_ejercicios/" title="Ejercicios de modelos de datos" class="md-nav__link">
      Ejercicios de modelos de datos
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      Búsquedas en Core Data
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        Búsquedas en Core Data
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap6/1_predicados/" title="Predicados" class="md-nav__link">
      Predicados
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap6/2_ordenacion/" title="Ordenación" class="md-nav__link">
      Ordenación
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap6/3_ejercicios/" title="Ejercicios" class="md-nav__link">
      Ejercicios
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6">
    
    <label class="md-nav__link" for="nav-6">
      Tablas en Core Data
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        Tablas en Core Data
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap7/1_el_frc/" title="El *fetched results controller*" class="md-nav__link">
      El *fetched results controller*
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap7/2_configuracion_basica/" title="Inicializar el "fetched results controller"" class="md-nav__link">
      Inicializar el "fetched results controller"
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap7/3_tabla/" title="Mostrar los datos en la tabla" class="md-nav__link">
      Mostrar los datos en la tabla
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap7/4_refrescar_tabla/" title="Refrescar la tabla" class="md-nav__link">
      Refrescar la tabla
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap7/5_secciones/" title="Secciones de tabla automáticas" class="md-nav__link">
      Secciones de tabla automáticas
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap7/6_ejercicios/" title="Ejercicios" class="md-nav__link">
      Ejercicios
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7" type="checkbox" id="nav-7">
    
    <label class="md-nav__link" for="nav-7">
      Migraciones de datos
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-7">
        Migraciones de datos
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap8/1_intro/" title="Qué son las migraciones de datos" class="md-nav__link">
      Qué son las migraciones de datos
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap8/2_versiones/" title="Versiones del modelo de datos" class="md-nav__link">
      Versiones del modelo de datos
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap8/3_migraciones_ligeras/" title="Migraciones ligeras" class="md-nav__link">
      Migraciones ligeras
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap8/4_migraciones_pesadas/" title="Migraciones pesadas" class="md-nav__link">
      Migraciones pesadas
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap8/5_ejercicios/" title="Ejercicios" class="md-nav__link">
      Ejercicios
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap8/apendice_migraciones_ios9/" title="Apéndice. migraciones en versiones antiguas de iOS" class="md-nav__link">
      Apéndice. migraciones en versiones antiguas de iOS
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-8" type="checkbox" id="nav-8">
    
    <label class="md-nav__link" for="nav-8">
      Concurrencia. Contextos múltiples
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-8">
        Concurrencia. Contextos múltiples
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap9/1_background/" title="Múltiples contextos para trabajos en *background*" class="md-nav__link">
      Múltiples contextos para trabajos en *background*
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap9/2_comunicacion/" title="Comunicación entre contextos" class="md-nav__link">
      Comunicación entre contextos
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap9/3_contextos_anidados/" title="Contextos anidados" class="md-nav__link">
      Contextos anidados
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap9/4_ejercicios/" title="Ejercicios" class="md-nav__link">
      Ejercicios
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-9" type="checkbox" id="nav-9">
    
    <label class="md-nav__link" for="nav-9">
      Persistencia como servicio
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-9">
        Persistencia como servicio
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap11/1_introduccion_BAAS/" title="Backend as a Service" class="md-nav__link">
      Backend as a Service
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap11/2_gestion_usuarios/" title="Gestión de usuarios en Firebase" class="md-nav__link">
      Gestión de usuarios en Firebase
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap11/3_persistencia/" title="Persistencia en Firebase" class="md-nav__link">
      Persistencia en Firebase
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap11/4_ejercicios/" title="Ejercicios" class="md-nav__link">
      Ejercicios
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-10" type="checkbox" id="nav-10">
    
    <label class="md-nav__link" for="nav-10">
      Arquitecturas de aplicaciones en iOS
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-10">
        Arquitecturas de aplicaciones en iOS
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap10/intro/" title="Introducción" class="md-nav__link">
      Introducción
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap10/2_MVC/" title="Model/View/Controller" class="md-nav__link">
      Model/View/Controller
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap10/3_MVP/" title="Model/View/Presenter" class="md-nav__link">
      Model/View/Presenter
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap10/4_MVVM/" title="Model/View/ViewModel" class="md-nav__link">
      Model/View/ViewModel
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap10/5_VIPER/" title="VIPER" class="md-nav__link">
      VIPER
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap10/6a_ejercicios1/" title="Ejercicios parte I" class="md-nav__link">
      Ejercicios parte I
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap10/6_ejercicios/" title="Ejercicios parte II" class="md-nav__link">
      Ejercicios parte II
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap10/6_ejercicios_redux/" title="Ejercicios parte III" class="md-nav__link">
      Ejercicios parte III
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="__toc">Tabla de contenidos</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#ejercicios-de-la-sesion" class="md-nav__link">
    Ejercicios de la sesión
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#usar-la-clase-nota-1-punto" class="md-nav__link">
    Usar la clase Nota (1 punto)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#validacion-de-datos-15-puntos" class="md-nav__link">
    Validación de datos (1.5 puntos)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#transformables-15-puntos" class="md-nav__link">
    Transformables (1.5 puntos)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#anadir-otra-entidad-6-puntos" class="md-nav__link">
    Añadir otra entidad (6 puntos)
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                  <h1>5 ejercicios</h1>
                
                <h2 id="ejercicios-de-la-sesion">Ejercicios de la sesión<a class="headerlink" href="#ejercicios-de-la-sesion" title="Permanent link">&para;</a></h2>
<p>En esta sesión vamos a continuar trabajando sobre la aplicación de notas de la primera sesión de Core Data. Necesitarás que esa sesión esté terminada para poder continuar en ella.</p>
<blockquote>
<p>Antes de ponerte a hacer las modificaciones de esta sesión asegúrate de que has hecho un <code>commit</code> con el mensaje <code>terminada sesión 3</code>. También puedes hacer un <code>.zip</code> con el proyecto, llamarlo <code>notas_sesion_3.zip</code> y adjuntarlo en las entregas de la asignatura. Así cuando se evalúe el ejercicio el profesor podrá consultar el estado de la aplicación antes de estos ejercicios.</p>
</blockquote>
<h3 id="usar-la-clase-nota-1-punto">Usar la clase <code>Nota</code> (1 punto)<a class="headerlink" href="#usar-la-clase-nota-1-punto" title="Permanent link">&para;</a></h3>
<p>Modifica el código que tenías de Core Data para que use la clase <code>Nota</code>, que habrá generado automáticamente Xcode. Es decir:</p>
<ul>
<li>Para crear una nota, en lugar de <code>insertNewObject</code> puedes usar el inicializador <code>Nota(context:)</code>.</li>
<li>Cuando accedas a los atributos lo puedes hacer directamente en vez de con <code>set(value:forKey)</code> y <code>value(forKey:)</code> </li>
</ul>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1">//En vez de...</span>
<span class="n">nuevaNota</span><span class="p">.</span><span class="kr">set</span><span class="p">(</span><span class="n">value</span><span class="p">:</span><span class="s">&quot;EL TEXTO QUE HAGA FALTA ASIGNAR&quot;</span><span class="p">,</span> <span class="n">forKey</span><span class="p">:</span><span class="s">&quot;texto&quot;</span><span class="p">)</span>

<span class="c1">//ahora sería</span>
<span class="n">nuevaNota</span><span class="p">.</span><span class="n">fecha</span> <span class="p">=</span> <span class="s">&quot;EL TEXTO QUE HAGA FALTA ASIGNAR&quot;</span>
</pre></div>
</td></tr></table>

<h3 id="validacion-de-datos-15-puntos">Validación de datos (1.5 puntos)<a class="headerlink" href="#validacion-de-datos-15-puntos" title="Permanent link">&para;</a></h3>
<p>Queremos validar que la nota no esté vacía antes de guardarla. Para ello:</p>
<ol>
<li>En el modelo, ve a la entidad <code>Nota</code>, atributo <code>texto</code> y en el panel de propiedades de la derecha, en la validación, pon 1 como longitud mínima.</li>
<li>Captura los errores de validación del <code>save</code> con un <code>do...catch let error as NSError</code>. El error que nos interesa tiene el código 1670, correspondiente a la constante <code>NSNSValidationStringTooShortError</code>. Puedes mostrar el error en el campo de texo donde se muestra el mensaje de "nota guardada"</li>
<li>En el <code>catch</code>, si la nota no tiene longitud válida, además de mostrar el error debes descartar el objeto pendiente de guardar. Puedes hacerlo con</li>
</ol>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="n">miContexto</span><span class="p">.</span><span class="n">refresh</span><span class="p">(</span><span class="n">nuevaNota</span><span class="p">,</span> <span class="n">mergeChanges</span><span class="p">:</span> <span class="kc">false</span><span class="p">)</span>
</pre></div>
</td></tr></table>

<p>que sincroniza el objeto con la BD, en este caso como la nota todavía no está guardada, descarta los cambios.</p>
<h3 id="transformables-15-puntos">Transformables (1.5 puntos)<a class="headerlink" href="#transformables-15-puntos" title="Permanent link">&para;</a></h3>
<p>Vamos a añadirle a cada nota un atributo que sea un array de <em>tags</em>, o palabras clave. Es decir, un array de Strings.</p>
<ol>
<li>Añade el atributo, llamado <code>tags</code> en el editor del modelo. Asígnale como tipo <code>Transformable</code></li>
<li>En las propiedades del atributo, en el cuadro de texto <code>Custom class</code> puedes teclear el tipo deseado. Por defecto es <code>NSObject</code>, simplemente un objeto cualquiera (algo así como el <code>Any</code> de Swift). Cámbialo tecleando <code>[String]</code></li>
<li>En la interfaz de usuario de alta de nota añade un campo de texto más. Allí el usuario debe escribir las <em>tags</em> como una lista de palabras separadas por espacios</li>
<li>Para pasar de una cadena separada por espacios a un array de Strings puedes usar el método de la clase <code>String</code> llamado <code>components(separatedBy:)</code>, que aplicado sobre una cadena la divide por la cadena "separadora" generando un array</li>
</ol>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="s">&quot;hola mundo&quot;</span><span class="p">.</span><span class="n">components</span><span class="p">(</span><span class="n">separatedBy</span><span class="p">:</span><span class="s">&quot; &quot;</span><span class="p">)</span>  <span class="c1">//devolvería [&quot;hola&quot;, &quot;mundo&quot;]</span>
</pre></div>
</td></tr></table>

<p>Haz que la lista de <em>tags</em> aparezca en la lista de notas, pero ahora separadas por comas:</p>
<ol>
<li>Tendrás que cambiar el prototipo de la celda por un tipo que tenga texto de "detalle" (cualquiera que no sea <code>Basic</code>). </li>
<li>En el método <code>tableView(_:, cellForRowAt:)</code>  del <code>ListaNotasController</code>, la etiqueta de detalle es la propiedad <code>cell.detailTextLabel</code>. Como texto de la etiqueta pon la lista de <em>tags</em> como un único String donde estén separadas por barras. Puedes usar <code>joined</code> para componer un String a partir de un array de Strings (es como el "inverso" del método <code>components</code> que usaste antes)</li>
</ol>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kd">let</span> <span class="nv">miArray</span> <span class="p">=</span> <span class="p">[</span><span class="s">&quot;hola&quot;</span><span class="p">,</span> <span class="s">&quot;mundo&quot;</span><span class="p">]</span>
<span class="n">miArray</span><span class="p">.</span><span class="n">joined</span><span class="p">(</span><span class="n">separator</span><span class="p">:</span><span class="s">&quot;/&quot;</span><span class="p">)</span>  <span class="c1">//devolvería &quot;hola/mundo&quot;</span>
</pre></div>
</td></tr></table>

<blockquote>
<p>Lo sé, parece un poco tonto separar un String en un array y volver a juntarlo para mostrarlo, pero los <em>tags</em> están almacenados de modo mejor estructurado como array, y la forma más sencilla de mostrarlos es como String </p>
</blockquote>
<h3 id="anadir-otra-entidad-6-puntos">Añadir otra entidad (6 puntos)<a class="headerlink" href="#anadir-otra-entidad-6-puntos" title="Permanent link">&para;</a></h3>
<p>Queremos que las notas puedan estar agrupadas en "libretas". Cada libreta contendrá muchas notas, pero cada nota solo puede estar en una libreta.</p>
<ul>
<li>Añadir la entidad Libreta, con un atributo nombre de tipo String</li>
<li>Crear una relación "a muchos" de <code>Libreta</code> a <code>Nota</code> y "a uno" de <code>Nota</code> a <code>Libreta</code> (la inversa)</li>
</ul>
<h4>Insertar libretas en Core Data</h4>
<p>Para simplificar será un botón "nueva libreta" en la pantalla inicial, que al pulsarlo debe mostrar un <em>alert</em> con un camp de texto con el nombre de la libreta. Tendrás que definirte el <em>action</em> correspondiente para detectar que se ha pulsado el botón. En el <em>action</em> puedes llamar al siguiente código para mostrar el <em>alert</em>:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kd">func</span> <span class="nf">nuevaLibreta</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">let</span> <span class="nv">alert</span> <span class="p">=</span> <span class="bp">UIAlertController</span><span class="p">(</span><span class="n">title</span><span class="p">:</span> <span class="s">&quot;Nueva libreta&quot;</span><span class="p">,</span>
                                  <span class="n">message</span><span class="p">:</span> <span class="s">&quot;Escribe el nombre para la nueva libreta&quot;</span><span class="p">,</span>
                                  <span class="n">preferredStyle</span><span class="p">:</span> <span class="p">.</span><span class="n">alert</span><span class="p">)</span>
    <span class="kd">let</span> <span class="nv">crear</span> <span class="p">=</span> <span class="bp">UIAlertAction</span><span class="p">(</span><span class="n">title</span><span class="p">:</span> <span class="s">&quot;Crear&quot;</span><span class="p">,</span> <span class="n">style</span><span class="p">:</span> <span class="p">.</span><span class="k">default</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">action</span> <span class="k">in</span>
        <span class="kd">let</span> <span class="nv">nombre</span> <span class="p">=</span> <span class="n">alert</span><span class="p">.</span><span class="n">textFields</span><span class="p">![</span><span class="mi">0</span><span class="p">].</span><span class="n">text</span><span class="p">!</span>
        <span class="c1">//AQUI FALTA GUARDAR LA LIBRETA CON CORE DATA</span>
    <span class="p">}</span>
    <span class="kd">let</span> <span class="nv">cancelar</span> <span class="p">=</span> <span class="bp">UIAlertAction</span><span class="p">(</span><span class="n">title</span><span class="p">:</span> <span class="s">&quot;Cancelar&quot;</span><span class="p">,</span> <span class="n">style</span><span class="p">:</span> <span class="p">.</span><span class="n">cancel</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">action</span> <span class="k">in</span>
    <span class="p">}</span>
    <span class="n">alert</span><span class="p">.</span><span class="n">addAction</span><span class="p">(</span><span class="n">crear</span><span class="p">)</span>
    <span class="n">alert</span><span class="p">.</span><span class="n">addAction</span><span class="p">(</span><span class="n">cancelar</span><span class="p">)</span>
    <span class="n">alert</span><span class="p">.</span><span class="n">addTextField</span><span class="p">()</span> <span class="p">{</span> <span class="nv">$0</span><span class="p">.</span><span class="n">placeholder</span> <span class="p">=</span> <span class="s">&quot;Nombre&quot;</span><span class="p">}</span>
    <span class="kc">self</span><span class="p">.</span><span class="n">present</span><span class="p">(</span><span class="n">alert</span><span class="p">,</span> <span class="n">animated</span><span class="p">:</span> <span class="kc">true</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>

<ul>
<li>En el código anterior falta <strong>guardar la libreta</strong> usando Core Data, implementa esta funcionalidad</li>
</ul>
<h4>Listar libretas</h4>
<p>Antes de empezar con esto asegúrate de que las libretas se están creando correctamente en la base de datos. En el <code>viewWillAppear</code> de la pantalla de lista de notas puedes poner provisionalmente una consulta que las imprima en la consola (luego acuérdate de quitarlo)</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kd">let</span> <span class="nv">queryLibretas</span> <span class="p">=</span> <span class="bp">NSFetchRequest</span><span class="p">&lt;</span><span class="n">Libreta</span><span class="p">&gt;(</span><span class="n">entityName</span><span class="p">:</span><span class="s">&quot;Libreta&quot;</span><span class="p">)</span>
<span class="c1">//RECUERDA QUE NECESITAS EL CONTEXTO DE PERSISTENCIA. AQUI SE LLAMA &quot;miContexto&quot;</span>
<span class="kd">let</span> <span class="nv">libretas</span> <span class="p">=</span> <span class="k">try</span><span class="p">!</span> <span class="n">miContexto</span><span class="p">.</span><span class="n">fetch</span><span class="p">(</span><span class="n">queryLibretas</span><span class="p">)</span>
<span class="k">for</span> <span class="n">libreta</span> <span class="k">in</span> <span class="n">libretas</span> <span class="p">{</span>
    <span class="bp">print</span><span class="p">(</span><span class="n">libreta</span><span class="p">.</span><span class="n">nombre</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>

<p>Para que el usuario pueda seleccionar la libreta en la pantalla de creación de notas vamos a usar un <em>picker view</em>, la típica "rueda" para seleccionar valores de una lista.</p>
<ul>
<li>Añade un componente <em>picker view</em> a la pantalla de creación de notas. Crea un <em>outlet</em> para poder acceder a él desde Swift. Dale el nombre que quieras.</li>
<li>Desde el punto de vista del código, un <em>picker view</em> requiere de un <em>delegate</em> y de un <em>datasource</em> (más o menos como las tablas). Crea una nueva clase <code>GestorPicker</code> en un archivo del mismo nombre, así no llenamos de tanto código el <code>ViewController</code></li>
</ul>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kd">import</span> <span class="nc">Foundation</span>
<span class="kd">import</span> <span class="nc">UIKit</span>
<span class="kd">import</span> <span class="nc">CoreData</span>


<span class="kd">class</span> <span class="nc">GestorPicker</span> <span class="p">:</span> <span class="bp">NSObject</span><span class="p">,</span> <span class="bp">UIPickerViewDelegate</span><span class="p">,</span> <span class="bp">UIPickerViewDataSource</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nv">libretas</span> <span class="p">=</span> <span class="p">[</span><span class="n">Libreta</span><span class="p">]()</span>

    <span class="c1">//devuelve el número de columnas del picker. En nuestro caso solo 1</span>
    <span class="kd">func</span> <span class="nf">numberOfComponents</span><span class="p">(</span><span class="k">in</span> <span class="n">pickerView</span><span class="p">:</span> <span class="bp">UIPickerView</span><span class="p">)</span> <span class="p">-&gt;</span> <span class="nb">Int</span> <span class="p">{</span>
        <span class="k">return</span> <span class="mi">1</span>
    <span class="p">}</span>

    <span class="c1">//devuelve el número de filas del picker (== número de libretas)</span>
    <span class="kd">func</span> <span class="nf">pickerView</span><span class="p">(</span><span class="kc">_</span> <span class="n">pickerView</span><span class="p">:</span> <span class="bp">UIPickerView</span><span class="p">,</span> <span class="n">numberOfRowsInComponent</span> <span class="n">component</span><span class="p">:</span> <span class="nb">Int</span><span class="p">)</span> <span class="p">-&gt;</span> <span class="nb">Int</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kc">self</span><span class="p">.</span><span class="n">libretas</span><span class="p">.</span><span class="bp">count</span>
    <span class="p">}</span>

    <span class="c1">//devuelve el título de una fila determinada</span>
    <span class="kd">func</span> <span class="nf">pickerView</span><span class="p">(</span><span class="kc">_</span> <span class="n">pickerView</span><span class="p">:</span> <span class="bp">UIPickerView</span><span class="p">,</span> <span class="n">titleForRow</span> <span class="n">row</span><span class="p">:</span> <span class="nb">Int</span><span class="p">,</span> <span class="n">forComponent</span> <span class="n">component</span><span class="p">:</span> <span class="nb">Int</span><span class="p">)</span> <span class="p">-&gt;</span> <span class="nb">String</span><span class="p">?</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kc">self</span><span class="p">.</span><span class="n">libretas</span><span class="p">[</span><span class="n">row</span><span class="p">].</span><span class="n">nombre</span>
    <span class="p">}</span>

    <span class="c1">//para cargar la lista de libretas desde Core Data</span>
    <span class="kd">func</span> <span class="nf">cargarLista</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">let</span> <span class="nv">miDelegate</span> <span class="p">=</span> <span class="bp">UIApplication</span><span class="p">.</span><span class="n">shared</span><span class="p">.</span><span class="n">delegate</span> <span class="k">as</span><span class="p">!</span> <span class="n">AppDelegate</span>
        <span class="kd">let</span> <span class="nv">miContexto</span> <span class="p">=</span> <span class="n">miDelegate</span><span class="p">.</span><span class="n">persistentContainer</span><span class="p">.</span><span class="n">viewContext</span>
        <span class="kd">let</span> <span class="nv">request</span> <span class="p">=</span> <span class="bp">NSFetchRequest</span><span class="p">&lt;</span><span class="n">Libreta</span><span class="p">&gt;(</span><span class="n">entityName</span><span class="p">:</span><span class="s">&quot;Libreta&quot;</span><span class="p">)</span>
        <span class="kc">self</span><span class="p">.</span><span class="n">libretas</span> <span class="p">=</span> <span class="k">try</span><span class="p">!</span> <span class="n">miContexto</span><span class="p">.</span><span class="n">fetch</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>

<p>Ahora <strong>en el <code>ViewController</code> añade una nueva propiedad </strong>, una instancia de la clase anterior</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1">//Esto es una propiedad del ViewController, va dentro de la clase y FUERA de los métodos</span>
<span class="kd">let</span> <span class="nv">miGestorPicker</span> <span class="p">=</span> <span class="n">GestorPicker</span><span class="p">()</span>
</pre></div>
</td></tr></table>

<p>y en el <code>viewDidLoad</code> del <code>ViewController</code> conectamos el <em>picker</em> con su <em>delegate/datasource</em> y cargamos la lista de libretas con Core Data</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1">//Aquí, &quot;picker&quot; es el outlet que representa al &quot;picker view&quot;</span>
<span class="c1">//CAMBIALO por el nombre que le hayas dado</span>
<span class="kc">self</span><span class="p">.</span><span class="n">picker</span><span class="p">.</span><span class="n">delegate</span> <span class="p">=</span> <span class="kc">self</span><span class="p">.</span><span class="n">miGestorPicker</span>
<span class="kc">self</span><span class="p">.</span><span class="n">picker</span><span class="p">.</span><span class="n">dataSource</span> <span class="p">=</span> <span class="kc">self</span><span class="p">.</span><span class="n">miGestorPicker</span>
<span class="c1">//cargamos las libretas con Core Data</span>
<span class="kc">self</span><span class="p">.</span><span class="n">miGestorPicker</span><span class="p">.</span><span class="n">cargarLista</span><span class="p">()</span>
</pre></div>
</td></tr></table>

<p>Tal como está ahora la aplicación la lista de libretas debe aparecer cuando se arranca, pero si se añade una nueva libreta no aparecerá en el <em>picker</em> hasta que se pare la app y se vuelva a arrancar (que es cuando se llama a <code>cargarLista()</code>). Puedes arreglarlo haciendo dos cosas justo después de guardar la nueva libreta con core data (en la función <code>nuevaLibreta</code> de antes):</p>
<ul>
<li>Añadir la nueva libreta a la lista que tiene dentro el <code>miGestorPicker</code>: </li>
</ul>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kc">self</span><span class="p">.</span><span class="n">miGestorPicker</span><span class="p">.</span><span class="n">libretas</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">libreta</span><span class="p">)</span>
</pre></div>
</td></tr></table>

<ul>
<li>Decirle al componente <em>picker view</em> que se repinte recargando los datos</li>
</ul>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1">//de nuevo, &quot;picker&quot; es el outlet del &quot;picker view&quot;. Cámbialo por el tuyo</span>
<span class="kc">self</span><span class="p">.</span><span class="n">picker</span><span class="p">.</span><span class="n">reloadAllComponents</span><span class="p">()</span>
</pre></div>
</td></tr></table>

<h4>Asociar una libreta a la nota actual</h4>
<p>Falta que cuando se guarde la nota, se le asocie la libreta que aparece seleccionada en el <em>picker view</em>. Igual que asignas el "texto" y la "fecha" de la nota, <strong>asígnale también el objeto libreta usando la relación "a uno" entre <code>Nota</code> y <code>Libreta</code></strong>. Para saber qué número de opción está seleccionado actualmente en un <em>picker</em> puedes usar su método <code>selectedRow</code>:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1">//de nuevo, &quot;picker&quot; es el outlet del &quot;picker view&quot;. Cámbialo por el tuyo</span>
<span class="kd">let</span> <span class="nv">numLibreta</span> <span class="p">=</span> <span class="kc">self</span><span class="p">.</span><span class="n">picker</span><span class="p">.</span><span class="n">selectedRow</span><span class="p">(</span><span class="n">inComponent</span><span class="p">:</span> <span class="mi">0</span><span class="p">)</span>
</pre></div>
</td></tr></table>

<p>El objeto <code>Libreta</code> en esa posición será la misma posición del array <code>libretas</code> del <code>self.miGestorPicker</code>.</p>
<h4>Mostrar la libreta al listar las notas</h4>
<p>Para simplificar, esto puedes hacerlo por la consola si no quieres complicarte. En caso contrario puedes mostrarlo en la parte del texto de detalle de la celda (recuerda que era la propiedad <code>detailTextLabel</code> de la celda). Coge el valor que haya  (que tendrá también ls <em>tags</em>) y concaténale el nombre de la libreta entre paréntesis, por ejemplo.</p>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application.ac79c3b0.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:"../.."}})</script>
      
    
  </body>
</html>
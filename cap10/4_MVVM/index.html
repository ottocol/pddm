



<!doctype html>
<html lang="es" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
      
      
        <meta name="lang:clipboard.copy" content="Copiar al portapapeles">
      
        <meta name="lang:clipboard.copied" content="Copiado al portapapeles">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No se encontraron documentos">
      
        <meta name="lang:search.result.one" content="1 documento encontrado">
      
        <meta name="lang:search.result.other" content="# documentos encontrados">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.4.3">
    
    
      
        <title>Model/View/ViewModel - PDDM-iOS</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application.30686662.css">
      
        <link rel="stylesheet" href="../../assets/stylesheets/application-palette.a8b3c06d.css">
      
      
        
        
        <meta name="theme-color" content="#009688">
      
    
    
      <script src="../../assets/javascripts/modernizr.74668098.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../assets/fonts/material-icons.css">
    
    
    
      
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="teal" data-md-color-accent="teal">
  
    <svg class="md-svg">
      <defs>
        
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#mvvm" tabindex="1" class="md-skip">
        Saltar a contenido
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../.." title="PDDM-iOS" class="md-header-nav__button md-logo">
          
            <img src="../../logo.png" width="24" height="24">
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              PDDM-iOS
            </span>
            <span class="md-header-nav__topic">
              
                Model/View/ViewModel
              
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Búsqueda" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Teclee para comenzar búsqueda
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main" role="main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="../.." title="PDDM-iOS" class="md-nav__button md-logo">
      
        <img src="../../logo.png" width="48" height="48">
      
    </a>
    PDDM-iOS
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-1" type="checkbox" id="nav-1">
    
    <label class="md-nav__link" for="nav-1">
      Persistencia básica
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-1">
        Persistencia básica
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap1/1.1_sistema_de_archivos/" title="Sistema de archivos" class="md-nav__link">
      Sistema de archivos
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap1/1.2_serializacion/" title="Serialización" class="md-nav__link">
      Serialización
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap1/1.3_property_lists/" title="Property lists" class="md-nav__link">
      Property lists
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap1/1.4_preferencias/" title="Preferencias" class="md-nav__link">
      Preferencias
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap1/1.5_ejercicios/" title="Ejercicios" class="md-nav__link">
      Ejercicios
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      SQLite
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        SQLite
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap2/2.1_intro_SQLite/" title="Introducción" class="md-nav__link">
      Introducción
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap2/2.2_API_SQLite/" title="El API de SQLIte" class="md-nav__link">
      El API de SQLIte
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap2/2.3_frameworks/" title="Frameworks para SQLite" class="md-nav__link">
      Frameworks para SQLite
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap2/2.4_ejercicios/" title="Ejercicios" class="md-nav__link">
      Ejercicios
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      ¡Hola Core Data!. Una aplicación de ejemplo
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        ¡Hola Core Data!. Una aplicación de ejemplo
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap3/3.1_intro/" title="Introducción a Core Data" class="md-nav__link">
      Introducción a Core Data
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap3/3.2_stack/" title="Crear el stack de Core Data en iOS" class="md-nav__link">
      Crear el stack de Core Data en iOS
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap3/3.3_entidades/" title="Las entidades. Almacenar datos" class="md-nav__link">
      Las entidades. Almacenar datos
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap3/3.4_recuperar_datos/" title="Recuperar los datos" class="md-nav__link">
      Recuperar los datos
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap3/apendice_ver_almacenamiento/" title="Apéndice. Cómo examinar el almacenamiento persistente" class="md-nav__link">
      Apéndice. Cómo examinar el almacenamiento persistente
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      Modelos de datos en Core Data
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        Modelos de datos en Core Data
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap4/4.1_crear_modelo/" title="Crear y editar modelos" class="md-nav__link">
      Crear y editar modelos
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap4/4.2_clases_propias/" title="Modelar las entidades en código Swift" class="md-nav__link">
      Modelar las entidades en código Swift
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap4/4.3_CRUD/" title="CRUD en Core Data" class="md-nav__link">
      CRUD en Core Data
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap4/4.4_validaciones/" title="Validaciones" class="md-nav__link">
      Validaciones
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap4/4.5_transformables/" title="Transformables" class="md-nav__link">
      Transformables
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap4/4.6_ejercicios/" title="Ejercicios de modelos de datos" class="md-nav__link">
      Ejercicios de modelos de datos
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      Búsquedas en Core Data
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        Búsquedas en Core Data
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap6/1_predicados/" title="Predicados" class="md-nav__link">
      Predicados
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap6/2_ordenacion/" title="Ordenación" class="md-nav__link">
      Ordenación
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap6/3_ejercicios/" title="Ejercicios" class="md-nav__link">
      Ejercicios
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6">
    
    <label class="md-nav__link" for="nav-6">
      Tablas en Core Data
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        Tablas en Core Data
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap7/1_el_frc/" title="El *fetched results controller*" class="md-nav__link">
      El *fetched results controller*
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap7/2_configuracion_basica/" title="Inicializar el "fetched results controller"" class="md-nav__link">
      Inicializar el "fetched results controller"
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap7/3_tabla/" title="Mostrar los datos en la tabla" class="md-nav__link">
      Mostrar los datos en la tabla
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap7/4_refrescar_tabla/" title="Refrescar la tabla" class="md-nav__link">
      Refrescar la tabla
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap7/5_secciones/" title="Secciones de tabla automáticas" class="md-nav__link">
      Secciones de tabla automáticas
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap7/6_ejercicios/" title="Ejercicios" class="md-nav__link">
      Ejercicios
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7" type="checkbox" id="nav-7">
    
    <label class="md-nav__link" for="nav-7">
      Migraciones de datos
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-7">
        Migraciones de datos
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap8/1_intro/" title="Qué son las migraciones de datos" class="md-nav__link">
      Qué son las migraciones de datos
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap8/2_versiones/" title="Versiones del modelo de datos" class="md-nav__link">
      Versiones del modelo de datos
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap8/3_migraciones_ligeras/" title="Migraciones ligeras" class="md-nav__link">
      Migraciones ligeras
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap8/4_migraciones_pesadas/" title="Migraciones pesadas" class="md-nav__link">
      Migraciones pesadas
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap8/5_ejercicios/" title="Ejercicios" class="md-nav__link">
      Ejercicios
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap8/apendice_migraciones_ios9/" title="Apéndice. migraciones en versiones antiguas de iOS" class="md-nav__link">
      Apéndice. migraciones en versiones antiguas de iOS
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-8" type="checkbox" id="nav-8">
    
    <label class="md-nav__link" for="nav-8">
      Concurrencia. Contextos múltiples
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-8">
        Concurrencia. Contextos múltiples
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap9/1_background/" title="Múltiples contextos para trabajos en *background*" class="md-nav__link">
      Múltiples contextos para trabajos en *background*
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap9/2_comunicacion/" title="Comunicación entre contextos" class="md-nav__link">
      Comunicación entre contextos
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap9/3_contextos_anidados/" title="Contextos anidados" class="md-nav__link">
      Contextos anidados
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap9/4_ejercicios/" title="Ejercicios" class="md-nav__link">
      Ejercicios
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-9" type="checkbox" id="nav-9">
    
    <label class="md-nav__link" for="nav-9">
      Persistencia como servicio
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-9">
        Persistencia como servicio
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap11/1_introduccion_BAAS/" title="Backend as a Service" class="md-nav__link">
      Backend as a Service
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap11/2_gestion_usuarios/" title="Gestión de usuarios en Firebase" class="md-nav__link">
      Gestión de usuarios en Firebase
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap11/3_persistencia/" title="Persistencia en Firebase" class="md-nav__link">
      Persistencia en Firebase
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap11/4_ejercicios/" title="Ejercicios" class="md-nav__link">
      Ejercicios
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-10" type="checkbox" id="nav-10" checked>
    
    <label class="md-nav__link" for="nav-10">
      Arquitecturas de aplicaciones en iOS
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-10">
        Arquitecturas de aplicaciones en iOS
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../intro/" title="Introducción" class="md-nav__link">
      Introducción
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../2_MVC/" title="Model/View/Controller" class="md-nav__link">
      Model/View/Controller
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../3_MVP/" title="Model/View/Presenter" class="md-nav__link">
      Model/View/Presenter
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Model/View/ViewModel
      </label>
    
    <a href="./" title="Model/View/ViewModel" class="md-nav__link md-nav__link--active">
      Model/View/ViewModel
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="__toc">Tabla de contenidos</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#mvvm" class="md-nav__link">
    MVVM
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mvvm-vs-mvp" class="md-nav__link">
    MVVM vs. MVP
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mvvm-con-la-libreria-bond" class="md-nav__link">
    MVVM con la librería "Bond"
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../5_VIPER/" title="VIPER" class="md-nav__link">
      VIPER
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../6a_ejercicios1/" title="Ejercicios parte I" class="md-nav__link">
      Ejercicios parte I
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../6_ejercicios/" title="Ejercicios parte II" class="md-nav__link">
      Ejercicios parte II
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../6_ejercicios_redux/" title="Ejercicios parte III" class="md-nav__link">
      Ejercicios parte III
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="__toc">Tabla de contenidos</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#mvvm" class="md-nav__link">
    MVVM
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#mvvm-vs-mvp" class="md-nav__link">
    MVVM vs. MVP
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mvvm-con-la-libreria-bond" class="md-nav__link">
    MVVM con la librería "Bond"
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                  <h1>Model/View/ViewModel</h1>
                
                <h2 id="mvvm">MVVM<a class="headerlink" href="#mvvm" title="Permanent link">&para;</a></h2>
<h3 id="mvvm-vs-mvp">MVVM vs. MVP<a class="headerlink" href="#mvvm-vs-mvp" title="Permanent link">&para;</a></h3>
<p>El patrón de diseño Model/View/ViewModel es muy similar al MVP que vimos en el apartado anterior. </p>
<p><img alt="" src="../img/mvvm.png" /></p>
<p>De hecho, el <em>ViewModel</em> tiene más o menos la misma funcionalidad que el <em>presenter</em>, implementar la lógica de presentación y aislarla de la tecnología concreta usada para la presentación.</p>
<p>¿Dónde está la diferencia entonces?. En que MVVM soluciona uno de los principales problemas que tiene MVP, el acoplamiento entre vista y <em>presenter</em>. Como estuvimos discutiendo, la <em>vista</em> y el <em>presenter</em> deben "conocerse" mutuamente, ya que la vista debe comunicarle a este las acciones del usuario, y el <em>presenter</em> enviarle a la vista los datos a mostrar. Esto hace que ambos componentes estén acoplados entre sí, ya hemos visto en el código de ejemplo de MVP que en la vista hay una referencia al <em>presenter</em> y viceversa. En MVVM no existe este acoplamiento, y lo vamos a evitar usando <em>bindings</em>, es decir, vinculación automática entre los datos de la modelo y el <em>presenter</em>, de manera que cuando cambie alguno de ellos se modifique automáticamente el otro. Esto permite que el código quede mucho más "limpio", ya que no hay que actualizar el otro componente de modo explícito.</p>
<p>En iOS no hay ninguna tecnología estándar para vincular elementos de la vista con propiedades del modelo (aunque en OSX sí existe). Podríamos usar KVO o notificaciones para hacer la vinculación, pero la implementación sería un poco tediosa. Así que tendremos que usar alguna librería de terceros. Aquí veremos una bastante sencilla de usar llamada <a href="https://github.com/ReactiveKit/Bond">Bond</a> (el nombre completo es Bond, Swift Bond :)).</p>
<blockquote>
<p>Para implementar los <em>bindings</em> podríamos usar también algún <em>framework</em> de <em>reactive programming</em>. Este paradigma de programación permite implementar la funcionalidad de manera bastante elegante. No obstante usar un <em>framework</em> de este tipo solo para implementar <em>bindings</em> probablemente sea demasiado, ya que la idea de <em>reactive programming</em> es bastante más amplia. En cualquier caso es posible que encontréis tutoriales y otros recursos de MVVM en iOS que usen <em>frameworks</em> reactivos como <a href="https://github.com/ReactiveCocoa/ReactiveCocoa">ReactiveCocoa</a> o <a href="https://github.com/ReactiveX/RxSwift">RXSwift</a>. De hecho, Bond está construido sobre un <em>framework</em> de este tipo, aunque más sencillo. Y como se verá, en el ejemplo usaremos funcionalidades típicas de <em>programación reactiva</em>.</p>
</blockquote>
<h3 id="mvvm-con-la-libreria-bond">MVVM con la librería "Bond"<a class="headerlink" href="#mvvm-con-la-libreria-bond" title="Permanent link">&para;</a></h3>
<p>Vamos a verlo con un ejemplo, ya que así se entenderán mejor los conceptos. Implementaremos ahora una versión MVVM de la aplicación <code>UAdivino</code>, al estilo de la que hicimos en el apartado anterior, es decir, mostrando cada tipo de respuesta de un color distinto. La diferencia fundamental va a estar en que vincularemos de modo automático tanto el texto de la respuesta como el color para que no haga falta fijarlos de forma explícita en la vista. Esta vinculación la haremos gracias a la librería Bond.</p>
<p>La forma más sencilla de configurar un proyecto de Xcode con Bond es usando Cocoapods. En el README de Bond en Github están <a href="https://github.com/ReactiveKit/Bond#installation">las instrucciones</a>. Vamos a empezar a trabajar suponiendo que ya se ha hecho esta configuración. Como en el caso de la versión MVP podéis consultar el <a href="https://github.com/ottocol/ejemplos-arquitectura-iOS/tree/master/MVVM/UAdivino">código fuente completo</a> en GitHub.</p>
<h4>Vinculación de <em>viewmodel</em> a vista</h4>
<p>Al vincular un <em>origen</em> con un <em>destino</em> lo que hacemos es que cuando el primero cambia, el segundo también lo hace automáticamente. Esto simplifica mucho el código ya que podemos cambiar una propiedad del <em>viewmodel</em> y que se refleje automáticamente en la vista, o viceversa.</p>
<p>En nuestro ejemplo del <code>UAdivino</code> queremos vincular dos propiedades del <em>viewmodel</em> con la vista: el texto de la respuesta y el color de la misma. En la librería Bond los <em>bindings</em> se basan en la idea de <strong>observable</strong>. Esta es una idea similar a la de los eventos. Podemos indicar que queremos observar un elemento <em>observable</em> de modo que se nos "avisará" de cuándo cambia su valor. No obstante a diferencia de los eventos, que ya suelen estar predefinidos en el sistema, podemos crear los observables "bajo demanda" y además como veremos se pueden manipular, transformar y combinar permitiéndonos hacer cosas complejas de modo relativamente sencillo. La idea de observable es la idea fundamental tras el paradigma de <strong>programación reactiva</strong>, aunque en este paradigma suele recibir otros nombres, siendo el más típico el de <em>stream</em> (en librerías como ReactiveCocoa se denominan <em>signals</em>).</p>
<p>Así, definiremos el texto de la respuesta como un observable "de tipo" <code>String</code> en lugar de simplemente como un <code>String</code>, para poder vincularlo a la vista. En el <em>viewmodel</em> haríamos esto para crear el observable con un valor inicial de "" (cadena vacía):</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kd">import</span> <span class="nc">Bond</span>

<span class="kd">let</span> <span class="nv">textoResp</span> <span class="p">=</span> <span class="n">Observable</span><span class="p">&lt;</span><span class="nb">String</span><span class="p">&gt;(</span><span class="s">&quot;&quot;</span><span class="p">)</span>
</pre></div>
</td></tr></table>

<p>Nótese que <code>textoResp</code> no es un <code>String</code> sino un <em>observable</em>. El valor que hay "dentro" del observable es accesible a través de su propiedad <code>value</code></p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="bp">print</span><span class="p">(</span><span class="n">textoResp</span><span class="p">.</span><span class="n">value</span><span class="p">)</span> <span class="c1">//imprimirá la cadena vacía</span>
<span class="n">textoResp</span><span class="p">.</span><span class="n">value</span> <span class="p">=</span> <span class="s">&quot;hola&quot;</span>
</pre></div>
</td></tr></table>

<p>Para vincular una propiedad de un elemento de <code>UIKit</code> con un observable usamos el método <code>bind(to:)</code>. La librería Bond extiende los elementos de interfaz añadiéndoles una propiedad <code>reactive</code>. Dentro de esta es donde están las propiedades "vinculables". Por ejemplo el texto de un campo estaría en <code>reactive.text</code>, el color en <code>reactive.textColor</code>, etc.</p>
<p>Supongamos que en la vista tenemos el <em>viewmodel</em> accesible en la propiedad <code>viewModel</code> (como veremos en el apartado siguiente). Entonces haríamos algo como:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kc">self</span><span class="p">.</span><span class="n">viewModel</span><span class="p">.</span><span class="n">textoResp</span><span class="p">.</span><span class="n">bind</span><span class="p">(</span><span class="n">to</span><span class="p">:</span><span class="kc">self</span><span class="p">.</span><span class="n">labelRespuesta</span><span class="p">.</span><span class="n">reactive</span><span class="p">.</span><span class="n">text</span><span class="p">)</span>
</pre></div>
</td></tr></table>

<p>para vincular el observable <code>textoResp</code> del <em>viewmodel</em> al texto de la etiqueta <code>labelRespuesta</code>. A partir de este momento cada vez que el <em>viewmodel</em> cambie el valor del observable se cambiará también el mensaje en la pantalla.</p>
<p>Vamos a ver ahora la vinculación entre el color de la respuesta y el que se muestra en pantalla. El <em>viewmodel</em> usa un tipo propio enumerado, <code>ColorRespuesta</code> para representar el color con que se debería mostrar la resupesta. Por tanto en el <em>viewmodel</em> crearemos un observable de este tipo con un valor inicial cualquiera.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kd">let</span> <span class="nv">colorResp</span> <span class="p">=</span> <span class="n">Observable</span><span class="p">&lt;</span><span class="n">ColorRespuesta</span><span class="p">&gt;(.</span><span class="n">verde</span><span class="p">)</span>
</pre></div>
</td></tr></table>

<blockquote>
<p>En iOS lo más sencillo para representar colores es usar la clase <code>UIColor</code>, pero recordemos que el <em>viewmodel</em> no debería contener código de <code>UIKit</code>, por eso usamos el tipo propio <code>ColorRespuesta</code>.</p>
</blockquote>
<p>Ahora el problema es que no podemos vincular directamente el color del <em>label</em> con este observable, ya que el color de los elementos de la interfaz es un <code>UIColor</code> y nosotros tenemos un tipo distinto. Sin embargo una idea bastante poderosa de <strong>los observables</strong> es que <strong>se pueden transformar</strong> y además de modo encadenado. Para ello se pueden usar las primitivas típicas de programación funcional (<code>map</code>, <code>filter</code>,...) y además algunas adicionales, dando lugar a lo que se conoce como FRP (<em>Functional Reactive Programming</em>). Por tanto lo que haremos será transformar el observable en un <code>UIColor</code> y vincular con este (ya que la transformación de un observable es también un observable, lo que nos permite encadenar operaciones). En la vista haríamos algo como:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="n">viewModel</span><span class="p">.</span><span class="n">colorResp</span>
    <span class="p">.</span><span class="bp">map</span> <span class="p">{</span>
       <span class="n">color</span> <span class="k">in</span>
       <span class="k">return</span> <span class="p">(</span><span class="n">color</span> <span class="p">==</span> <span class="p">.</span><span class="n">verde</span> <span class="p">?</span> <span class="bp">UIColor</span><span class="p">.</span><span class="n">green</span> <span class="p">:</span> <span class="bp">UIColor</span><span class="p">.</span><span class="n">red</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="p">.</span><span class="n">bind</span><span class="p">(</span><span class="n">to</span><span class="p">:</span> <span class="kc">self</span><span class="p">.</span><span class="n">labelRespuesta</span><span class="p">.</span><span class="n">reactive</span><span class="p">.</span><span class="n">textColor</span><span class="p">)</span>
</pre></div>
</td></tr></table>

<p>Recordemos que <code>map</code> parte de un valor y devuelve el valor transformado gracias a la clausura que se le pasa como parámetro.</p>
<h4>Vinculación de vista a <em>viewmodel</em></h4>
<p>En el ejemplo de <code>UAdivino</code> no hay ningún caso de uso de vinculación en la dirección contraria, es decir, de la vista hacia el <em>viewmodel</em>, así que pondremos otro ejemplo. Supongamos un campo de texto en que el usuario escribe un texto de búsqueda. En la vista tendremos definido un <em>outlet</em> que referencie el campo de texto. Vincularemos desde la propiedad <code>reactive.text</code> del campo hacia la propiedad correspondiente del <em>viewmodel</em>. Pero cuidado, el destino no puede ser un tipo "normal" de Swift sino que debe ser un <code>Observable</code>
En el <em>viewmodel</em></p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kd">var</span> <span class="nv">textoBusqueda</span> <span class="p">=</span> <span class="n">Observable</span><span class="p">&lt;</span><span class="nb">String</span><span class="p">&gt;(</span><span class="s">&quot;&quot;</span><span class="p">)</span>
</pre></div>
</td></tr></table>

<p>En la vista, suponiendo que el <em>viewmodel</em> es accesible a través de la propiedad <code>viewModel</code>:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kc">self</span><span class="p">.</span><span class="n">campoTexto</span><span class="p">.</span><span class="n">reactive</span><span class="p">.</span><span class="n">text</span><span class="p">.</span><span class="n">bind</span><span class="p">(</span><span class="n">to</span><span class="p">:</span><span class="n">viewModel</span><span class="p">.</span><span class="n">textoBusqueda</span><span class="p">)</span>
</pre></div>
</td></tr></table>

<p>Podemos establecer también una <strong>vinculación bidireccional</strong> de modo que cuando cambie cualquiera de los dos lados cambie el otro (de la propiedad a la vista y viceversa). Esto lo haríamos simplemente usando <code>bidirectionalBind</code> en lugar de <code>bind</code></p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kc">self</span><span class="p">.</span><span class="n">campoTexto</span><span class="p">.</span><span class="n">reactive</span><span class="p">.</span><span class="n">text</span><span class="p">.</span><span class="n">bidirectionalBind</span><span class="p">(</span><span class="n">to</span><span class="p">:</span><span class="n">viewModel</span><span class="p">.</span><span class="n">textoBusqueda</span><span class="p">)</span>
</pre></div>
</td></tr></table>

<h4>"Ensamblaje" de modelo, <em>viewmodel</em> y vista</h4>
<p>Al igual que en el caso de MVP, hay que conectar las "piezas": modelo, <em>viewmodel</em> y vista. Como según el esquema del patrón la vista "posee" al <em>viewmodel</em>, definiremos este como una propiedad de la vista:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kd">class</span> <span class="nc">UAdivinoView</span> <span class="p">:</span> <span class="bp">UIViewController</span> <span class="p">{</span>
   <span class="kd">let</span> <span class="nv">viewModel</span> <span class="p">=</span> <span class="n">UAdivinoViewModel</span><span class="p">()</span>
   <span class="p">...</span>
<span class="p">}</span> 
</pre></div>
</td></tr></table>

<p>Y como el <em>viewmodel</em> "posee" al modelo definiremos este como una propiedad del primero:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kd">class</span> <span class="nc">UAdivinoViewModel</span> <span class="p">{</span>
   <span class="kd">let</span> <span class="nv">model</span> <span class="p">=</span> <span class="n">UAdivinoModel</span><span class="p">(</span><span class="n">nombre</span><span class="p">:</span> <span class="s">&quot;Rappel&quot;</span><span class="p">)</span>
   <span class="p">...</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>

<p>En MVVM, una parte importante del ensamblaje es <strong>inicializar los *bindings</strong>*. Una forma sencilla de hacer esto es en el <code>viewDidLoad</code> de la vista:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kr">override</span> <span class="kd">func</span> <span class="nf">viewDidLoad</span><span class="p">()</span> <span class="p">{</span>
   <span class="kc">self</span><span class="p">.</span><span class="n">bindViewModel</span><span class="p">()</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nf">bindViewModel</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">//conectamos viewModel.textoResp -&gt; texto del label</span>
    <span class="n">viewModel</span><span class="p">.</span><span class="n">textoResp</span><span class="p">.</span><span class="n">bind</span><span class="p">(</span><span class="n">to</span><span class="p">:</span> <span class="kc">self</span><span class="p">.</span><span class="n">labelRespuesta</span><span class="p">.</span><span class="n">reactive</span><span class="p">.</span><span class="n">text</span><span class="p">)</span>
    <span class="p">...</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../3_MVP/" title="Model/View/Presenter" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Anterior
                </span>
                Model/View/Presenter
              </span>
            </div>
          </a>
        
        
          <a href="../5_VIPER/" title="VIPER" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Siguiente
                </span>
                VIPER
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application.ac79c3b0.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:"../.."}})</script>
      
    
  </body>
</html>
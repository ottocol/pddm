



<!doctype html>
<html lang="es" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
      
      
        <meta name="lang:clipboard.copy" content="Copiar al portapapeles">
      
        <meta name="lang:clipboard.copied" content="Copiado al portapapeles">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No se encontraron documentos">
      
        <meta name="lang:search.result.one" content="1 documento encontrado">
      
        <meta name="lang:search.result.other" content="# documentos encontrados">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.4.3">
    
    
      
        <title>Model/View/Controller - PDDM-iOS</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application.30686662.css">
      
        <link rel="stylesheet" href="../../assets/stylesheets/application-palette.a8b3c06d.css">
      
      
        
        
        <meta name="theme-color" content="#009688">
      
    
    
      <script src="../../assets/javascripts/modernizr.74668098.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../assets/fonts/material-icons.css">
    
    
    
      
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="teal" data-md-color-accent="teal">
  
    <svg class="md-svg">
      <defs>
        
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#modelovistacontrolador" tabindex="1" class="md-skip">
        Saltar a contenido
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../.." title="PDDM-iOS" class="md-header-nav__button md-logo">
          
            <img src="../../logo.png" width="24" height="24">
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              PDDM-iOS
            </span>
            <span class="md-header-nav__topic">
              
                Model/View/Controller
              
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Búsqueda" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Teclee para comenzar búsqueda
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main" role="main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="../.." title="PDDM-iOS" class="md-nav__button md-logo">
      
        <img src="../../logo.png" width="48" height="48">
      
    </a>
    PDDM-iOS
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-1" type="checkbox" id="nav-1">
    
    <label class="md-nav__link" for="nav-1">
      Persistencia básica
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-1">
        Persistencia básica
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap1/1.1_sistema_de_archivos/" title="Sistema de archivos" class="md-nav__link">
      Sistema de archivos
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap1/1.2_serializacion/" title="Serialización" class="md-nav__link">
      Serialización
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap1/1.3_property_lists/" title="Property lists" class="md-nav__link">
      Property lists
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap1/1.4_preferencias/" title="Preferencias" class="md-nav__link">
      Preferencias
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap1/1.5_ejercicios/" title="Ejercicios" class="md-nav__link">
      Ejercicios
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      SQLite
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        SQLite
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap2/2.1_intro_SQLite/" title="Introducción" class="md-nav__link">
      Introducción
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap2/2.2_API_SQLite/" title="El API de SQLIte" class="md-nav__link">
      El API de SQLIte
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap2/2.3_frameworks/" title="Frameworks para SQLite" class="md-nav__link">
      Frameworks para SQLite
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap2/2.4_ejercicios/" title="Ejercicios" class="md-nav__link">
      Ejercicios
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      ¡Hola Core Data!. Una aplicación de ejemplo
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        ¡Hola Core Data!. Una aplicación de ejemplo
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap3/3.1_intro/" title="Introducción a Core Data" class="md-nav__link">
      Introducción a Core Data
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap3/3.2_stack/" title="Crear el stack de Core Data en iOS" class="md-nav__link">
      Crear el stack de Core Data en iOS
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap3/3.3_entidades/" title="Las entidades. Almacenar datos" class="md-nav__link">
      Las entidades. Almacenar datos
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap3/3.4_recuperar_datos/" title="Recuperar los datos" class="md-nav__link">
      Recuperar los datos
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap3/apendice_ver_almacenamiento/" title="Apéndice. Cómo examinar el almacenamiento persistente" class="md-nav__link">
      Apéndice. Cómo examinar el almacenamiento persistente
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      Modelos de datos en Core Data
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        Modelos de datos en Core Data
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap4/4.1_crear_modelo/" title="Crear y editar modelos" class="md-nav__link">
      Crear y editar modelos
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap4/4.2_clases_propias/" title="Modelar las entidades en código Swift" class="md-nav__link">
      Modelar las entidades en código Swift
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap4/4.3_CRUD/" title="CRUD en Core Data" class="md-nav__link">
      CRUD en Core Data
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap4/4.4_validaciones/" title="Validaciones" class="md-nav__link">
      Validaciones
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap4/4.5_transformables/" title="Transformables" class="md-nav__link">
      Transformables
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap4/4.6_ejercicios/" title="Ejercicios de modelos de datos" class="md-nav__link">
      Ejercicios de modelos de datos
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      Búsquedas en Core Data
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        Búsquedas en Core Data
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap6/1_predicados/" title="Predicados" class="md-nav__link">
      Predicados
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap6/2_ordenacion/" title="Ordenación" class="md-nav__link">
      Ordenación
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap6/3_ejercicios/" title="Ejercicios" class="md-nav__link">
      Ejercicios
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6">
    
    <label class="md-nav__link" for="nav-6">
      Tablas en Core Data
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        Tablas en Core Data
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap7/1_el_frc/" title="El *fetched results controller*" class="md-nav__link">
      El *fetched results controller*
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap7/2_configuracion_basica/" title="Inicializar el "fetched results controller"" class="md-nav__link">
      Inicializar el "fetched results controller"
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap7/3_tabla/" title="Mostrar los datos en la tabla" class="md-nav__link">
      Mostrar los datos en la tabla
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap7/4_refrescar_tabla/" title="Refrescar la tabla" class="md-nav__link">
      Refrescar la tabla
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap7/5_secciones/" title="Secciones de tabla automáticas" class="md-nav__link">
      Secciones de tabla automáticas
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap7/6_ejercicios/" title="Ejercicios" class="md-nav__link">
      Ejercicios
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7" type="checkbox" id="nav-7">
    
    <label class="md-nav__link" for="nav-7">
      Migraciones de datos
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-7">
        Migraciones de datos
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap8/1_intro/" title="Qué son las migraciones de datos" class="md-nav__link">
      Qué son las migraciones de datos
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap8/2_versiones/" title="Versiones del modelo de datos" class="md-nav__link">
      Versiones del modelo de datos
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap8/3_migraciones_ligeras/" title="Migraciones ligeras" class="md-nav__link">
      Migraciones ligeras
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap8/4_migraciones_pesadas/" title="Migraciones pesadas" class="md-nav__link">
      Migraciones pesadas
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap8/apendice_migraciones_ios9/" title="Apéndice. migraciones en versiones antiguas de iOS" class="md-nav__link">
      Apéndice. migraciones en versiones antiguas de iOS
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-8" type="checkbox" id="nav-8">
    
    <label class="md-nav__link" for="nav-8">
      Concurrencia. Contextos múltiples
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-8">
        Concurrencia. Contextos múltiples
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap9/1_background/" title="Múltiples contextos para trabajos en *background*" class="md-nav__link">
      Múltiples contextos para trabajos en *background*
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap9/2_comunicacion/" title="Comunicación entre contextos" class="md-nav__link">
      Comunicación entre contextos
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap9/3_contextos_anidados/" title="Contextos anidados" class="md-nav__link">
      Contextos anidados
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap9/4_ejercicios/" title="Ejercicios" class="md-nav__link">
      Ejercicios
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-9" type="checkbox" id="nav-9">
    
    <label class="md-nav__link" for="nav-9">
      Miniproyecto
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-9">
        Miniproyecto
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../miniproyecto/restaurante/" title="Enunciado" class="md-nav__link">
      Enunciado
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-10" type="checkbox" id="nav-10">
    
    <label class="md-nav__link" for="nav-10">
      Persistencia como servicio
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-10">
        Persistencia como servicio
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap11/1_introduccion_BAAS/" title="Backend as a Service" class="md-nav__link">
      Backend as a Service
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap11/2_gestion_usuarios/" title="Gestión de usuarios en Firebase" class="md-nav__link">
      Gestión de usuarios en Firebase
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap11/3_persistencia/" title="Persistencia en Firebase" class="md-nav__link">
      Persistencia en Firebase
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap11/4_ejercicios/" title="Ejercicios" class="md-nav__link">
      Ejercicios
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-11" type="checkbox" id="nav-11" checked>
    
    <label class="md-nav__link" for="nav-11">
      Arquitecturas de aplicaciones en iOS
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-11">
        Arquitecturas de aplicaciones en iOS
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../intro/" title="Introducción" class="md-nav__link">
      Introducción
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Model/View/Controller
      </label>
    
    <a href="./" title="Model/View/Controller" class="md-nav__link md-nav__link--active">
      Model/View/Controller
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="__toc">Tabla de contenidos</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#modelovistacontrolador" class="md-nav__link">
    Modelo/Vista/Controlador
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#los-problemas-de-mvc" class="md-nav__link">
    Los problemas de MVC
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#controladores-ligeros" class="md-nav__link">
    Controladores "ligeros"
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../3_MVP/" title="Model/View/Presenter" class="md-nav__link">
      Model/View/Presenter
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../4_MVVM/" title="Model/View/ViewModel" class="md-nav__link">
      Model/View/ViewModel
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../5_VIPER/" title="VIPER" class="md-nav__link">
      VIPER
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../6_ejercicios/" title="Ejercicios MVVM" class="md-nav__link">
      Ejercicios MVVM
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="__toc">Tabla de contenidos</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#modelovistacontrolador" class="md-nav__link">
    Modelo/Vista/Controlador
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#los-problemas-de-mvc" class="md-nav__link">
    Los problemas de MVC
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#controladores-ligeros" class="md-nav__link">
    Controladores "ligeros"
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                  <h1>Model/View/Controller</h1>
                
                <h2 id="modelovistacontrolador">Modelo/Vista/Controlador<a class="headerlink" href="#modelovistacontrolador" title="Permanent link">&para;</a></h2>
<h3 id="los-problemas-de-mvc">Los problemas de MVC<a class="headerlink" href="#los-problemas-de-mvc" title="Permanent link">&para;</a></h3>
<p>En teoría la estructura de una aplicación iOS con MVC debería ser sencilla y "limpia", ya que cada uno de los tres componentes tiene una responsabilidad separada. </p>
<p><img alt="" src="../img/expectativa_mvc.png" /></p>
<p>En la práctica, la principal fuente de problemas de esta arquitectura es el <em>controlador</em>. Por un lado, el <code>UIViewController</code> está tan <strong>unido a la vista</strong> que acaba siendo parte de ella en lugar de un componente separado. En la realidad la arquitectura de muchas aplicaciones iOS acaba pareciéndose más a la siguiente figura que a la anterior:</p>
<p><img alt="" src="../img/realidad_mvc.png" /></p>
<p>Al estar tan acoplado el controlador a la vista se hace casi imposible hacer <em>testing</em> del controlador en sí, sin probar la interfaz de usuario, ya que tendríamos que hacer un <em>mock</em> de todos los componentes de la vista que interactúan con el controlador.</p>
<p>Por otro lado es fácil "dejarse llevar" y acabar asignándole <strong>demasiadas responsabilidades</strong> al controlador: colocar en él lógica de negocio, hacer que sea el <em>datasource</em> o el <em>delegate</em> de las tablas que contiene,... Esto da lugar a lo que de modo irónico se conoce como <em>massive view controller</em>.</p>
<blockquote>
<p>Casi todos los tutoriales y ejemplos sobre <em>frameworks</em> o APIs de iOS que encontraréis en la web o en los libros tienen este problema, incluyendo muchas veces el material que os damos en este curso. Como el objetivo del tutorial o del ejemplo es aprender sobre el <em>framework</em>/API que no conoces, se tiende a poner todo el código en el <em>view controller</em>, evitando crear clases adicionales que añadirían complejidad al ejemplo y distraerían del objetivo principal. Pero por desgracia el resultado final es un <em>Massive View Controller</em>.</p>
</blockquote>
<p>Para solucionar todos estos problemas podemos usar una arquitectura distinta a MVC, como veremos en apartados posteriores. Pero no todo son problemas en MVC tal como lo propone Apple: tiene la ventaja de estar especialmente adaptado a la filosofía de la plataforma, los <em>frameworks</em> y los APIs de iOS, y además es una arquitectura sencilla. Una alternativa sería continuar usándolo pero intentar "aligerar" el controlador en la medida de lo posible para hacer el código más mantenible. Vamos a ver cómo podríamos hacerlo.</p>
<h3 id="controladores-ligeros">Controladores "ligeros"<a class="headerlink" href="#controladores-ligeros" title="Permanent link">&para;</a></h3>
<p>Básicamente la idea es dejar en el controlador el mínimo de código imprescindible para coordinarse con el modelo y con la vista, que es la que debería ser su única labor. Esto no es más que una aplicación del "Principio de responsabilidad única" (Single Responsibility Principe), un principio básico en el diseño y desarrollo de software que sostiene que <em>cada componente debería tener una única responsabilidad o funcionalidad en el sistema</em>. Esto no solo mejora la estructura del código, sino que también facilita el testing y mejora la mantenibilidad de la aplicación.</p>
<p>Si "nos dejamos llevar" y colocamos todo el código de la aplicación en el <em>view controller</em>, al final puede acabar teniendo las siguientes responsabilidades:</p>
<ul>
<li>Almacenar temporalmente y modificar los datos de la aplicación</li>
<li>Implementar al menos parte de la lógica de negocio, que debería estar únicamente en las clases del modelo</li>
<li>Implementar la persistencia de datos. Si además usamos Core Data y necesitamos listar datos con un <em>fetched results controller</em>, el <em>view controller</em> acaba teniendo que convertirse en su <em>delegate</em>.</li>
<li>En caso de tener una tabla:<ul>
<li>Típicamente es <em>datasource</em> y <em>delegate</em> de la misma</li>
<li>Al ser el <em>datasource</em>, se tiene que encargar de rellenar todos los datos de cada celda, por lo que tiene que conocer su estructura</li>
</ul>
</li>
<li>El <em>view controller</em> acaba convirtiéndose la mayoría de veces en el <em>delegate</em> de los componentes de interfaz que requieren uno, por ejemplo los <em>sliders</em> o los <em>datepickers</em>.</li>
<li>Muchas veces cuando de un <em>view controller</em> se salta a otro este le pasa los datos fijando propiedades en el <em>view controller</em> destino. Eso implica un conocimiento de la estructura interna de este <em>controller</em>.</li>
</ul>
<p>Básicamente la solución es relativamente de "sentido común" y consiste en extraer todas estas funcionalidades a clases/<em>structs</em> adicionales. Vamos a ver algunas ideas genéricas de cómo se podrían hacer estas refactorizaciones.</p>
<h4>Separación de los <em>datasources</em>/<em>delegates</em></h4>
<p>Vamos a ver cómo se podría extraer el <em>datasource</em> de una tabla. Un <em>delegate</em> sería similar. Intentaremos hacer una clase genérica que nos pueda servir en varios proyectos. Dicha clase:</p>
<ul>
<li>Por supuesto implementa los métodos del protocolo <code>UITableViewDataSource</code></li>
<li>Contiene un array con los objetos a mostrar, ya que es la forma más sencilla de representar los datos.</li>
<li>Acepta en el constructor una clausura que se encarga de rellenar los campos de una celda a partir de un objeto</li>
</ul>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kd">import</span> <span class="nc">Foundation</span>
<span class="kd">import</span> <span class="nc">UIKit</span>

<span class="kd">class</span> <span class="nc">ListaItemsDataSource</span><span class="p">&lt;</span><span class="n">Item</span><span class="p">&gt;</span> <span class="p">:</span> <span class="bp">NSObject</span><span class="p">,</span> <span class="bp">UITableViewDataSource</span> <span class="p">{</span>
    <span class="kd">private</span> <span class="kd">var</span> <span class="nv">items</span> <span class="p">:</span> <span class="p">[</span><span class="n">Item</span><span class="p">]</span>
    <span class="kd">private</span> <span class="kd">var</span> <span class="nv">idCelda</span> <span class="p">:</span> <span class="nb">String</span>
    <span class="kd">private</span> <span class="kd">var</span> <span class="nv">configurarCelda</span> <span class="p">:</span> <span class="p">(</span><span class="bp">UITableViewCell</span><span class="p">,</span> <span class="n">Item</span><span class="p">)</span> <span class="p">-&gt;</span> <span class="nb">Void</span>

    <span class="kd">init</span><span class="p">(</span><span class="n">listaItems</span><span class="p">:</span> <span class="p">[</span><span class="n">Item</span><span class="p">],</span> <span class="n">idCelda</span> <span class="p">:</span> <span class="nb">String</span><span class="p">,</span> <span class="n">configurarCelda</span> <span class="p">:</span> <span class="p">@</span><span class="n">escaping</span> <span class="p">(</span><span class="bp">UITableViewCell</span><span class="p">,</span> <span class="n">Item</span><span class="p">)</span> <span class="p">-&gt;</span> <span class="nb">Void</span><span class="p">)</span> <span class="p">{</span>
        <span class="kc">self</span><span class="p">.</span><span class="n">items</span> <span class="p">=</span> <span class="n">listaItems</span>
        <span class="kc">self</span><span class="p">.</span><span class="n">idCelda</span> <span class="p">=</span> <span class="n">idCelda</span>
        <span class="kc">self</span><span class="p">.</span><span class="n">configurarCelda</span> <span class="p">=</span> <span class="n">configurarCelda</span>
    <span class="p">}</span>

    <span class="kd">func</span> <span class="nf">tableView</span><span class="p">(</span><span class="kc">_</span> <span class="n">tableView</span><span class="p">:</span> <span class="bp">UITableView</span><span class="p">,</span> <span class="n">numberOfRowsInSection</span> <span class="n">section</span><span class="p">:</span> <span class="nb">Int</span><span class="p">)</span> <span class="p">-&gt;</span> <span class="nb">Int</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">items</span><span class="p">.</span><span class="bp">count</span>
    <span class="p">}</span>

    <span class="kd">func</span> <span class="nf">tableView</span><span class="p">(</span><span class="kc">_</span> <span class="n">tableView</span><span class="p">:</span> <span class="bp">UITableView</span><span class="p">,</span> <span class="n">cellForRowAt</span> <span class="n">indexPath</span><span class="p">:</span> <span class="n">IndexPath</span><span class="p">)</span> <span class="p">-&gt;</span> <span class="bp">UITableViewCell</span> <span class="p">{</span>
        <span class="kd">let</span> <span class="nv">cell</span> <span class="p">=</span> <span class="n">tableView</span><span class="p">.</span><span class="n">dequeueReusableCell</span><span class="p">(</span><span class="n">withIdentifier</span><span class="p">:</span> <span class="kc">self</span><span class="p">.</span><span class="n">idCelda</span><span class="p">,</span> <span class="k">for</span><span class="p">:</span> <span class="n">indexPath</span><span class="p">)</span>
        <span class="kc">self</span><span class="p">.</span><span class="n">configurarCelda</span><span class="p">(</span><span class="n">cell</span><span class="p">,</span> <span class="kc">self</span><span class="p">.</span><span class="n">items</span><span class="p">[</span><span class="n">indexPath</span><span class="p">.</span><span class="n">row</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">cell</span>
    <span class="p">}</span>   
<span class="p">}</span>
</pre></div>
</td></tr></table>

<p>Y aquí tenemos un <em>view controller</em> de ejemplo que hace uso de esta clase. Por ejemplo supongamos que queremos mostrar una lista de objetos <code>Persona</code></p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kd">class</span> <span class="nc">MiController</span><span class="p">:</span> <span class="bp">UIViewController</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nv">miDataSource</span> <span class="p">:</span> <span class="n">ListaItemsDataSource</span><span class="p">&lt;</span><span class="n">Usuario</span><span class="p">&gt;</span><span class="o">!</span>

    <span class="kr">override</span> <span class="kd">func</span> <span class="nf">viewDidLoad</span><span class="p">()</span> <span class="p">{</span>
        <span class="kc">super</span><span class="p">.</span><span class="n">viewDidLoad</span><span class="p">()</span>

        <span class="c1">//Tendríamos que obtener los datos de algún sitio, p.ej. de Core Data</span>
        <span class="kd">let</span> <span class="nv">lista</span> <span class="p">=</span> <span class="p">...</span>
        <span class="kc">self</span><span class="p">.</span><span class="n">miDataSource</span> <span class="p">=</span> <span class="n">ListaItemsDataSource</span><span class="p">&lt;</span><span class="n">Usuario</span><span class="p">&gt;(</span><span class="n">listaItems</span><span class="p">:</span> <span class="n">lista</span><span class="p">,</span> <span class="n">idCelda</span><span class="p">:</span> <span class="s">&quot;MiCelda&quot;</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">celda</span><span class="p">,</span><span class="n">persona</span> <span class="k">in</span>
              <span class="n">celda</span><span class="p">.</span><span class="n">textLabel</span><span class="p">?.</span><span class="n">text</span> <span class="p">=</span> <span class="n">persona</span><span class="p">.</span><span class="n">nombre</span>
              <span class="kd">let</span> <span class="nv">df</span> <span class="p">=</span> <span class="n">DateFormatter</span><span class="p">()</span>
              <span class="n">df</span><span class="p">.</span><span class="n">dateFormat</span> <span class="p">=</span> <span class="s">&quot;dd/MM/yyyy&quot;</span>
              <span class="kd">let</span> <span class="nv">fechaString</span> <span class="p">=</span> <span class="n">df</span><span class="p">.</span><span class="n">string</span><span class="p">(</span><span class="n">from</span><span class="p">:</span> <span class="n">persona</span><span class="p">.</span><span class="n">fechaNacimiento</span><span class="p">)</span>
              <span class="n">celda</span><span class="p">.</span><span class="n">detailTextLabel</span><span class="p">?.</span><span class="n">text</span> <span class="p">=</span> <span class="n">fechaString</span>
        <span class="p">}</span>
        <span class="kc">self</span><span class="p">.</span><span class="n">tableView</span><span class="p">.</span><span class="n">dataSource</span> <span class="p">=</span> <span class="kc">self</span><span class="p">.</span><span class="n">miDataSource</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>

<h4>Extraer el código de configuración de la celda</h4>
<p>En el código anterior el View Controller sigue teniendo que ocuparse de rellenar los campos de la celda, lo que hace que tenga que conocer su estructura: en el ejemplo, que la celda tiene un <code>textLabel</code> y un <code>detailTextLabel</code> y también que tenga que ocuparse de formatear los datos, por ejemplo la fecha.</p>
<p>Podemos encapsular la información sobre la "estructura interna" de la celda en una nueva clase, que en MVC pertenecería a la vista. </p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kd">class</span> <span class="nc">CeldaPersona</span> <span class="p">:</span> <span class="bp">UITableViewCell</span> <span class="p">{</span>
    <span class="kd">static</span> <span class="kd">let</span> <span class="nv">idCelda</span> <span class="p">=</span> <span class="s">&quot;MiCelda&quot;</span>
    <span class="kd">var</span> <span class="nv">nombre</span> <span class="p">:</span> <span class="nb">String</span><span class="p">?</span> <span class="p">{</span>
        <span class="kr">didSet</span> <span class="p">{</span>
            <span class="kc">self</span><span class="p">.</span><span class="n">textLabel</span><span class="p">?.</span><span class="n">text</span> <span class="p">=</span> <span class="kc">self</span><span class="p">.</span><span class="n">nombre</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="kd">var</span> <span class="nv">fecha</span> <span class="p">:</span> <span class="n">Date</span><span class="p">?</span> <span class="p">{</span>
        <span class="kr">didSet</span> <span class="p">{</span>
            <span class="kd">let</span> <span class="nv">df</span> <span class="p">=</span> <span class="n">DateFormatter</span><span class="p">()</span>
            <span class="n">df</span><span class="p">.</span><span class="n">dateStyle</span> <span class="p">=</span> <span class="p">.</span><span class="n">short</span>
            <span class="kc">self</span><span class="p">.</span><span class="n">detailTextLabel</span><span class="p">?.</span><span class="n">text</span> <span class="p">=</span> <span class="n">df</span><span class="p">.</span><span class="n">string</span><span class="p">(</span><span class="n">from</span><span class="p">:</span> <span class="kc">self</span><span class="p">.</span><span class="n">fecha</span><span class="p">!)</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>

<p>Nótese que ahora "desde fuera" para configurar la celda lo único que hay que hacer es fijar el valor de las propiedades "texto" y "fecha". Los <code>didSet</code> se encargarán automáticamente de rellenar los campos de la celda con el formato adecuado.</p>
<p>De este modo el <em>view controller</em> quedaría aún más sencillo</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kd">class</span> <span class="nc">MiController</span><span class="p">:</span> <span class="bp">UIViewController</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nv">miDataSource</span> <span class="p">:</span> <span class="n">ListaItemsDataSource</span><span class="p">&lt;</span><span class="n">Usuario</span><span class="p">&gt;</span><span class="o">!</span>

    <span class="kr">override</span> <span class="kd">func</span> <span class="nf">viewDidLoad</span><span class="p">()</span> <span class="p">{</span>
        <span class="kc">super</span><span class="p">.</span><span class="n">viewDidLoad</span><span class="p">()</span>

        <span class="c1">//Tendríamos que obtener los datos de algún sitio, p.ej. de Core Data</span>
        <span class="kd">let</span> <span class="nv">lista</span> <span class="p">=</span> <span class="p">...</span>
        <span class="kc">self</span><span class="p">.</span><span class="n">miDataSource</span> <span class="p">=</span> <span class="n">ListaItemsDataSource</span><span class="p">&lt;</span><span class="n">Usuario</span><span class="p">&gt;(</span><span class="n">listaItems</span><span class="p">:</span> <span class="n">lista</span><span class="p">,</span> <span class="n">idCelda</span><span class="p">:</span> <span class="s">&quot;MiCelda&quot;</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">celda</span><span class="p">,</span><span class="n">persona</span> <span class="k">in</span>
              <span class="k">if</span> <span class="kd">let</span> <span class="nv">celdaPersona</span> <span class="p">=</span> <span class="n">celda</span> <span class="k">as</span><span class="p">?</span> <span class="n">CeldaPersona</span> <span class="p">{</span>
                <span class="n">celdaPersona</span><span class="p">.</span><span class="n">nombre</span> <span class="p">=</span> <span class="n">persona</span><span class="p">.</span><span class="n">nombre</span>
                <span class="n">celdaPersona</span><span class="p">.</span><span class="n">fecha</span> <span class="p">=</span> <span class="n">persona</span><span class="p">.</span><span class="n">fechaNacimiento</span>
              <span class="p">}</span> 
        <span class="p">}</span>
        <span class="kc">self</span><span class="p">.</span><span class="n">tableView</span><span class="p">.</span><span class="n">dataSource</span> <span class="p">=</span> <span class="kc">self</span><span class="p">.</span><span class="n">miDataSource</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>

<p>Para que el <em>cast</em> de <code>celda as CeldaPersona</code> pueda tener éxito, en Xcode habrá que seleccionar la celda prototipo en el <em>storyboard</em> y cambiar en el "identity inspector" del panel derecho la clase de la celda por <code>CeldaPersona</code>.</p>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../intro/" title="Introducción" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Anterior
                </span>
                Introducción
              </span>
            </div>
          </a>
        
        
          <a href="../3_MVP/" title="Model/View/Presenter" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Siguiente
                </span>
                Model/View/Presenter
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application.ac79c3b0.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:"../.."}})</script>
      
    
  </body>
</html>

<!doctype html>
<html lang="es" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.2.2, mkdocs-material-7.3.2">
    
    
      
        <title>Miniproyecto: *app* restaurante. Parte 1: El modelo de datos - PDDM-iOS</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.24c991ad.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.3f5d1f46.min.css">
        
          
          
          <meta name="theme-color" content="#009485">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style>
      
    
    
    
    
      


    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="teal" data-md-color-accent="teal">
  
    
    <script>function __prefix(e){return new URL("../..",location).pathname+"."+e}function __get(e,t=localStorage){return JSON.parse(t.getItem(__prefix(e)))}</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#miniproyecto-app-restaurante-parte-1-el-modelo-de-datos" class="md-skip">
          Saltar a contenido
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Cabecera">
    <a href="../.." title="PDDM-iOS" class="md-header__button md-logo" aria-label="PDDM-iOS" data-md-component="logo">
      
  <img src="../../logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            PDDM-iOS
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Miniproyecto: *app* restaurante. Parte 1: El modelo de datos
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Búsqueda" placeholder="Búsqueda" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Limpiar" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Inicializando búsqueda
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navegación" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="PDDM-iOS" class="md-nav__button md-logo" aria-label="PDDM-iOS" data-md-component="logo">
      
  <img src="../../logo.png" alt="logo">

    </a>
    PDDM-iOS
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1" type="checkbox" id="__nav_1" >
      
      
      
      
        <label class="md-nav__link" for="__nav_1">
          Persistencia básica
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Persistencia básica" data-md-level="1">
        <label class="md-nav__title" for="__nav_1">
          <span class="md-nav__icon md-icon"></span>
          Persistencia básica
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cap1/1.0_introduccion/" class="md-nav__link">
        Introducción
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cap1/1.1_sistema_de_archivos/" class="md-nav__link">
        Sistema de archivos
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cap1/1.2_serializacion/" class="md-nav__link">
        Serialización
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cap1/1.3_property_lists/" class="md-nav__link">
        Property lists
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cap1/1.4_preferencias/" class="md-nav__link">
        Preferencias
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Tabla de contenidos">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Tabla de contenidos
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#el-modelo-de-datos-1-punto" class="md-nav__link">
    El modelo de datos (1 punto)
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#inicializar-los-datos-05-puntos" class="md-nav__link">
    Inicializar los datos (0,5 puntos)
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="miniproyecto-app-restaurante-parte-1-el-modelo-de-datos">Miniproyecto: <em>app</em> restaurante. Parte 1: El modelo de datos<a class="headerlink" href="#miniproyecto-app-restaurante-parte-1-el-modelo-de-datos" title="Permanent link">&para;</a></h1>
<p>El objetivo es desarrollar una pequeña aplicación para gestionar pedidos <em>online</em> a un restaurante. Para ello almacenaremos los datos de la carta y de los pedidos realizados por el usuario en Core Data.</p>
<p>Descárgate la plantilla de la aplicación desde moodle, aquí está ya implementada la mayor parte de la interfaz.</p>
<p>En esta primera sesión nos ocuparemos del modelo de datos y de leer los datos de los platos, que están almacenados en un JSON, y pasarlos a Core Data.</p>
<h2 id="el-modelo-de-datos-1-punto">El modelo de datos (1 punto)<a class="headerlink" href="#el-modelo-de-datos-1-punto" title="Permanent link">&para;</a></h2>
<p><strong>En el proyecto abre el fichero <code>Restaurante.xcdatamodeld</code> y crea el siguiente modelo de datos</strong></p>
<p>Nuestro modelo de datos debe tener tres entidades, <code>Plato</code>, <code>Pedido</code> y <code>LineaPedido</code>. Esta última es la que relaciona los platos con los pedidos,  guardando cuántas unidades de un plato se han incluido en un pedido. </p>
<p><img alt="" src="../modelo_datos.png" /></p>
<p>Cada entidad debe tener las siguientes propiedades y relaciones</p>
<ul>
<li><code>Plato</code>:<ul>
<li>Propiedades:<ul>
<li><code>nombre</code> de tipo <code>String</code></li>
<li><code>descripcion</code> de tipo <code>String</code></li>
<li><code>precio</code> de tipo <code>Double</code></li>
<li><code>tipo</code> de tipo <code>String</code></li>
</ul>
</li>
<li>Relaciones:<ul>
<li><code>lineasPedido</code>, relación "a muchos" con destino <code>LineaPedido</code>. La inversa es la relación <code>plato</code></li>
</ul>
</li>
</ul>
</li>
<li><code>Pedido</code>:<ul>
<li>Propiedades:<ul>
<li><code>direccion</code> de tipo <code>String</code></li>
<li><code>telefono</code> de tipo <code>String</code></li>
<li><code>fecha</code> de tipo <code>Date</code></li>
<li><code>total</code> de tipo `Double</li>
</ul>
</li>
<li>Relaciones:<ul>
<li><code>lineasPedido</code>, relación "a muchos" con destino <code>LineaPedido</code>. La relación <strong>debe ser ordenada</strong>, para poder mostrar las lineas de un pedido siempre en el mismo orden. La inversa es la relación <code>pedido</code>. En la regla de borrado (<code>delete rule</code>) pon <code>Cascade</code> para que al eliminar un pedido se eliminen automáticamente sus líneas.</li>
</ul>
</li>
</ul>
</li>
<li><code>LineaPedido</code>:<ul>
<li>Propiedades<ul>
<li><code>cantidad</code> de tipo <code>Integer 16</code></li>
</ul>
</li>
<li>Relaciones<ul>
<li><code>pedido</code>, relación "a uno" con destino <code>Pedido</code>. La inversa es la relación <code>lineasPedido</code></li>
<li><code>plato</code>, relación "a uno" con destino <code>Plato</code>. La inversa es la relación <code>lineasPedido</code></li>
</ul>
</li>
</ul>
</li>
</ul>
<blockquote>
<p><strong>Simplificaciones</strong>: en realidad se deberían usar tipos <code>Decimal</code> en los precios para evitar errores de redondeo, pero usaremos <code>Double</code> por simplicidad de uso. Además, el tipo del plato debería ser un enumerado, pero estos no se pueden almacenar directamente en Core Data. Tendríamos que generar manualmente el código de las entidades para poder representar los datos externamente como <em>enums</em> e internamente como otro tipo.</p>
</blockquote>
<h2 id="inicializar-los-datos-05-puntos">Inicializar los datos (0,5 puntos)<a class="headerlink" href="#inicializar-los-datos-05-puntos" title="Permanent link">&para;</a></h2>
<p>Los datos de los platos del restaurante están en un archivo <code>platos.json</code>.  En el <code>AppDelegate</code> hay una función <code>importPlatos</code> que lee el JSON, lo almacena en un array de <code>structs</code> de tipo <code>DatosPlato</code> con los datos correspondientes, y pone una preferencia de usuario llamada <code>platosImportados</code> a <code>true</code>. El JSON solo se lee si la preferencia está a <code>false</code> (valor por defecto)</p>
<p><strong>Añade código Swift que copie los datos de los structs a entidades <code>Plato</code> y guarde el contexto de persistencia para hacer efectivos los cambios</strong>. Tendrás que introducir el código en el <code>AppDelegate</code>, donde está el comentario de <code>TODO:</code>. El array de structs de tipo <code>DatosPlato</code> se llama <code>datos</code>. Copia todos sus datos a Core Data. </p>
<p>Tras esto, con la ayuda de la aplicación <a href="https://github.com/dsmelov/simsim/blob/master/Release/SimSim_latest.zip?raw=true"><code>SimSim</code></a> puedes echarle un vistazo a la base de datos de SQLite creada por Core Data para ver si están los registros. En <code>SimSim</code> selecciona la app <code>Restaurante</code> y luego la opción <code>Finder</code> para abrir la carpeta donde se guardan sus datos en el emulador. La base de datos de SQLite se almacena en <code>Library/Application Support</code>. Luego con la ayuda de algún visor de SQLite puedes ver el contenido de la BD. Si no tienes ninguno instalado puedes usar <a href="https://sqliteonline.com/">https://sqliteonline.com/</a>.</p>
<p>Para forzar la recarga de los datos también puedes usar también la aplicación <code>SimSim</code> . Tendrás que borrar las preferencias y la base de datos. Las preferencias están en <code>Library/Preferences</code>.</p>
                
              
              
                


              
            </article>
          </div>
        </div>
        
      </main>
      
        
<footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        
          Made with
          <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
            Material for MkDocs
          </a>
        
        
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../..", "features": [], "translations": {"clipboard.copy": "Copiar al portapapeles", "clipboard.copied": "Copiado al portapapeles", "search.config.lang": "es", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "B\u00fasqueda", "search.result.placeholder": "Teclee para comenzar b\u00fasqueda", "search.result.none": "No se encontraron documentos", "search.result.one": "1 documento encontrado", "search.result.other": "# documentos encontrados", "search.result.more.one": "1 m\u00e1s en esta p\u00e1gina", "search.result.more.other": "# m\u00e1s en esta p\u00e1gina", "search.result.term.missing": "Falta", "select.version.title": "Seleccionar versi\u00f3n"}, "search": "../../assets/javascripts/workers/search.e99e714c.min.js", "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.bc35569b.min.js"></script>
      
    
  </body>
</html>
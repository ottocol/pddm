



<!doctype html>
<html lang="es" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
      
      
        <meta name="lang:clipboard.copy" content="Copiar al portapapeles">
      
        <meta name="lang:clipboard.copied" content="Copiado al portapapeles">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No se encontraron documentos">
      
        <meta name="lang:search.result.one" content="1 documento encontrado">
      
        <meta name="lang:search.result.other" content="# documentos encontrados">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.4.3">
    
    
      
        <title>Las entidades. Almacenar datos - PDDM-iOS</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application.30686662.css">
      
        <link rel="stylesheet" href="../../assets/stylesheets/application-palette.a8b3c06d.css">
      
      
        
        
        <meta name="theme-color" content="#009688">
      
    
    
      <script src="../../assets/javascripts/modernizr.74668098.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../assets/fonts/material-icons.css">
    
    
    
      
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="teal" data-md-color-accent="teal">
  
    <svg class="md-svg">
      <defs>
        
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#las-entidades" tabindex="1" class="md-skip">
        Saltar a contenido
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../.." title="PDDM-iOS" class="md-header-nav__button md-logo">
          
            <img src="../../logo.png" width="24" height="24">
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              PDDM-iOS
            </span>
            <span class="md-header-nav__topic">
              
                Las entidades. Almacenar datos
              
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Búsqueda" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Teclee para comenzar búsqueda
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main" role="main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="../.." title="PDDM-iOS" class="md-nav__button md-logo">
      
        <img src="../../logo.png" width="48" height="48">
      
    </a>
    PDDM-iOS
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-1" type="checkbox" id="nav-1">
    
    <label class="md-nav__link" for="nav-1">
      Persistencia básica
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-1">
        Persistencia básica
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap1/1.1_sistema_de_archivos/" title="Sistema de archivos" class="md-nav__link">
      Sistema de archivos
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap1/1.2_serializacion/" title="Serialización" class="md-nav__link">
      Serialización
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap1/1.3_property_lists/" title="Property lists" class="md-nav__link">
      Property lists
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap1/1.4_preferencias/" title="Preferencias" class="md-nav__link">
      Preferencias
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap1/1.5_ejercicios/" title="Ejercicios" class="md-nav__link">
      Ejercicios
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      SQLite
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        SQLite
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap2/2.1_intro_SQLite/" title="Introducción" class="md-nav__link">
      Introducción
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap2/2.2_API_SQLite/" title="El API de SQLIte" class="md-nav__link">
      El API de SQLIte
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap2/2.3_frameworks/" title="Frameworks para SQLite" class="md-nav__link">
      Frameworks para SQLite
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap2/2.4_ejercicios/" title="Ejercicios" class="md-nav__link">
      Ejercicios
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      Persistencia como servicio
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        Persistencia como servicio
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap11/1_introduccion_BAAS/" title="Backend as a Service" class="md-nav__link">
      Backend as a Service
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap11/2_gestion_usuarios/" title="Gestión de usuarios en Firebase" class="md-nav__link">
      Gestión de usuarios en Firebase
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap11/3_persistencia/" title="Persistencia en Firebase" class="md-nav__link">
      Persistencia en Firebase
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap11/4_ejercicios/" title="Ejercicios" class="md-nav__link">
      Ejercicios
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4" checked>
    
    <label class="md-nav__link" for="nav-4">
      ¡Hola Core Data!. Una aplicación de ejemplo
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        ¡Hola Core Data!. Una aplicación de ejemplo
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../3.1_intro/" title="Introducción a Core Data" class="md-nav__link">
      Introducción a Core Data
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../3.2_stack/" title="Crear el stack de Core Data en iOS" class="md-nav__link">
      Crear el stack de Core Data en iOS
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Las entidades. Almacenar datos
      </label>
    
    <a href="./" title="Las entidades. Almacenar datos" class="md-nav__link md-nav__link--active">
      Las entidades. Almacenar datos
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="__toc">Tabla de contenidos</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#las-entidades" class="md-nav__link">
    Las entidades
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#crear-las-entidades-1-punto" class="md-nav__link">
    Crear las entidades (1 punto)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#crear-datos-persistentes-2-puntos" class="md-nav__link">
    Crear datos persistentes (2 puntos)
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../3.4_recuperar_datos/" title="Recuperar los datos" class="md-nav__link">
      Recuperar los datos
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      Modelos de datos en Core Data
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        Modelos de datos en Core Data
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap4/4.1_crear_modelo/" title="Crear y editar modelos" class="md-nav__link">
      Crear y editar modelos
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap4/4.2_clases_propias/" title="Modelar las entidades en código Swift" class="md-nav__link">
      Modelar las entidades en código Swift
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap4/4.3_CRUD/" title="CRUD en Core Data" class="md-nav__link">
      CRUD en Core Data
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap4/4.4_ejercicios/" title="Ejercicios de modelos de datos" class="md-nav__link">
      Ejercicios de modelos de datos
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6">
    
    <label class="md-nav__link" for="nav-6">
      Búsquedas en Core Data
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        Búsquedas en Core Data
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap6/1_predicados/" title="Predicados" class="md-nav__link">
      Predicados
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap6/2_ordenacion/" title="Ordenación" class="md-nav__link">
      Ordenación
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap6/3_ejercicios/" title="Ejercicios" class="md-nav__link">
      Ejercicios
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7" type="checkbox" id="nav-7">
    
    <label class="md-nav__link" for="nav-7">
      Tablas en Core Data
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-7">
        Tablas en Core Data
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap7/1_el_frc/" title="El *fetched results controller*" class="md-nav__link">
      El *fetched results controller*
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap7/2_configuracion_basica/" title="Inicializar el "fetched results controller"" class="md-nav__link">
      Inicializar el "fetched results controller"
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap7/3_tabla/" title="Mostrar los datos en la tabla" class="md-nav__link">
      Mostrar los datos en la tabla
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap7/4_refrescar_tabla/" title="Refrescar la tabla" class="md-nav__link">
      Refrescar la tabla
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap7/5_secciones/" title="Secciones de tabla automáticas" class="md-nav__link">
      Secciones de tabla automáticas
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap7/6_ejercicios/" title="Ejercicios" class="md-nav__link">
      Ejercicios
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-8" type="checkbox" id="nav-8">
    
    <label class="md-nav__link" for="nav-8">
      Migraciones de datos
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-8">
        Migraciones de datos
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap8/1_intro/" title="Qué son las migraciones de datos" class="md-nav__link">
      Qué son las migraciones de datos
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap8/2_versiones/" title="Versiones del modelo de datos" class="md-nav__link">
      Versiones del modelo de datos
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap8/3_migraciones_ligeras/" title="Migraciones ligeras" class="md-nav__link">
      Migraciones ligeras
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap8/4_migraciones_pesadas/" title="Migraciones pesadas" class="md-nav__link">
      Migraciones pesadas
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap8/5_ejercicios/" title="Ejercicios" class="md-nav__link">
      Ejercicios
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap8/apendice_migraciones_ios9/" title="Apéndice. migraciones en versiones antiguas de iOS" class="md-nav__link">
      Apéndice. migraciones en versiones antiguas de iOS
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-9" type="checkbox" id="nav-9">
    
    <label class="md-nav__link" for="nav-9">
      Concurrencia. Contextos múltiples
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-9">
        Concurrencia. Contextos múltiples
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap9/1_background/" title="Múltiples contextos para trabajos en *background*" class="md-nav__link">
      Múltiples contextos para trabajos en *background*
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap9/2_comunicacion/" title="Comunicación entre contextos" class="md-nav__link">
      Comunicación entre contextos
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap9/3_contextos_anidados/" title="Contextos anidados" class="md-nav__link">
      Contextos anidados
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap9/4_ejercicios/" title="Ejercicios" class="md-nav__link">
      Ejercicios
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-10" type="checkbox" id="nav-10">
    
    <label class="md-nav__link" for="nav-10">
      Arquitecturas de aplicaciones en iOS
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-10">
        Arquitecturas de aplicaciones en iOS
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap10/intro/" title="Introducción" class="md-nav__link">
      Introducción
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap10/2_MVC/" title="Model/View/Controller" class="md-nav__link">
      Model/View/Controller
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap10/3_MVP/" title="Model/View/Presenter" class="md-nav__link">
      Model/View/Presenter
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap10/4_MVVM/" title="Model/View/ViewModel" class="md-nav__link">
      Model/View/ViewModel
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap10/5_VIPER/" title="VIPER" class="md-nav__link">
      VIPER
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap10/6a_ejercicios1/" title="Ejercicios parte I" class="md-nav__link">
      Ejercicios parte I
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap10/6_ejercicios/" title="Ejercicios parte II" class="md-nav__link">
      Ejercicios parte II
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap10/6_ejercicios_redux/" title="Ejercicios parte III" class="md-nav__link">
      Ejercicios parte III
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="__toc">Tabla de contenidos</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#las-entidades" class="md-nav__link">
    Las entidades
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#crear-las-entidades-1-punto" class="md-nav__link">
    Crear las entidades (1 punto)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#crear-datos-persistentes-2-puntos" class="md-nav__link">
    Crear datos persistentes (2 puntos)
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                  <h1>Las entidades. Almacenar datos</h1>
                
                <h2 id="las-entidades">Las entidades<a class="headerlink" href="#las-entidades" title="Permanent link">&para;</a></h2>
<h3 id="crear-las-entidades-1-punto">Crear las entidades (1 punto)<a class="headerlink" href="#crear-las-entidades-1-punto" title="Permanent link">&para;</a></h3>
<p>Las entidades son los objetos que queremos hacer persistentes en nuestra aplicación. Debemos especificar sus propiedades (nombre y tipo) y como veremos en sesiones posteriores podemos establecer relaciones con otros objetos.</p>
<p>Para gestionar las entidades debemos editar el archivo <code>xcdatamodeld</code>. En el editor visual de Xcode podemos, entre otras cosas, añadir entidades. Vamos a crear la única entidad que necesitamos en nuestra aplicación: <code>Nota</code>. Para ello seguir estos pasos:</p>
<ol>
<li><strong>Añadir una entidad</strong> pulsando el botón <code>Add Entity</code> de la parte inferior. Creará una nueva entidad llamada por defecto <code>Entity</code>. Podemos cambiarle el nombre haciendo doble clic sobre él. <ol start="2">
<li><strong>Cambiarle el nombre a la entidad</strong> a <code>Nota</code> </li>
<li><strong>Añadir atributos</strong> pulsando sobre el botón <code>+</code> de la sección <code>Attributes</code>. Para cada atributo hay que especificar su nombre y tipo. Añadiremos dos atributos, <code>fecha</code>, de tipo <code>Date</code> y <code>texto</code> de tipo <code>String</code></li>
</ol>
</li>
</ol>
<blockquote>
<p>IMPORTANTE: Los nombres de las entidades deben comenzar por mayúscula y los nombres de los atributos por minúscula. El editor no nos dejará hacer lo contrario.</p>
</blockquote>
<p><img alt="" src="../img/crear_entidad.gif" /></p>
<p>Selecciona la entidad <code>Nota</code> en el editor y selecciona el <code>Data Model Inspector</code> en el panel de la derecha de Xcode (el tercer icono). En el apartado <code>Class</code> verás los datos de la clase Swift que Xcode va a autogenerar para representar a tu entidad. </p>
<p><img alt="" src="../img/data_model_inspector.gif" /></p>
<p>Por defecto:</p>
<ul>
<li>El nombre es el mismo que la entidad</li>
<li>La clase se crea en el "Global Namespace", lo que quiere decir que no te harán falta <code>import</code>s para usarla</li>
<li>En el campo <code>codegen</code> debería aparecer seleccionado <code>Class definition</code>, ese es el método que usa Xcode para generar el código , lo veremos con más detalle en la siguiente sesión.</li>
</ul>
<h3 id="crear-datos-persistentes-2-puntos">Crear datos persistentes (2 puntos)<a class="headerlink" href="#crear-datos-persistentes-2-puntos" title="Permanent link">&para;</a></h3>
<p>Aquí nos ocuparemos de crear y guardar una nueva nota. Por el momento no se podrán editar ni borrar notas, para simplificar la aplicación, únicamente crear notas nuevas.</p>
<h4>La interfaz de usuario para crear notas</h4>
<p>En la (por el momento) única pantalla de la aplicación <strong>añadir los siguientes componentes</strong>:</p>
<ul>
<li>Un campo de texto de varias líneas (<code>text view</code>) para escribir la nota en sí.</li>
<li>Una etiqueta (<code>label</code>) para mostrar la fecha y hora de la nota </li>
<li>Un par de botones, uno para <strong>crear</strong> una nueva nota en blanco y otro para <strong>guardar</strong> la nota actual</li>
<li>Una etiqueta para mostrar mensajes al usuario</li>
</ul>
<p>Una vez añadidos los componentes, hay que crear un <em>outlet</em> para las dos etiquetas y el campo de texto y así poder acceder a/cambiar su contenido por código. Recordad que hay que hacer <code>Ctrl+Arrastrar</code> desde el componente hasta el archivo donde queremos crear la propiedad (en nuestro caso <code>ViewController.swift</code>).</p>
<p>Además hay que crear un <em>action</em> para cada botón, para poder ejecutar nuestro código cuando se pulsen (con <code>Ctrl+Arrastrar</code> igual que antes). Debemos vincular los <em>action</em> al evento <code>Touch up inside</code>, que es el que aparece por defecto.</p>
<h4>El código que implementa “crear nueva nota”</h4>
<p>Debes implementar el código del <em>action</em> del botón "nueva nota" y simplemente limpiará la etiqueta de la fecha, el campo de texto de varias líneas y la etiqueta para mensajes al usuario, asignándoles a las tres la cadena vacía. </p>
<h4>El código que implementa el guardado</h4>
<p>En el código del <em>action</em> asociado al botón de “guardar” debemos tomar el valor del campo de texto, crear una nueva nota con  este texto y la fecha y hora actual y hacerla persistente. Además actualizaremos la etiqueta con la fecha y hora actual para que muestre cuándo se ha guardado la nota. Vamos a ver esto paso a paso.</p>
<p>Para <strong>crear un nuevo objeto persistente</strong> debemos solicitárselo al contexto, ya que este debe gestionar su ciclo de vida y si lo creáramos nosotros llamando al inicializador el contexto desconocería de su existencia.</p>
<p>Lo primero por tanto es <em>obtener la referencia al contexto de persistencia</em>. Como hemos visto en la sección anterior, en la plantilla de Xcode se guarda todo lo de Core Data en el <em>application delegate</em>, por lo que vamos a obtenerlo de ahí</p>
<blockquote>
<p>En todo el tema vamos a suponer que estamos desarrollando para iOS&gt;=10 y que por tanto vamos a poder usar la clase <code>NSPersistentContainer</code>.</p>
</blockquote>
<p>En el <em>action</em> asociado al botón de "guardar" añade el siguiente código:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1">//No te olvides de añadir este import al principio de la clase</span>
<span class="kd">import</span> <span class="nc">CoreData</span>

<span class="k">guard</span> <span class="kd">let</span> <span class="nv">miDelegate</span> <span class="p">=</span> <span class="bp">UIApplication</span><span class="p">.</span><span class="n">shared</span><span class="p">.</span><span class="n">delegate</span> <span class="k">as</span><span class="p">?</span> <span class="n">AppDelegate</span> <span class="k">else</span> <span class="p">{</span>
    <span class="k">return</span>
<span class="p">}</span>
<span class="kd">let</span> <span class="nv">miContexto</span> <span class="p">=</span> <span class="n">miDelegate</span><span class="p">.</span><span class="n">persistentContainer</span><span class="p">.</span><span class="n">viewContext</span>
</pre></div>
</td></tr></table>

<blockquote>
<p>Hay que recalcar de nuevo que el hecho de que el <code>viewContext</code> esté dentro del delegate no es propio de Core Data en sí, sino de la plantilla generada por Xcode para inicializar el <em>stack</em>.</p>
</blockquote>
<p>Para <strong>crear un nuevo objeto</strong> necesitamos relacionarlo con el contexto de persistencia. La clase <code>Nota</code> generada por Xcode tendrá un inicializador que acepta como parámetro el contexto:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kd">let</span> <span class="nv">nuevaNota</span> <span class="p">=</span> <span class="n">Nota</span><span class="p">(</span><span class="n">context</span><span class="p">:</span><span class="n">miContexto</span><span class="p">)</span>
<span class="n">nuevaNota</span><span class="p">.</span><span class="n">fecha</span> <span class="p">=</span> <span class="n">Date</span><span class="p">()</span>
<span class="n">nuevoNota</span><span class="p">.</span><span class="n">texto</span> <span class="p">=</span> <span class="s">&quot;&lt;asignar aquí el contenido del text view&gt;&quot;</span>
</pre></div>
</td></tr></table>

<blockquote>
<p>Si Xcode da error con el código anterior y no reconoce la clase <code>Nota</code> puedes probar a recompilar el proyecto con <code>Product &gt; Clean Build Folder</code> y luego <code>Product &gt; Build</code>. A veces se genera el código para <code>Nota</code> pero no se compila o a veces no se ha generado.</p>
</blockquote>
<p>Finalmente <strong>guardamos el objeto en el almacenamiento persistente</strong>. Esto se hace guardando el contexto, que guardará todos los objetos pendientes. El método <code>save</code> puede lanzar una excepción que debemos tratar de algún modo, en este ejemplo usamos un <code>do...catch</code></p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="k">do</span> <span class="p">{</span>
   <span class="k">try</span> <span class="n">miContexto</span><span class="p">.</span><span class="n">save</span><span class="p">()</span>
<span class="p">}</span> <span class="k">catch</span> <span class="p">{</span>
   <span class="bp">print</span><span class="p">(</span><span class="s">&quot;Error al guardar el contexto: </span><span class="si">\(</span><span class="n">error</span><span class="si">)</span><span class="s">&quot;</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>

<blockquote>
<p>El método de utilidad llamado <code>saveContext</code> de la plantilla generada por Xcode hace algo muy similar a lo anterior, aunque genera un error fatal que causa la terminación inmediata de la aplicación.</p>
</blockquote>
<p>Faltaría <strong>actualizar la etiqueta con la fecha y hora de la nota</strong> para que refleje la fecha asignada, y también <strong>actualizar la etiqueta con el mensaje al usuario que indique "nota guardada" o algo similar</strong>. <strong>Escribe el código necesario para hacer esto</strong>.</p>
<blockquote>
<p>Tal y como está ahora el código, cada vez que pulses sobre <code>Guardar</code> se creará una <strong>nueva nota</strong>, así que aunque no modifiques el texto si pulsas varias veces tendrás varias notas, que serán iguales en contenido, aunque no con la misma fecha/hora). No es necesario que soluciones esto, déjalo así por el momento.</p>
</blockquote>
<h4>Ver los datos creados</h4>
<blockquote>
<p>No es estrictamente necesario que sigas estos pasos en la práctica, pero sí que al menos los leas para poder entender mejor el funcionamiento interno de Core Data</p>
</blockquote>
<p>Podemos "espiar" el almacenamiento persistente, que como ya hemos visto el código ha configurado como una base de datos SQLite con el mismo nombre del proyecto. Podemos localizar el archivo tecleando desde la terminal</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>find . -name MisNotas.sqlite -print
</pre></div>
</td></tr></table>

<p>o más sencillo, usar alguna utilidad como <a href="http://simpholders.com/">Simpholders</a>, que ya hemos usado en otras sesiones para localizar el directorio con el <em>sandbox</em> de nuestra aplicación. En proyectos creados con Xcode 8 la base de datos se crea por defecto en el directorio <code>Library/Application Support</code> del <em>sandbox</em>.</p>
<p>Si abrimos la base de datos usando alguna utilidad gráfica o bien desde la terminal (moviéndose al directorio donde está el <code>MisNotas.sqlite</code> y tecleando:)</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>sqlite3 MisNotas.sqlite
</pre></div>
</td></tr></table>

<p>Debería aparecer el <em>prompt</em> de SQLite donde podemos por ejemplo ver la estructura de la BD, tecleando</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span>sqlite&gt; .schema
</pre></div>
</td></tr></table>

<p>Aparecerá algo como </p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">ZNOTA</span> <span class="p">(</span> <span class="n">Z_PK</span> <span class="nb">INTEGER</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span> <span class="n">Z_ENT</span> <span class="nb">INTEGER</span><span class="p">,</span> <span class="n">Z_OPT</span> <span class="nb">INTEGER</span><span class="p">,</span>
  <span class="n">ZFECHA</span> <span class="k">TIMESTAMP</span><span class="p">,</span> <span class="n">ZTEXTO</span> <span class="nb">VARCHAR</span> <span class="p">);</span>
<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">Z_PRIMARYKEY</span> <span class="p">(</span><span class="n">Z_ENT</span> <span class="nb">INTEGER</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span> <span class="n">Z_NAME</span> <span class="nb">VARCHAR</span><span class="p">,</span> <span class="n">Z_SUPER</span>
  <span class="nb">INTEGER</span><span class="p">,</span> <span class="n">Z_MAX</span> <span class="nb">INTEGER</span><span class="p">);</span>
<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">Z_METADATA</span> <span class="p">(</span><span class="n">Z_VERSION</span> <span class="nb">INTEGER</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span> <span class="n">Z_UUID</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">),</span>
  <span class="n">Z_PLIST</span> <span class="nb">BLOB</span><span class="p">);</span>
</pre></div>
</td></tr></table>

<p>Como se ve, Core Data crea automáticamente una tabla para la entidad <code>Nota</code>, con el mismo nombre (aunque precedida de una curiosa <code>Z</code>, como los nombres de los campos). Crea también una columna por cada propiedad, asignándoles el tipo apropiado. Además automáticamente crea una clave primaria, aunque en la entidad no hemos definido ninguna.</p>
<p>Podemos comprobar también si se ha guardado la nota ejecutando una sentencia SQL</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="n">sqlite</span><span class="o">&gt;</span> <span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">ZNOTA</span><span class="p">;</span>
</pre></div>
</td></tr></table>

<blockquote>
<p>Es posible que el <code>select</code> anterior no muestre los registros actualizados, ya que a partir de iOS7 se usa un modo de SQLite que se llama "Write Ahead Logging".  En este modo, las transacciones para las que no se ha hecho <em>commit</em> se almacenan en un archivo <code>.wal</code> aparte. Para desactivar este modo consultar la documentación de Core Data.</p>
</blockquote>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../3.2_stack/" title="Crear el stack de Core Data en iOS" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Anterior
                </span>
                Crear el stack de Core Data en iOS
              </span>
            </div>
          </a>
        
        
          <a href="../3.4_recuperar_datos/" title="Recuperar los datos" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Siguiente
                </span>
                Recuperar los datos
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application.ac79c3b0.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:"../.."}})</script>
      
    
  </body>
</html>

<!doctype html>
<html lang="es" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.4.1, mkdocs-material-8.5.6">
    
    
      
        <title>3 ejercicios - PDDM-iOS</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.20d9efc8.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.cbb835fc.min.css">
        
          
          
          <meta name="theme-color" content="#009485">
        
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="teal" data-md-color-accent="teal">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#preparacion-de-la-interfaz-025-puntos" class="md-skip">
          Saltar a contenido
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Cabecera">
    <a href="../.." title="PDDM-iOS" class="md-header__button md-logo" aria-label="PDDM-iOS" data-md-component="logo">
      
  <img src="../../logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            PDDM-iOS
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              3 ejercicios
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Búsqueda" placeholder="Búsqueda" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Limpiar" aria-label="Limpiar" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Inicializando búsqueda
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navegación" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="PDDM-iOS" class="md-nav__button md-logo" aria-label="PDDM-iOS" data-md-component="logo">
      
  <img src="../../logo.png" alt="logo">

    </a>
    PDDM-iOS
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1" type="checkbox" id="__nav_1" >
      
      
      
      
        <label class="md-nav__link" for="__nav_1">
          Persistencia básica
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Persistencia básica" data-md-level="1">
        <label class="md-nav__title" for="__nav_1">
          <span class="md-nav__icon md-icon"></span>
          Persistencia básica
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cap1/1.0_introduccion/" class="md-nav__link">
        Introducción
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cap1/1.1_sistema_de_archivos/" class="md-nav__link">
        Sistema de archivos
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cap1/1.2_serializacion/" class="md-nav__link">
        Serialización
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cap1/1.3_property_lists/" class="md-nav__link">
        Property lists
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cap1/1.4_preferencias/" class="md-nav__link">
        Preferencias
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2">
          ¡Hola Core Data!. Una aplicación de ejemplo
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="¡Hola Core Data!. Una aplicación de ejemplo" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          ¡Hola Core Data!. Una aplicación de ejemplo
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cap3/3.1_intro/" class="md-nav__link">
        Introducción a Core Data
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cap3/3.2_stack/" class="md-nav__link">
        Crear el stack de Core Data en iOS
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cap3/3.3_entidades/" class="md-nav__link">
        Ejercicio parte I. almacenar datos
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cap3/3.4_recuperar_datos/" class="md-nav__link">
        Ejercicio parte II. recuperar los datos
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cap3/apendice_ver_almacenamiento/" class="md-nav__link">
        Apéndice. Cómo examinar el almacenamiento persistente
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" >
      
      
      
      
        <label class="md-nav__link" for="__nav_3">
          Modelos de datos en Core Data
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Modelos de datos en Core Data" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Modelos de datos en Core Data
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cap4/4.1_crear_modelo/" class="md-nav__link">
        Crear y editar modelos
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cap4/4.2_clases_propias/" class="md-nav__link">
        Modelar las entidades en código Swift
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cap4/4.3_CRUD/" class="md-nav__link">
        CRUD en Core Data
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cap4/4.4_validaciones/" class="md-nav__link">
        Validaciones
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cap4/4.5_otros_tipos/" class="md-nav__link">
        Otros tipos de datos
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../cap4/4.6_ejercicios/" class="md-nav__link">
        Ejercicios de modelos de datos
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Tabla de contenidos">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Tabla de contenidos
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#preparacion-de-la-interfaz-025-puntos" class="md-nav__link">
    Preparación de la interfaz (0.25 puntos)
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#implementacion-del-codigo-de-busqueda-05-puntos" class="md-nav__link">
    Implementación del código de búsqueda (0.5 puntos)
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#throttling-de-las-busquedas-025-puntos" class="md-nav__link">
    Throttling de las búsquedas (0.25 puntos)
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  <h1>3 ejercicios</h1>

<p>Vamos a implementar una búsqueda por texto en la aplicación de notas sobre la que estáis trabajando en estas sesiones.</p>
<blockquote>
<p>Antes de ponerte a hacer las modificaciones de esta sesión asegúrate de que has hecho un <code>commit</code> con el mensaje <code>terminada sesión 2</code>. También puedes hacer un <code>.zip</code> con el proyecto, llamarlo <code>notas_sesion_2.zip</code> y adjuntarlo en las entregas de la asignatura. Así cuando se evalúe el ejercicio el profesor podrá consultar el estado que tenía la aplicación antes de estos ejercicios.</p>
</blockquote>
<h3 id="preparacion-de-la-interfaz-025-puntos">Preparación de la interfaz (0.25 puntos)<a class="headerlink" href="#preparacion-de-la-interfaz-025-puntos" title="Permanent link">&para;</a></h3>
<p>Necesitamos una barra de búsqueda para poder introducir la cadena de texto a buscar. Usaremos un <code>UISearchController</code>. Este componente incluye la <em>search bar</em>. </p>
<p>En <code>ListaNotasController</code>:</p>
<ol>
<li>Define una propiedad que será el <code>UISearchController</code></li>
</ol>
<div class="highlight"><pre><span></span><code><span class="c1">//esto debe ser una variable miembro de ListaNotasController</span>
<span class="kd">let</span> <span class="nv">searchController</span> <span class="p">=</span> <span class="bp">UISearchController</span><span class="p">(</span><span class="n">searchResultsController</span><span class="p">:</span> <span class="kc">nil</span><span class="p">)</span>
</code></pre></div>
<ol start="2">
<li>En el <code>viewDidLoad</code> introduce el siguiente código, que configura e inicializa el <code>UISearchController</code></li>
</ol>
<div class="highlight"><pre><span></span><code><span class="c1">//iOS intentará pintar la tabla, hay que inicializarla aunque sea vacía</span>
<span class="kc">self</span><span class="p">.</span><span class="n">listaNotas</span> <span class="p">=</span> <span class="p">[]</span>
<span class="c1">//ListaNotasController recibirá lo que se está escribiendo en la barra de búsqueda </span>
<span class="n">searchController</span><span class="p">.</span><span class="n">searchResultsUpdater</span> <span class="p">=</span> <span class="kc">self</span>
<span class="c1">//Configuramos el search controller</span>
<span class="n">searchController</span><span class="p">.</span><span class="n">obscuresBackgroundDuringPresentation</span> <span class="p">=</span> <span class="kc">false</span>
<span class="n">searchController</span><span class="p">.</span><span class="n">searchBar</span><span class="p">.</span><span class="n">placeholder</span> <span class="p">=</span> <span class="s">&quot;Buscar texto&quot;</span>
<span class="c1">//Lo añadimos a la tabla</span>
<span class="n">searchController</span><span class="p">.</span><span class="n">searchBar</span><span class="p">.</span><span class="n">sizeToFit</span><span class="p">()</span>
<span class="kc">self</span><span class="p">.</span><span class="n">tableView</span><span class="p">.</span><span class="n">tableHeaderView</span> <span class="p">=</span> <span class="n">searchController</span><span class="p">.</span><span class="n">searchBar</span>
</code></pre></div>
<ol start="3">
<li>La propiedad <code>searchResultsUpdater</code> indica quién es el <em>delegate</em> del <code>UISearchController</code>, en este caso <code>ListaNotasViewController</code>. El <em>delegate</em> debe ser conforme al protocolo <code>UISearchResultsUpdating</code>, que requiere que se implemente un método llamado <code>updateSearchResults(for:)</code>.</li>
</ol>
<p>Cambia la cabecera de <code>ListaNotasViewController</code> para declarar que es conforme al protocolo <code>UISearchResultsUpdating</code>:</p>
<p><div class="highlight"><pre><span></span><code><span class="kd">class</span> <span class="nc">ListaViewController</span><span class="p">:</span> <span class="bp">UITableViewController</span><span class="p">,</span> <span class="bp">UISearchResultsUpdating</span> <span class="p">{</span>
  <span class="p">...</span>
<span class="p">}</span>  
</code></pre></div>
Define en la clase el método <code>updateSearchResults(for:)</code></p>
<div class="highlight"><pre><span></span><code><span class="kd">func</span> <span class="nf">updateSearchResults</span><span class="p">(</span><span class="k">for</span> <span class="n">searchController</span><span class="p">:</span> <span class="bp">UISearchController</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">let</span> <span class="nv">texto</span> <span class="p">=</span> <span class="n">searchController</span><span class="p">.</span><span class="n">searchBar</span><span class="p">.</span><span class="n">text</span><span class="p">!</span>
    <span class="bp">print</span><span class="p">(</span><span class="s">&quot;Buscando </span><span class="si">\(</span><span class="n">texto</span><span class="si">)</span><span class="s">&quot;</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>
<p><strong>Prueba la aplicación</strong> para comprobar que todo está correcto, y deberías ver que cada vez que se escribe en la barra de búsqueda se llama a este método y se imprime en la consola la cadena buscada.</p>
<h3 id="implementacion-del-codigo-de-busqueda-05-puntos">Implementación del código de búsqueda (0.5 puntos)<a class="headerlink" href="#implementacion-del-codigo-de-busqueda-05-puntos" title="Permanent link">&para;</a></h3>
<blockquote>
<p><code>updateSearchResults</code> se llama por cada nuevo carácter escrito en la barra de búsquedas, lo que permite actualizar los datos en "tiempo real" pero es muy ineficiente. Veremos cómo solucionarlo en el siguiente apartado, de momento dispararemos una nueva búsqueda por cada pulsación</p>
</blockquote>
<p>Hecha la preparación de la interfaz, falta implementar la búsqueda en sí. En el método <code>updateSearchResults</code> <strong>debes crear una fetch request que busque las notas cuyo texto contenga el texto escrito</strong> en la barra de búsqueda, sin distinguir mayúsculas/minúsculas o caracteres diacríticos. </p>
<p>Recuerda que para que se actualicen los datos visibles debes llamar a <code>tableView.reloadData()</code></p>
<p>Una vez comprobado que funciona, <strong>mejora la fetch request para que las notas aparezcan en orden inverso por fecha</strong>, de más reciente a más antigua.</p>
<h3 id="throttling-de-las-busquedas-025-puntos"><em>Throttling</em> de las búsquedas (0.25 puntos)<a class="headerlink" href="#throttling-de-las-busquedas-025-puntos" title="Permanent link">&para;</a></h3>
<p>Lanzar una nueva <em>fetch request</em> por cada carácter tecleado es muy ineficiente, sobre todo si el usuario teclea rápido y ni siquiera da tiempo a ver los resultados intermedios. Una implementación mejor haría <em>throttling</em> de la búsqueda, es decir, impediría que se repita la operación si todavía no ha pasado un mínimo de tiempo desde la anterior.</p>
<p>La idea es que si se intenta repetir la operación y todavía no ha pasado un tiempo prefijado por nosotros, la nueva operación se retrase hasta que pase el intervalo de tiempo. Esto no está implementado en los APIs de iOS pero en Internet podéis encontrar diversas implementaciones. La siguiente clase, tomada de <a href="https://www.craftappco.com/blog/2018/5/30/simple-throttling-in-swift">este tutorial</a>, implementa esta funcionalidad.</p>
<div class="highlight"><pre><span></span><code><span class="kd">import</span> <span class="nc">Foundation</span>

<span class="c1">//De https://www.craftappco.com/blog/2018/5/30/simple-throttling-in-swift</span>
<span class="kd">class</span> <span class="nc">Throttler</span> <span class="p">{</span>
    <span class="kd">private</span> <span class="kd">var</span> <span class="nv">workItem</span><span class="p">:</span> <span class="n">DispatchWorkItem</span> <span class="p">=</span> <span class="n">DispatchWorkItem</span><span class="p">(</span><span class="n">block</span><span class="p">:</span> <span class="p">{})</span>
    <span class="kd">private</span> <span class="kd">var</span> <span class="nv">previousRun</span><span class="p">:</span> <span class="n">Date</span> <span class="p">=</span> <span class="n">Date</span><span class="p">.</span><span class="n">distantPast</span>
    <span class="kd">private</span> <span class="kd">let</span> <span class="nv">queue</span><span class="p">:</span> <span class="n">DispatchQueue</span>
    <span class="kd">private</span> <span class="kd">let</span> <span class="nv">minimumDelay</span><span class="p">:</span> <span class="n">TimeInterval</span>

    <span class="kd">init</span><span class="p">(</span><span class="n">minimumDelay</span><span class="p">:</span> <span class="n">TimeInterval</span><span class="p">,</span> <span class="n">queue</span><span class="p">:</span> <span class="n">DispatchQueue</span> <span class="p">=</span> <span class="n">DispatchQueue</span><span class="p">.</span><span class="n">main</span><span class="p">)</span> <span class="p">{</span>
        <span class="kc">self</span><span class="p">.</span><span class="n">minimumDelay</span> <span class="p">=</span> <span class="n">minimumDelay</span>
        <span class="kc">self</span><span class="p">.</span><span class="n">queue</span> <span class="p">=</span> <span class="n">queue</span>
    <span class="p">}</span>

    <span class="kd">func</span> <span class="nf">throttle</span><span class="p">(</span><span class="kc">_</span> <span class="n">block</span><span class="p">:</span> <span class="p">@</span><span class="n">escaping</span> <span class="p">()</span> <span class="p">-&gt;</span> <span class="nb">Void</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// Cancel any existing work item if it has not yet executed</span>
        <span class="n">workItem</span><span class="p">.</span><span class="n">cancel</span><span class="p">()</span>

        <span class="c1">// Re-assign workItem with the new block task, resetting the previousRun time when it executes</span>
        <span class="n">workItem</span> <span class="p">=</span> <span class="n">DispatchWorkItem</span><span class="p">()</span> <span class="p">{</span>
            <span class="p">[</span><span class="kr">weak</span> <span class="kc">self</span><span class="p">]</span> <span class="k">in</span>
            <span class="kc">self</span><span class="p">?.</span><span class="n">previousRun</span> <span class="p">=</span> <span class="n">Date</span><span class="p">()</span>
            <span class="n">block</span><span class="p">()</span>
        <span class="p">}</span>

        <span class="c1">// If the time since the previous run is more than the required minimum delay</span>
        <span class="c1">// =&gt; execute the workItem immediately</span>
        <span class="c1">// else</span>
        <span class="c1">// =&gt; delay the workItem execution by the minimum delay time</span>
        <span class="kd">let</span> <span class="nv">delay</span> <span class="p">=</span> <span class="n">previousRun</span><span class="p">.</span><span class="n">timeIntervalSinceNow</span> <span class="o">&gt;</span> <span class="n">minimumDelay</span> <span class="p">?</span> <span class="mi">0</span> <span class="p">:</span> <span class="n">minimumDelay</span>
        <span class="n">queue</span><span class="p">.</span><span class="n">asyncAfter</span><span class="p">(</span><span class="n">deadline</span><span class="p">:</span> <span class="p">.</span><span class="n">now</span><span class="p">()</span> <span class="o">+</span> <span class="nb">Double</span><span class="p">(</span><span class="n">delay</span><span class="p">),</span> <span class="n">execute</span><span class="p">:</span> <span class="n">workItem</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>Crea un nuevo fichero Swift en tu proyecto con esta clase. Para usarlo en <code>ListaNotasViewController</code>:</p>
<ol>
<li>Define una variable miembro de tipo <code>Throttler</code> con el intervalo de tiempo deseado, por ejemplo 0.5 segundos (no queremos repetir búsquedas con más frecuencia)</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="kd">let</span> <span class="nv">throttler</span> <span class="p">=</span> <span class="n">Throttler</span><span class="p">(</span><span class="n">minimumDelay</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">)</span>
</code></pre></div>
<ol start="2">
<li>En el <code>updateSearchResults</code> "envuelve" tu código de búsqueda en un <code>throttle</code>. Automáticamente la clase <code>Throttler</code> se encargará de que el código no se ejecute más de 1 vez por cada 0.5 segundos (o el intervalo que hayas elegido)</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="kd">func</span> <span class="nf">updateSearchResults</span><span class="p">(</span><span class="k">for</span> <span class="n">searchController</span><span class="p">:</span> <span class="bp">UISearchController</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">throttler</span><span class="p">.</span><span class="n">throttle</span> <span class="p">{</span>
        <span class="kd">let</span> <span class="nv">texto</span> <span class="p">=</span> <span class="n">searchController</span><span class="p">.</span><span class="n">searchBar</span><span class="p">.</span><span class="n">text</span><span class="p">!</span>
        <span class="c1">//Aquí iría tu código de búsqueda</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../..", "features": [], "search": "../../assets/javascripts/workers/search.5bf1dace.min.js", "translations": {"clipboard.copied": "Copiado al portapapeles", "clipboard.copy": "Copiar al portapapeles", "search.config.lang": "es", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "B\u00fasqueda", "search.result.more.one": "1 m\u00e1s en esta p\u00e1gina", "search.result.more.other": "# m\u00e1s en esta p\u00e1gina", "search.result.none": "No se encontraron documentos", "search.result.one": "1 documento encontrado", "search.result.other": "# documentos encontrados", "search.result.placeholder": "Teclee para comenzar b\u00fasqueda", "search.result.term.missing": "Falta", "select.version.title": "Seleccionar versi\u00f3n"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.078830c0.min.js"></script>
      
    
  </body>
</html>
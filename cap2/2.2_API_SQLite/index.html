



<!doctype html>
<html lang="es" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
      
      
        <meta name="lang:clipboard.copy" content="Copiar al portapapeles">
      
        <meta name="lang:clipboard.copied" content="Copiado al portapapeles">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No se encontraron documentos">
      
        <meta name="lang:search.result.one" content="1 documento encontrado">
      
        <meta name="lang:search.result.other" content="# documentos encontrados">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.4.3">
    
    
      
        <title>El API de SQLIte - PDDM-iOS</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application.30686662.css">
      
        <link rel="stylesheet" href="../../assets/stylesheets/application-palette.a8b3c06d.css">
      
      
        
        
        <meta name="theme-color" content="#009688">
      
    
    
      <script src="../../assets/javascripts/modernizr.74668098.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../assets/fonts/material-icons.css">
    
    
    
      
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="teal" data-md-color-accent="teal">
  
    <svg class="md-svg">
      <defs>
        
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#el-api-de-sqlite" tabindex="1" class="md-skip">
        Saltar a contenido
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../.." title="PDDM-iOS" class="md-header-nav__button md-logo">
          
            <img src="../../logo.png" width="24" height="24">
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              PDDM-iOS
            </span>
            <span class="md-header-nav__topic">
              
                El API de SQLIte
              
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Búsqueda" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Teclee para comenzar búsqueda
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main" role="main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="../.." title="PDDM-iOS" class="md-nav__button md-logo">
      
        <img src="../../logo.png" width="48" height="48">
      
    </a>
    PDDM-iOS
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-1" type="checkbox" id="nav-1">
    
    <label class="md-nav__link" for="nav-1">
      Persistencia básica
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-1">
        Persistencia básica
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap1/1.1_sistema_de_archivos/" title="Sistema de archivos" class="md-nav__link">
      Sistema de archivos
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap1/1.2_serializacion/" title="Serialización" class="md-nav__link">
      Serialización
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap1/1.3_property_lists/" title="Property lists" class="md-nav__link">
      Property lists
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap1/1.4_preferencias/" title="Preferencias" class="md-nav__link">
      Preferencias
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap1/1.5_ejercicios/" title="Ejercicios" class="md-nav__link">
      Ejercicios
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2" checked>
    
    <label class="md-nav__link" for="nav-2">
      SQLite
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        SQLite
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../2.1_intro_SQLite/" title="Introducción" class="md-nav__link">
      Introducción
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        El API de SQLIte
      </label>
    
    <a href="./" title="El API de SQLIte" class="md-nav__link md-nav__link--active">
      El API de SQLIte
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="__toc">Tabla de contenidos</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#el-api-de-sqlite" class="md-nav__link">
    El API de SQLite
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#acceder-a-la-bd" class="md-nav__link">
    Acceder a la BD
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#consultas-de-seleccion" class="md-nav__link">
    Consultas de selección
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#consultas-de-actualizacion" class="md-nav__link">
    Consultas de actualización
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../2.3_frameworks/" title="Frameworks para SQLite" class="md-nav__link">
      Frameworks para SQLite
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../2.4_ejercicios/" title="Ejercicios" class="md-nav__link">
      Ejercicios
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      ¡Hola Core Data!. Una aplicación de ejemplo
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        ¡Hola Core Data!. Una aplicación de ejemplo
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap3/3.1_intro/" title="Introducción a Core Data" class="md-nav__link">
      Introducción a Core Data
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap3/3.2_stack/" title="Crear el stack de Core Data en iOS" class="md-nav__link">
      Crear el stack de Core Data en iOS
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap3/3.3_entidades/" title="Las entidades. Almacenar datos" class="md-nav__link">
      Las entidades. Almacenar datos
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap3/3.4_recuperar_datos/" title="Recuperar los datos" class="md-nav__link">
      Recuperar los datos
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap3/apendice_ver_almacenamiento/" title="Apéndice. Cómo examinar el almacenamiento persistente" class="md-nav__link">
      Apéndice. Cómo examinar el almacenamiento persistente
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      Modelos de datos en Core Data
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        Modelos de datos en Core Data
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap4/4.1_crear_modelo/" title="Crear y editar modelos" class="md-nav__link">
      Crear y editar modelos
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap4/4.2_clases_propias/" title="Modelar las entidades en código Swift" class="md-nav__link">
      Modelar las entidades en código Swift
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap4/4.3_CRUD/" title="CRUD en Core Data" class="md-nav__link">
      CRUD en Core Data
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap4/4.4_validaciones/" title="Validaciones" class="md-nav__link">
      Validaciones
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap4/4.5_transformables/" title="Transformables" class="md-nav__link">
      Transformables
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap4/4.6_ejercicios/" title="Ejercicios de modelos de datos" class="md-nav__link">
      Ejercicios de modelos de datos
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      Búsquedas en Core Data
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        Búsquedas en Core Data
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap6/1_predicados/" title="Predicados" class="md-nav__link">
      Predicados
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap6/2_ordenacion/" title="Ordenación" class="md-nav__link">
      Ordenación
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap6/3_ejercicios/" title="Ejercicios" class="md-nav__link">
      Ejercicios
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6">
    
    <label class="md-nav__link" for="nav-6">
      Tablas en Core Data
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        Tablas en Core Data
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap7/1_el_frc/" title="El *fetched results controller*" class="md-nav__link">
      El *fetched results controller*
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap7/2_configuracion_basica/" title="Inicializar el "fetched results controller"" class="md-nav__link">
      Inicializar el "fetched results controller"
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap7/3_tabla/" title="Mostrar los datos en la tabla" class="md-nav__link">
      Mostrar los datos en la tabla
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap7/4_refrescar_tabla/" title="Refrescar la tabla" class="md-nav__link">
      Refrescar la tabla
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap7/5_secciones/" title="Secciones de tabla automáticas" class="md-nav__link">
      Secciones de tabla automáticas
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap7/6_ejercicios/" title="Ejercicios" class="md-nav__link">
      Ejercicios
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7" type="checkbox" id="nav-7">
    
    <label class="md-nav__link" for="nav-7">
      Migraciones de datos
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-7">
        Migraciones de datos
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap8/1_intro/" title="Qué son las migraciones de datos" class="md-nav__link">
      Qué son las migraciones de datos
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap8/2_versiones/" title="Versiones del modelo de datos" class="md-nav__link">
      Versiones del modelo de datos
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap8/3_migraciones_ligeras/" title="Migraciones ligeras" class="md-nav__link">
      Migraciones ligeras
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap8/4_migraciones_pesadas/" title="Migraciones pesadas" class="md-nav__link">
      Migraciones pesadas
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap8/apendice_migraciones_ios9/" title="Apéndice. migraciones en versiones antiguas de iOS" class="md-nav__link">
      Apéndice. migraciones en versiones antiguas de iOS
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-8" type="checkbox" id="nav-8">
    
    <label class="md-nav__link" for="nav-8">
      Concurrencia. Contextos múltiples
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-8">
        Concurrencia. Contextos múltiples
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap9/1_background/" title="Múltiples contextos para trabajos en *background*" class="md-nav__link">
      Múltiples contextos para trabajos en *background*
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap9/2_comunicacion/" title="Comunicación entre contextos" class="md-nav__link">
      Comunicación entre contextos
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap9/3_contextos_anidados/" title="Contextos anidados" class="md-nav__link">
      Contextos anidados
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap9/4_ejercicios/" title="Ejercicios" class="md-nav__link">
      Ejercicios
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-9" type="checkbox" id="nav-9">
    
    <label class="md-nav__link" for="nav-9">
      Miniproyecto
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-9">
        Miniproyecto
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../miniproyecto/restaurante/" title="Enunciado" class="md-nav__link">
      Enunciado
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-10" type="checkbox" id="nav-10">
    
    <label class="md-nav__link" for="nav-10">
      Persistencia como servicio
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-10">
        Persistencia como servicio
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap11/1_introduccion_BAAS/" title="Backend as a Service" class="md-nav__link">
      Backend as a Service
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap11/2_gestion_usuarios/" title="Gestión de usuarios en Firebase" class="md-nav__link">
      Gestión de usuarios en Firebase
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap11/3_persistencia/" title="Persistencia en Firebase" class="md-nav__link">
      Persistencia en Firebase
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap11/4_ejercicios/" title="Ejercicios" class="md-nav__link">
      Ejercicios
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-11" type="checkbox" id="nav-11">
    
    <label class="md-nav__link" for="nav-11">
      Arquitecturas de aplicaciones en iOS
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-11">
        Arquitecturas de aplicaciones en iOS
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap10/intro/" title="Introducción" class="md-nav__link">
      Introducción
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap10/2_MVC/" title="Model/View/Controller" class="md-nav__link">
      Model/View/Controller
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap10/3_MVP/" title="Model/View/Presenter" class="md-nav__link">
      Model/View/Presenter
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap10/4_MVVM/" title="Model/View/ViewModel" class="md-nav__link">
      Model/View/ViewModel
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap10/5_VIPER/" title="VIPER" class="md-nav__link">
      VIPER
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cap10/6_ejercicios/" title="Ejercicios MVVM" class="md-nav__link">
      Ejercicios MVVM
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="__toc">Tabla de contenidos</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#el-api-de-sqlite" class="md-nav__link">
    El API de SQLite
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#acceder-a-la-bd" class="md-nav__link">
    Acceder a la BD
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#consultas-de-seleccion" class="md-nav__link">
    Consultas de selección
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#consultas-de-actualizacion" class="md-nav__link">
    Consultas de actualización
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                  <h1>El API de SQLIte</h1>
                
                <h2 id="el-api-de-sqlite">El API de SQLite<a class="headerlink" href="#el-api-de-sqlite" title="Permanent link">&para;</a></h2>
<h3 id="acceder-a-la-bd">Acceder a la BD<a class="headerlink" href="#acceder-a-la-bd" title="Permanent link">&para;</a></h3>
<p>Vamos a ver aquí cómo abrir la base de datos para comenzar a trabajar con ella.</p>
<h4>Abrir y cerrar la BD</h4>
<p>En el API C de SQLite la base de datos se representa en nuestro código mediante un puntero a un  <code>struct</code> de tipo <code>sqlite3</code>. En swift podemos representar un puntero de C con el tipo <code>OpaquePointer</code>, así que en nuestro código tendremos algo como</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kd">var</span> <span class="nv">db</span><span class="p">:</span> <span class="n">OpaquePointer</span><span class="p">?</span> <span class="p">=</span> <span class="kc">nil</span>
</pre></div>
</td></tr></table>

<p>Para abrir la BD se usa la función <code>sqlite3_open</code>, a la que hay que pasarle el <em>path</em> de la base de datos y la referencia a este <em>struct</em></p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="n">sqlite3_open</span><span class="p">(</span><span class="n">path_db</span><span class="p">,</span> <span class="p">&amp;</span><span class="n">db</span><span class="p">);</span>
</pre></div>
</td></tr></table>

<p>Vamos a crear una clase <code>DBManager</code> en la que implementaremos los métodos que interactúan con la base de datos. En esta clase creamos una variable miembro privada para almacenar la referencia a la base de datos.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kd">class</span> <span class="nc">DBManager</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nv">db</span> <span class="p">:</span> <span class="n">OpaquePointer</span><span class="p">?</span> <span class="p">=</span> <span class="kc">nil</span>   
<span class="p">}</span>
</pre></div>
</td></tr></table>

<p>Podemos implementar un inicializador que abra la base de datos suponiendo que está incluida en el <em>bundle</em></p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kd">class</span> <span class="nc">DBManager</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nv">db</span> <span class="p">:</span> <span class="n">OpaquePointer</span><span class="p">?</span> <span class="p">=</span> <span class="kc">nil</span>

    <span class="kd">init</span><span class="p">(</span><span class="n">conDB</span> <span class="n">nombreDB</span> <span class="p">:</span> <span class="nb">String</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="kd">let</span> <span class="nv">dbPath</span> <span class="p">=</span> <span class="n">Bundle</span><span class="p">.</span><span class="n">main</span><span class="p">.</span><span class="n">path</span><span class="p">(</span><span class="n">forResource</span><span class="p">:</span> <span class="n">nombreDB</span><span class="p">,</span> <span class="n">ofType</span><span class="p">:</span> <span class="s">&quot;db&quot;</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="n">sqlite3_open</span><span class="p">(</span><span class="n">dbPath</span><span class="p">,</span> <span class="o">&amp;</span><span class="p">(</span><span class="kc">self</span><span class="p">.</span><span class="n">db</span><span class="p">))</span> <span class="p">==</span> <span class="n">SQLITE_OK</span> <span class="p">{</span>
                <span class="bp">print</span><span class="p">(</span><span class="s">&quot;Base de datos </span><span class="si">\(</span><span class="n">dbPath</span><span class="si">)</span><span class="s"> abierta OK&quot;</span><span class="p">)</span>
            <span class="p">}</span>
            <span class="k">else</span> <span class="p">{</span>
                <span class="kd">let</span> <span class="nv">error</span> <span class="p">=</span> <span class="nb">String</span><span class="p">(</span><span class="n">cString</span><span class="p">:</span><span class="n">sqlite3_errmsg</span><span class="p">(</span><span class="n">db</span><span class="p">))</span>
                <span class="bp">print</span><span class="p">(</span><span class="s">&quot;Error al intentar abrir la BD: </span><span class="si">\(</span><span class="n">error</span><span class="si">)</span><span class="s"> &quot;</span><span class="p">)</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="p">{</span>
            <span class="bp">print</span><span class="p">(</span><span class="s">&quot;El archivo no se encuentra&quot;</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>

<p>Del código anterior debemos destacar los siguientes aspectos:</p>
<ul>
<li>Las llamadas al API de SQLite devuelven la constante <code>SQLITE_OK</code> si no ha habido error, así que para saber si <code>sqlite3_open</code> ha tenido éxito comprobamos si ha devuelto este valor. </li>
<li>Si se produce un error, para ver cuál es podemos usar la función <code>sqlite3_errmsg</code>, que devuelve el mensaje del error más reciente asociado a una llamada hecha al API de SQLite. Al ser código C el mensaje de error se devuelve como un <code>char *</code>, ya que en C no existe el tipo <code>String</code>. En nuestro código convertimos este tipo a un <code>String</code> de Swift, para poder tratarlo (imprimirlo, en nuestro caso). Esta conversión la hacemos con el inicializador <code>String(cString:)</code></li>
<li>A la inversa, las funciones C que requieren un <code>char *</code> como parámetro aceptan directamente un <code>String</code> de Swift. Esto por ejemplo pasa al hacer el <code>sqlite3_open</code>, que en realidad requiere que se le pase un <code>char *</code> con el <em>path</em> de la BD.</li>
</ul>
<p>Para cerrar la base de datos se usa la función <code>sqlite3_close()</code> a la que se le pasa como parámetro el puntero al <em>struct</em> con la información de la base de datos.</p>
<h4>Abrir la BD con “permiso de escritura”</h4>
<p>Un problema que tiene incluir físicamente la base de datos en el <em>bundle</em> de la aplicación es que este es de solo lectura. Eso quiere decir que no podríamos ejecutar consultas de actualización sobre la base de datos.</p>
<p>La forma más habitual de resolver este problema es crear una copia de la base de datos en algún directorio con permiso de escritura cuando se arranca la aplicación. Típicamente se usa el directorio <code>Documents</code> ya que es el más apropiado para este propósito.</p>
<p>Aquí tenemos un método que copia la BD del <em>bundle</em>  al directorio <code>Documents</code>, si es que no se ha copiado ya:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kd">func</span> <span class="nf">copyDB</span><span class="p">(</span><span class="n">conNombre</span> <span class="n">nombre</span> <span class="p">:</span> <span class="nb">String</span><span class="p">)-&gt;</span><span class="n">URL</span><span class="p">?</span> <span class="p">{</span>
    <span class="kd">let</span> <span class="nv">fileManager</span> <span class="p">=</span> <span class="n">FileManager</span><span class="p">.</span><span class="k">default</span>
    <span class="kd">let</span> <span class="nv">docsURL</span> <span class="p">=</span> <span class="n">fileManager</span><span class="p">.</span><span class="n">urls</span><span class="p">(</span><span class="k">for</span><span class="p">:</span> <span class="p">.</span><span class="n">documentDirectory</span><span class="p">,</span> <span class="k">in</span><span class="p">:</span> <span class="p">.</span><span class="n">userDomainMask</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="kd">let</span> <span class="nv">dbCopiaURL</span> <span class="p">=</span> <span class="n">docsURL</span><span class="p">.</span><span class="n">appendingPathComponent</span><span class="p">(</span><span class="n">nombre</span><span class="p">).</span><span class="n">appendingPathExtension</span><span class="p">(</span><span class="s">&quot;db&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">fileManager</span><span class="p">.</span><span class="n">fileExists</span><span class="p">(</span><span class="n">atPath</span><span class="p">:</span> <span class="n">dbCopiaURL</span><span class="p">.</span><span class="n">path</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">dbCopiaURL</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="p">{</span>
        <span class="k">if</span> <span class="kd">let</span> <span class="nv">dbOriginalURL</span> <span class="p">=</span> <span class="n">Bundle</span><span class="p">.</span><span class="n">main</span><span class="p">.</span><span class="n">url</span><span class="p">(</span><span class="n">forResource</span><span class="p">:</span> <span class="n">nombre</span><span class="p">,</span> <span class="n">withExtension</span><span class="p">:</span> <span class="s">&quot;db&quot;</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="k">try</span><span class="p">?</span> <span class="n">fileManager</span><span class="p">.</span><span class="n">copyItem</span><span class="p">(</span><span class="n">at</span><span class="p">:</span> <span class="n">dbOriginalURL</span><span class="p">,</span> <span class="n">to</span><span class="p">:</span> <span class="n">dbCopiaURL</span><span class="p">))</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
                <span class="k">return</span> <span class="n">dbCopiaURL</span>
            <span class="p">}</span>
            <span class="k">else</span> <span class="p">{</span>
                <span class="k">return</span> <span class="kc">nil</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="p">{</span>
            <span class="k">return</span> <span class="kc">nil</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>

<p>Tendremos que modificar el inicializador del apartado anterior para que llame a este método y después no abra la base de datos del <em>bundle</em> sino la de <code>Documents</code>:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kd">class</span> <span class="nc">DBManager</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nv">db</span> <span class="p">:</span> <span class="n">OpaquePointer</span><span class="p">?</span> <span class="p">=</span> <span class="kc">nil</span>

    <span class="kd">init</span><span class="p">(</span><span class="n">conDB</span> <span class="n">nombreDB</span> <span class="p">:</span> <span class="nb">String</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="kd">let</span> <span class="nv">dbCopiaURL</span> <span class="p">=</span> <span class="n">copyDB</span><span class="p">(</span><span class="n">conNombre</span><span class="p">:</span> <span class="n">nombreDB</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="n">sqlite3_open</span><span class="p">(</span><span class="n">dbCopiaURL</span><span class="p">.</span><span class="n">path</span><span class="p">,</span> <span class="o">&amp;</span><span class="p">(</span><span class="kc">self</span><span class="p">.</span><span class="n">db</span><span class="p">))</span> <span class="p">==</span> <span class="n">SQLITE_OK</span> <span class="p">{</span>
                <span class="bp">print</span><span class="p">(</span><span class="s">&quot;Base de datos </span><span class="si">\(</span><span class="n">dbCopiaURL</span><span class="si">)</span><span class="s"> abierta OK&quot;</span><span class="p">)</span>
            <span class="p">}</span>
<span class="c1">//continúa como antes...</span>
</pre></div>
</td></tr></table>

<h3 id="consultas-de-seleccion">Consultas de selección<a class="headerlink" href="#consultas-de-seleccion" title="Permanent link">&para;</a></h3>
<h4>Compilar y ejecutar una consulta de selección</h4>
<p>El esquema general para ejecutar una consulta de selección y recorrer los registros resultantes es el siguiente:</p>
<ol>
<li>Compilar la <em>query</em> (convertirla de SQL en "modo texto" a un formato "ejecutable" por SQLite)</li>
<li>Ir avanzando registro a registro por los resultados, mientras queden registros<ul>
<li>Obtener los campos que nos interesen del registro actual, sabiendo el número de columna que ocupan. <strong>Las columnas empiezan en 0</strong></li>
<li>Habitualmente “empaquetaremos” los valores del registro actual en un objeto o <code>struct</code> de Swift, e iremos construyendo una lista de resultados (un array es lo más sencillo).</li>
</ul>
</li>
<li>Liberar la memoria ocupada por la <em>query</em> compilada</li>
</ol>
<p>Vamos a ver un ejemplo de código que implementa este esquema:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kd">let</span> <span class="nv">querySQL</span> <span class="p">=</span> <span class="s">&quot;SELECT * FROM Personas&quot;</span>
<span class="kd">var</span> <span class="nv">statement</span> <span class="p">:</span> <span class="n">OpaquePointer</span><span class="p">?;</span>
<span class="kd">var</span> <span class="nv">lista</span> <span class="p">:</span> <span class="p">[</span><span class="n">Persona</span><span class="p">]</span> <span class="p">=</span> <span class="p">[];</span>

<span class="kd">let</span> <span class="nv">result</span> <span class="p">=</span> <span class="n">sqlite3_prepare_v2</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">querySQL</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">&amp;</span><span class="n">statement</span><span class="p">,</span> <span class="kc">nil</span><span class="p">)</span>
<span class="k">if</span> <span class="p">(</span><span class="n">result</span><span class="p">==</span><span class="n">SQLITE_OK</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">while</span> <span class="p">(</span><span class="n">sqlite3_step</span><span class="p">(</span><span class="n">statement</span><span class="p">)</span> <span class="p">==</span> <span class="n">SQLITE_ROW</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">let</span> <span class="nv">id</span> <span class="p">=</span> <span class="n">sqlite3_column_int</span><span class="p">(</span><span class="n">statement</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="kd">let</span> <span class="nv">nombre</span> <span class="p">=</span> <span class="nb">String</span><span class="p">(</span><span class="n">cString</span><span class="p">:</span> <span class="n">sqlite3_column_text</span><span class="p">(</span><span class="n">statement</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
        <span class="kd">let</span> <span class="nv">persona</span> <span class="p">=</span> <span class="n">Persona</span><span class="p">(</span><span class="n">id</span><span class="p">:</span> <span class="nb">Int</span><span class="p">(</span><span class="n">id</span><span class="p">),</span> <span class="n">nombre</span><span class="p">:</span> <span class="n">nombre</span><span class="p">)</span>
        <span class="n">lista</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">persona</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="n">sqlite3_finalize</span><span class="p">(</span><span class="n">statement</span><span class="p">);</span>
<span class="k">for</span> <span class="n">p</span> <span class="k">in</span> <span class="n">lista</span> <span class="p">{</span>
    <span class="bp">print</span><span class="p">(</span><span class="s">&quot;</span><span class="si">\(</span><span class="n">p</span><span class="p">.</span><span class="n">id</span><span class="si">)</span><span class="s"> </span><span class="si">\(</span><span class="n">p</span><span class="p">.</span><span class="n">nombre</span><span class="si">)</span><span class="s">&quot;</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>

<ul>
<li>En la <a href="http://sqlite.org/c3ref/prepare.html">función <code>sqlite3_prepare_v2()</code></a> <ul>
<li>Los dos primeros argumentos son el <code>struct</code> que representa la base de datos y la cadena con la <em>query</em>.  </li>
<li>Aunque en el ejemplo no usamos esta funcionalidad se podrían poner varias sentencias SQL en la misma cadena y compilar solo una de ellas. El tercer argumento de indica la longitud en caracteres que queremos tomar de la <em>query</em> (-1 indica leer toda la cadena). </li>
<li>Con el último argumento SQLite nos informa qué parte de <em>query</em> queda por ejecutar, en este caso pasamos <code>nil</code> ya que no nos interesa esta funcionalidad. </li>
</ul>
</li>
<li>Vamos avanzando por los registros con <code>sqlite_step()</code>. Mientras que esta función devuelva <code>SQLITE_ROW</code> tenemos una nueva fila y podemos obtener sus campos con <code>sqlite_column_XXX()</code>, donde <code>XXX</code> es el tipo de campo</li>
<li>De nuevo tenemos el problema de que como el API de SQLite está en C, devuelve <code>char *</code> para los campos de tipo cadena, y no <code>String</code> por lo que debemos hacer la conversión con el inicializador <code>String(cString:)</code></li>
<li>Aquí usamos la estrategia de “empaquetar” los datos obtenidos de la BD en un objeto y guardar todos los objetos en un array.</li>
<li>Finalmente <code>sqlite3_finalize</code> libera la memoria ocupada por la <em>query</em></li>
</ul>
<h4>Fechas en SQLite</h4>
<p>SQLite no tiene el tipo fecha. Posibles alternativas son representar una fecha en formato cadena o bien como un entero, el típico "<a href="https://es.wikipedia.org/wiki/Tiempo_Unix">UNIX timestamp</a>" (número de segundos transcurridos desde el 1 de enero de 1970). Por ejemplo si sabemos que la fecha está almacenada como un <em>timestamp</em> podríamos hacer algo como:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="c1">//supongamos que la columna 2 es una fecha en formato timestamp UNIX</span>
<span class="kd">let</span> <span class="nv">unix_time</span> <span class="p">=</span> <span class="n">sqlite3_column_int</span><span class="p">(</span><span class="n">statement</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
<span class="c1">//TimeInterval es equivalente a Double. Hacemos una conversión</span>
<span class="kd">let</span> <span class="nv">fecha</span> <span class="p">=</span> <span class="n">Date</span><span class="p">(</span><span class="n">timeIntervalSince1970</span><span class="p">:</span> <span class="n">TimeInterval</span><span class="p">(</span><span class="n">valor</span><span class="p">))</span>
<span class="c1">//La clase DateFormatter nos permite mostrar una fecha</span>
<span class="kd">let</span> <span class="nv">df</span> <span class="p">=</span> <span class="n">DateFormatter</span><span class="p">()</span>
<span class="c1">//Hay una serie de estilos predefinidos</span>
<span class="n">df</span><span class="p">.</span><span class="n">dateStyle</span> <span class="p">=</span> <span class="p">.</span><span class="n">full</span>
<span class="bp">print</span><span class="p">(</span><span class="s">&quot;</span><span class="si">\(</span><span class="n">df</span><span class="p">.</span><span class="n">string</span><span class="si">(</span><span class="n">from</span><span class="p">:</span> <span class="n">fecha</span><span class="si">))</span><span class="s">&quot;</span><span class="p">)</span>
</pre></div>
</td></tr></table>

<p>En el ejemplo se usa la clase <code>DateFormatter</code> para mostrar la fecha, se puede configurar para variar el <em>locale</em> y el formato concreto. Hay una serie de formatos predefinidos (<code>.short</code>, <code>.medium</code>, <code>.full</code>, ...) y también podemos especificar mediante una cadena de formato qué componentes queremos mostrar y en qué orden. Para más información consultar la <a href="https://developer.apple.com/reference/foundation/dateformatter">documentación de <code>DateFormatter</code></a>.</p>
<p>También podríamos almacenar las fechas en formato cadena (formato <code>año-mes-dia horas:minutos:segundos</code>). Parsear las fechas será algo más tedioso que con <em>timestamps</em>, podéis consultar <a href="http://www.owsiak.org/?p=326">este ejemplo</a>.</p>
<h4>Consultas con parámetros</h4>
<p>En el ejemplo del apartado anterior la consulta SQL era una cadena fija pero en muchos casos necesitaremos parametrizar la consulta (por ejemplo obtener todos los alumnos cuyo apellido empiece por una letra, o los nacidos después de una fecha determinada). </p>
<p>Aunque podemos construir el  <code>String</code> concatenando subcadenas es más "limpio" usar parámetros, que además nos protegen contra posibles intentos de inyección SQL. Al igual que en la mayoría de BD los parámetros se especifican con el símbolo <code>?</code></p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kd">let</span> <span class="nv">querySQL</span> <span class="p">=</span> <span class="s">&quot;SELECT * FROM alumnos WHERE fecha_nacimiento &lt; ?&quot;</span>
</pre></div>
</td></tr></table>

<p>Para instanciar el parámetro con un determinado valor usaremos la familia de funciones <code>sqlite3_bind_XXX</code>, en la que las <code>XXX</code> indican el tipo de datos del parámetro (<code>int</code>, <code>double</code>, <code>text</code>,…). Esta instanciación se debe hacer después de "preparar" la <em>query</em> con <code>sqlite3_prepare_v2</code> pero antes de ejecutarla con <code>sqlite3_step()</code>.</p>
<p>Por ejemplo, vamos a buscar todas las personas que tengan más de 18 años (cuya fecha de nacimiento sea anterior a la actual restándole 18 años)</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kd">let</span> <span class="nv">querySQL</span> <span class="p">=</span> <span class="s">&quot;SELECT * FROM alumnos WHERE fecha_nacimiento&lt;?&quot;</span>
<span class="kd">var</span> <span class="nv">statement</span> <span class="p">:</span> <span class="n">OpaquePointer</span><span class="p">?</span>

<span class="kd">let</span> <span class="nv">result</span> <span class="p">=</span> <span class="n">sqlite3_prepare_v2</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">querySQL</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">&amp;</span><span class="n">statement</span><span class="p">,</span> <span class="kc">nil</span><span class="p">)</span>
<span class="kd">let</span> <span class="nv">cal</span> <span class="p">=</span> <span class="n">Calendar</span><span class="p">.</span><span class="n">current</span>
<span class="kd">let</span> <span class="nv">hace18</span> <span class="p">=</span> <span class="n">cal</span><span class="p">.</span><span class="n">date</span><span class="p">(</span><span class="n">byAdding</span><span class="p">:</span> <span class="n">Calendar</span><span class="p">.</span><span class="n">Component</span><span class="p">.</span><span class="n">year</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="o">-</span><span class="mi">18</span><span class="p">,</span> <span class="n">to</span><span class="p">:</span> <span class="n">Date</span><span class="p">(),</span> <span class="n">wrappingComponents</span><span class="p">:</span> <span class="kc">false</span><span class="p">)</span>
<span class="n">sqlite3_bind_int</span><span class="p">(</span><span class="n">statement</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="nb">Int32</span><span class="p">(</span><span class="n">hace18</span><span class="p">!.</span><span class="n">timeIntervalSince1970</span><span class="p">))</span>
</pre></div>
</td></tr></table>

<p>Nótese que para instanciar un parámetro debemos conocer su posición y que <strong>las posiciones de los parámetros comienzan en 1</strong>, no en 0.</p>
<p>En SQLite también se pueden definir parámetros por nombre con el formato <code>:nombre</code>, por ejemplo</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kd">let</span> <span class="nv">querySQL</span> <span class="p">=</span> <span class="s">&quot;SELECT * FROM alumnos WHERE fecha_nacimiento &lt; :fecha&quot;</span><span class="p">;</span>
</pre></div>
</td></tr></table>

<p>No obstante el API C no nos permite instanciar el parámetro directamente por nombre. Primero debemos obtener su posición con la función <code>sqlite3_bind_parameter_index(sentencia,nombre)</code> y luego aplicar la ya conocida <code>sqlite3_bind_XXX()</code>. </p>
<h3 id="consultas-de-actualizacion">Consultas de actualización<a class="headerlink" href="#consultas-de-actualizacion" title="Permanent link">&para;</a></h3>
<blockquote>
<p>Como ya hemos comentado, para que se puedan ejecutar consultas de actualización sobre la base de datos esta tiene que estar almacenada en un directorio con permisos de escritura</p>
</blockquote>
<p>Las consultas de actualización se manejan de un modo similar a las de selección: se preparan con <code>sqlite3_prepare_v2()</code>, se vinculan los parámetros si estos existen con <code>sqlite3_bind_XXX()</code> y se ejecutan con <code>sqlite3_step()</code>. Por supuesto en ellas no hay bucle para recorrer los resultados.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6
7
8
9</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kd">let</span> <span class="nv">querySQL</span> <span class="p">=</span> <span class="s">&quot;INSERT INTO alumnos (nombre, fecha_nacimiento) VALUES (?,?)&quot;</span>
<span class="kd">var</span> <span class="nv">statement</span> <span class="p">:</span> <span class="n">OpaquePointer</span><span class="p">?</span>
<span class="n">sqlite3_prepare_v2</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">querySQL</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">&amp;</span><span class="n">statement</span><span class="p">,</span> <span class="kc">nil</span><span class="p">);</span>
<span class="n">sqlite3_bind_text</span><span class="p">(</span><span class="n">statement</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nombre</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="kc">nil</span><span class="p">);</span>
<span class="n">sqlite3_bind_int</span><span class="p">(</span><span class="n">statement</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="nb">Int32</span><span class="p">(</span><span class="n">fechaNacimiento</span><span class="p">.</span><span class="n">timeIntervalSince1970</span><span class="p">));</span>
<span class="kd">let</span> <span class="nv">result</span> <span class="p">=</span> <span class="n">sqlite3_step</span><span class="p">(</span><span class="n">statement</span><span class="p">);</span>
<span class="k">if</span> <span class="p">(</span><span class="n">result</span><span class="p">==</span><span class="n">SQLITE_DONE</span><span class="p">)</span> <span class="p">{</span>
    <span class="bp">print</span><span class="p">(</span><span class="s">&quot;Registro almacenado OK&quot;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>

<p>Como vemos, cuando se ejecuta con éxito una consulta de actualización, la ejecución devuelve el valor <code>SQLITE_DONE</code>.</p>
<p>Nótese que el <code>sqlite3_bind_text</code> tiene un par de parámetros adicionales con respecto a <code>sqlite3_bind_int</code>. En los casos más habituales se pasan siempre los valores <code>-1</code> y <code>nil</code> respectivamente. Para ver más información sobre estos parámetros, consultar la <a href="https://www.sqlite.org/c3ref/bind_blob.html">documentación de SQLite</a></p>
<p>Podemos contar cuántas filas han sido afectadas por la consulta de actualización (en el ejemplo cuántas filas se han insertado, o sea 1) con la función <code>sqlite3_changes()</code> a la que hay que pasarle el <code>struct</code> que representa a la base de datos:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kd">var</span> <span class="nv">db</span> <span class="p">:</span> <span class="n">OpaquePointer</span><span class="p">?</span>
<span class="p">...</span>
<span class="bp">print</span><span class="p">(</span><span class="s">&quot;Filas afectadas: </span><span class="si">\(</span><span class="n">sqlite3_changes</span><span class="si">(</span><span class="n">db</span><span class="si">))</span><span class="s">&quot;</span><span class="p">;</span>
</pre></div>
</td></tr></table>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../2.1_intro_SQLite/" title="Introducción" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Anterior
                </span>
                Introducción
              </span>
            </div>
          </a>
        
        
          <a href="../2.3_frameworks/" title="Frameworks para SQLite" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Siguiente
                </span>
                Frameworks para SQLite
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application.ac79c3b0.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:"../.."}})</script>
      
    
  </body>
</html>